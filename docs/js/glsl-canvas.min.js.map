{"version":3,"sources":["docs/js/glsl-canvas.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","_possibleConstructorReturn","self","_typeof","ReferenceError","_assertThisInitialized","_getPrototypeOf","Object","setPrototypeOf","getPrototypeOf","__proto__","_setPrototypeOf","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","_createClass","protoProps","staticProps","prototype","obj","Symbol","iterator","constructor","__importDefault","mod","__esModule","default","factory","v","undefined","define","amd","value","common_1","context_1","Buffer","gl","BW","BH","index","this","getExtension","activeTexture","TEXTURE0","texture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","FLOAT","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","buffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","pixels","status","checkFramebufferStatus","minW","Math","min","minH","FRAMEBUFFER_COMPLETE","Float32Array","readPixels","newTexture","newIndex","texSubImage2D","newBuffer","deleteTexture","IOBuffer","vertexString","fragmentString","isValid","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","program","createProgram","input","output","deleteShader","useProgram","viewport","framebufferTexture2D","COLOR_ATTACHMENT0","drawArrays","TRIANGLES","temp","resize","deleteProgram","Buffers","_common_1$default","apply","arguments","subClass","superClass","create","_inherits","get","keys","values","buffers","count","matches","regexp","exec","drawingBufferWidth","drawingBufferHeight","set","./common","./context","2","NumberMap","StringMap","IterableStringMap","hasOwnProperty","item","callbackfn","initialValue","previous","3","ContextError","ContextVertexBuffers","Context","canvas","attributes","errorCallback","handleError","errorCode","html","container","parentNode","innerHTML","concat","WebGLRenderingContext","BrowserSupport","context","getContext","Other","options","names","source","type","offset","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","lastError","getShaderInfoLog","console","error","shaders","locations","attachShader","_i","bindAttribLocation","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","log","vertexBuffers","texcoordIndex","getAttribLocation","texcoord","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","positionIndex","position","4","_toConsumableArray","arr","Array","isArray","arr2","_arrayWithoutHoles","iter","toString","from","_iterableToArray","_nonIterableSpread","__importStar","result","k","buffers_1","subscriber_1","textures_1","uniforms_1","GlslCanvasOptions","GlslCanvasTimer","delay","current","delta","paused","start","performance","now","GlslCanvas","_subscriber_1$default","_this","contextOptions","dirty","animated","nDelta","nTime","nDate","nMouse","textureList","textures","uniforms","mouse","x","y","valid","visible","width","clientWidth","height","clientHeight","rect","getBoundingClientRect","tryGetContext","onError","pixelRatio","window","devicePixelRatio","style","backgroundColor","getShaders","then","success","load","addListeners","loop","items","push","url","Promise","resolve","reject","xhr","XMLHttpRequest","onload","response","responseText","onerror","ontimeout","onabort","open","send","_this2","urls","hasAttribute","vertex","getAttribute","fragment","all","map","fetch","body","_this3","scroll","mousemove","clientX","pageX","clientY","pageY","click","toggle","time","checkRender","requestAnimationFrame","addEventListener","document","pause","getBuffers","createVertexBuffers","createUniforms","trigger","_this4","timer","extension","query","createQueryEXT","wasValid","render","beginQueryEXT","TIME_ELAPSED_EXT","endQueryEXT","waitForTest","available","getQueryObjectEXT","QUERY_RESULT_AVAILABLE_EXT","disjoint","getParameter","GPU_DISJOINT_EXT","timeElapsedMs","QUERY_RESULT_EXT","destroy","splice","indexOf","_uniforms_1$default","_len","_key","uniform","parseUniform","UniformType","Sampler2D","loadTexture","_this5","forEach","setUniform","classList","add","play","remove","top","innerHeight","documentElement","W","H","floor","isVisible","sizeDidChanged","isAnimated","isDirty","_this6","hasDelta","match","hasTime","hasDate","hasMouse","hasTextures","parseTextures","UniformMethod","Uniform2f","FloatVec2","Uniform1f","Float","date","Date","Uniform4f","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","Uniform1i","_this7","ext","split","pop","toLowerCase","TextureExtensions","has","_this8","createOrUpdate","next","update","left","right","bottom","MX","MY","_key2","tryUpdate","updateUniforms","clean","b","find","slice","getElementsByClassName","filter","HTMLCanvasElement","of","loadAll","./buffers","./subscriber","./textures","./uniforms","5","Listener","event","callback","Subscriber","listeners","Set","listener","delete","clear","data","6","TextureSourceType","TextureFilteringType","TextureImageExtensions","TextureVideoExtensions","TextureData","TextureOptions","Texture","powerOf2","setData","Uint8Array","filtering","Linear","setUrl","element","setElement","sourceType","Url","assign","promise","isVideo","src","createElement","setAttribute","autoplay","muted","Image","isSafari","crossOrigin","originalElement","querySelector","HTMLImageElement","HTMLVideoElement","Element","video","setFiltering","message","JSON","stringify","Data","pixelStorei","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","naturalWidth","naturalHeight","UNSIGNED_BYTE","videoWidth","videoHeight","imageBuffer","isPowerOf2","MipMap","wrapS","repeat","REPEAT","wrapT","LINEAR_MIPMAP_LINEAR","LINEAR","generateMipmap","Nearest","test","navigator","userAgent","text","urlElementOrData","getTextureOptions","MAX_TEXTURE_SIZE","isTextureUrl","Textures","textureOptions","reduce","flag","7","Uniform","location","getUniformLocation","method","UniformTexture","_Uniform","Uniforms","_len2","_len3","_key3","_len4","_key4","array","_len5","_key5","Bool","isTexture","isArrayOfNumbers","Uniform2fv","Uniform3fv","FloatVec3","Uniform4fv","FloatVec4","Uniform1fv","FloatArray","Uniform1iv","_u","prefix","Map"],"mappings":"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","file":"glsl-canvas.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\n(function (factory) {\n  if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n    var v = factory(require, exports);\n    if (v !== undefined) module.exports = v;\n  } else if (typeof define === \"function\" && define.amd) {\n    define([\"require\", \"exports\", \"./common\", \"./context\"], factory);\n  }\n})(function (require, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  var common_1 = __importDefault(require(\"./common\"));\n\n  var context_1 = __importDefault(require(\"./context\"));\n\n  var Buffer =\n  /*#__PURE__*/\n  function () {\n    function Buffer(gl, BW, BH, index) {\n      _classCallCheck(this, Buffer);\n\n      gl.getExtension('OES_texture_float');\n      gl.activeTexture(gl.TEXTURE0 + index);\n      var texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, BW, BH, 0, gl.RGBA, gl.FLOAT, null);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      var buffer = gl.createFramebuffer();\n      this.texture = texture;\n      this.buffer = buffer;\n      this.BW = BW;\n      this.BH = BH;\n      this.index = index;\n    }\n\n    _createClass(Buffer, [{\n      key: \"resize\",\n      value: function resize(gl, BW, BH) {\n        if (BW !== this.BW || BH !== this.BH) {\n          var buffer = this.buffer;\n          var texture = this.texture;\n          var index = this.index;\n          gl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\n          var status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n          var minW = Math.min(BW, this.BW);\n          var minH = Math.min(BH, this.BH);\n          var pixels;\n\n          if (status === gl.FRAMEBUFFER_COMPLETE) {\n            pixels = new Float32Array(minW * minH * 4);\n            gl.readPixels(0, 0, minW, minH, gl.RGBA, gl.FLOAT, pixels);\n          }\n\n          gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n          var newTexture = gl.createTexture();\n          var newIndex = index + 1; // temporary index\n\n          gl.activeTexture(gl.TEXTURE0 + newIndex);\n          gl.bindTexture(gl.TEXTURE_2D, newTexture);\n          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, BW, BH, 0, gl.RGBA, gl.FLOAT, null);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n          if (pixels) {\n            gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, minW, minH, gl.RGBA, gl.FLOAT, pixels);\n          }\n\n          var newBuffer = gl.createFramebuffer();\n          gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n          gl.deleteTexture(texture);\n          gl.activeTexture(gl.TEXTURE0 + index);\n          gl.bindTexture(gl.TEXTURE_2D, newTexture);\n          this.index = index;\n          this.texture = newTexture;\n          this.buffer = newBuffer;\n          this.BW = BW;\n          this.BH = BH;\n        }\n      }\n    }]);\n\n    return Buffer;\n  }();\n\n  exports.Buffer = Buffer;\n\n  var IOBuffer =\n  /*#__PURE__*/\n  function () {\n    function IOBuffer(index, key, vertexString, fragmentString) {\n      _classCallCheck(this, IOBuffer);\n\n      this.isValid = false;\n      this.index = index;\n      this.key = key;\n      this.vertexString = vertexString;\n      this.fragmentString = fragmentString;\n    }\n\n    _createClass(IOBuffer, [{\n      key: \"create\",\n      value: function create(gl, BW, BH) {\n        var vertexShader = context_1.default.createShader(gl, this.vertexString, gl.VERTEX_SHADER);\n        var fragmentShader = context_1.default.createShader(gl, this.fragmentString, gl.FRAGMENT_SHADER, 1);\n\n        if (!fragmentShader) {\n          fragmentShader = context_1.default.createShader(gl, 'void main(){\\n\\tgl_FragColor = vec4(1.0);\\n}', gl.FRAGMENT_SHADER);\n          this.isValid = false;\n        } else {\n          this.isValid = true;\n        }\n\n        var program = context_1.default.createProgram(gl, [vertexShader, fragmentShader]); // gl.useProgram(program);\n\n        var input = new Buffer(gl, BW, BH, this.index + 0);\n        var output = new Buffer(gl, BW, BH, this.index + 2);\n        this.program = program;\n        this.input = input;\n        this.output = output;\n        gl.deleteShader(vertexShader);\n        gl.deleteShader(fragmentShader);\n      }\n    }, {\n      key: \"render\",\n      value: function render(gl, BW, BH) {\n        gl.useProgram(this.program);\n        gl.viewport(0, 0, BW, BH);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.output.buffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.output.texture, 0);\n        gl.drawArrays(gl.TRIANGLES, 0, 6); // swap\n\n        var temp = this.input;\n        var input = this.output;\n        var output = temp;\n        this.input = input;\n        this.output = output;\n      }\n    }, {\n      key: \"resize\",\n      value: function resize(gl, BW, BH) {\n        gl.useProgram(this.program);\n        gl.viewport(0, 0, BW, BH);\n        this.input.resize(gl, BW, BH);\n        this.output.resize(gl, BW, BH);\n      }\n    }, {\n      key: \"destroy\",\n      value: function destroy(gl) {\n        gl.deleteProgram(this.program);\n        this.program = null;\n        this.input = null;\n        this.output = null;\n      }\n    }]);\n\n    return IOBuffer;\n  }();\n\n  exports.IOBuffer = IOBuffer;\n\n  var Buffers =\n  /*#__PURE__*/\n  function (_common_1$default) {\n    _inherits(Buffers, _common_1$default);\n\n    function Buffers() {\n      _classCallCheck(this, Buffers);\n\n      return _possibleConstructorReturn(this, _getPrototypeOf(Buffers).apply(this, arguments));\n    }\n\n    _createClass(Buffers, [{\n      key: \"count\",\n      get: function get() {\n        return Object.keys(this.values).length * 4;\n      }\n    }], [{\n      key: \"getBuffers\",\n      value: function getBuffers(gl, fragmentString, vertexString) {\n        var buffers = new Buffers();\n        var count = 0;\n\n        if (fragmentString) {\n          var regexp = /(?:^\\s*)((?:#if|#elif)(?:\\s*)(defined\\s*\\(\\s*BUFFER_)(\\d+)(?:\\s*\\))|(?:#ifdef)(?:\\s*BUFFER_)(\\d+)(?:\\s*))/gm;\n          var matches;\n\n          while ((matches = regexp.exec(fragmentString)) !== null) {\n            var i = matches[3] || matches[4];\n            var key = 'u_buffer' + i;\n            var buffer = new IOBuffer(count, key, vertexString, '#define BUFFER_' + i + '\\n' + fragmentString);\n            buffer.create(gl, gl.drawingBufferWidth, gl.drawingBufferHeight);\n            buffers.set(key, buffer);\n            count += 4;\n          }\n        }\n\n        return buffers;\n      }\n    }]);\n\n    return Buffers;\n  }(common_1.default);\n\n  exports.default = Buffers;\n});\n\n},{\"./common\":2,\"./context\":3}],2:[function(require,module,exports){\n\"use strict\";\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (factory) {\n  if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n    var v = factory(require, exports);\n    if (v !== undefined) module.exports = v;\n  } else if (typeof define === \"function\" && define.amd) {\n    define([\"require\", \"exports\"], factory);\n  }\n})(function (require, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  var NumberMap = function NumberMap() {\n    _classCallCheck(this, NumberMap);\n  };\n\n  exports.NumberMap = NumberMap;\n  ;\n\n  var StringMap = function StringMap() {\n    _classCallCheck(this, StringMap);\n  };\n\n  exports.StringMap = StringMap;\n  ;\n\n  var IterableStringMap =\n  /*#__PURE__*/\n  function () {\n    function IterableStringMap() {\n      _classCallCheck(this, IterableStringMap);\n\n      this.values = new StringMap();\n    }\n\n    _createClass(IterableStringMap, [{\n      key: \"has\",\n      value: function has(key) {\n        return this.values.hasOwnProperty(key);\n      }\n    }, {\n      key: \"set\",\n      value: function set(key, item) {\n        this.values[key] = item;\n      }\n    }, {\n      key: \"get\",\n      value: function get(key) {\n        return this.values[key];\n      }\n    }, {\n      key: \"forEach\",\n      value: function forEach(callbackfn) {\n        var i = 0;\n\n        for (var key in this.values) {\n          callbackfn(this.values[key], i, this.values);\n          i++;\n        }\n      }\n    }, {\n      key: \"reduce\",\n      value: function reduce(callbackfn, initialValue) {\n        var previous = initialValue,\n            i = 0;\n\n        for (var key in this.values) {\n          previous = callbackfn(previous, this.values[key], i, this.values);\n          i++;\n        }\n\n        return previous;\n      }\n    }]);\n\n    return IterableStringMap;\n  }();\n\n  exports.default = IterableStringMap;\n});\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (factory) {\n  if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n    var v = factory(require, exports);\n    if (v !== undefined) module.exports = v;\n  } else if (typeof define === \"function\" && define.amd) {\n    define([\"require\", \"exports\"], factory);\n  }\n})(function (require, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  var ContextError;\n\n  (function (ContextError) {\n    ContextError[ContextError[\"BrowserSupport\"] = 1] = \"BrowserSupport\";\n    ContextError[ContextError[\"Other\"] = 2] = \"Other\";\n  })(ContextError = exports.ContextError || (exports.ContextError = {}));\n\n  var ContextVertexBuffers = function ContextVertexBuffers() {\n    _classCallCheck(this, ContextVertexBuffers);\n  };\n\n  exports.ContextVertexBuffers = ContextVertexBuffers;\n\n  var Context =\n  /*#__PURE__*/\n  function () {\n    function Context() {\n      _classCallCheck(this, Context);\n    }\n\n    _createClass(Context, null, [{\n      key: \"tryGetContext\",\n      value: function tryGetContext(canvas, attributes, errorCallback) {\n        function handleError(errorCode, html) {\n          if (typeof errorCallback === 'function') {\n            errorCallback(errorCode);\n          } else {\n            var container = canvas.parentNode;\n\n            if (container) {\n              container.innerHTML = \"<div class=\\\"glsl-canvas--error\\\">\".concat(html, \"</div>\");\n            }\n          }\n        }\n\n        if (!WebGLRenderingContext) {\n          handleError(ContextError.BrowserSupport, \"This page requires a browser that supports WebGL.<br/>\\n\\t\\t\\t<a href=\\\"http://get.webgl.org\\\">Click here to upgrade your browser.</a>\");\n          return null;\n        }\n\n        var context = Context.getContext(canvas, attributes);\n\n        if (!context) {\n          handleError(ContextError.Other, \"It does not appear your computer can support WebGL.<br/>\\n\\t\\t\\t<a href=\\\"http://get.webgl.org/troubleshooting/\\\">Click here for more information.</a>\");\n        } else {\n          context.getExtension('OES_standard_derivatives');\n        }\n\n        return context;\n      }\n    }, {\n      key: \"getContext\",\n      value: function getContext(canvas, options) {\n        var names = ['webgl', 'experimental-webgl'];\n        var context = null;\n\n        for (var i = 0; i < names.length; ++i) {\n          try {\n            context = canvas.getContext(names[i], options);\n          } catch (e) {\n            if (context) {\n              break;\n            }\n          }\n        }\n\n        return context;\n      }\n    }, {\n      key: \"createShader\",\n      value: function createShader(gl, source, type) {\n        var offset = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n        var shader = gl.createShader(type);\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n        var compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n        if (!compiled) {\n          // Something went wrong during compilation; get the error\n          Context.lastError = gl.getShaderInfoLog(shader);\n          console.error('*** Error compiling shader ' + shader + ':' + Context.lastError); // main.trigger('error', {\n\n          gl.deleteShader(shader);\n          throw {\n            shader: shader,\n            source: source,\n            type: type,\n            error: Context.lastError,\n            offset: offset\n          };\n        }\n\n        return shader;\n      }\n    }, {\n      key: \"createProgram\",\n      value: function createProgram(gl, shaders, attributes, locations) {\n        var program = gl.createProgram();\n\n        for (var i = 0; i < shaders.length; ++i) {\n          gl.attachShader(program, shaders[i]);\n        }\n\n        if (attributes && locations) {\n          for (var _i = 0; _i < attributes.length; ++_i) {\n            gl.bindAttribLocation(program, locations ? locations[_i] : _i, attributes[_i]);\n          }\n        }\n\n        gl.linkProgram(program); // Check the link status\n\n        var linked = gl.getProgramParameter(program, gl.LINK_STATUS);\n\n        if (!linked) {\n          // something went wrong with the link\n          Context.lastError = gl.getProgramInfoLog(program);\n          console.log('Error in program linking:' + Context.lastError);\n          gl.deleteProgram(program);\n          return null;\n        }\n\n        return program;\n      }\n    }, {\n      key: \"createVertexBuffers\",\n      value: function createVertexBuffers(gl, program) {\n        var vertexBuffers = new ContextVertexBuffers();\n        var texcoordIndex = gl.getAttribLocation(program, 'a_texcoord');\n        vertexBuffers.texcoord = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffers.texcoord);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]), gl.STATIC_DRAW);\n        gl.enableVertexAttribArray(texcoordIndex);\n        gl.vertexAttribPointer(texcoordIndex, 2, gl.FLOAT, false, 0, 0);\n        var positionIndex = gl.getAttribLocation(program, 'a_position');\n        vertexBuffers.position = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffers.position);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0]), gl.STATIC_DRAW);\n        gl.enableVertexAttribArray(positionIndex);\n        gl.vertexAttribPointer(positionIndex, 2, gl.FLOAT, false, 0, 0);\n        return vertexBuffers;\n      }\n    }]);\n\n    return Context;\n  }();\n\n  Context.lastError = '';\n  exports.default = Context;\n});\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar __importStar = void 0 && (void 0).__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  }\n  result[\"default\"] = mod;\n  return result;\n};\n\n(function (factory) {\n  if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n    var v = factory(require, exports);\n    if (v !== undefined) module.exports = v;\n  } else if (typeof define === \"function\" && define.amd) {\n    define([\"require\", \"exports\", \"./buffers\", \"./context\", \"./subscriber\", \"./textures\", \"./uniforms\"], factory);\n  }\n})(function (require, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  }); // import '@babel/polyfill';\n  // import 'whatwg-fetch';\n  // import 'promise-polyfill';\n\n  var buffers_1 = __importDefault(require(\"./buffers\"));\n\n  var context_1 = __importDefault(require(\"./context\"));\n\n  var subscriber_1 = __importDefault(require(\"./subscriber\"));\n\n  var textures_1 = __importStar(require(\"./textures\"));\n\n  var uniforms_1 = __importStar(require(\"./uniforms\"));\n\n  var GlslCanvasDefaultVertex = \"\\n#ifdef GL_ES\\nprecision mediump float;\\n#endif\\n\\nattribute vec2 a_position;\\nattribute vec2 a_texcoord;\\n\\nvarying vec2 v_texcoord;\\n\\nvoid main(){\\n\\tgl_Position = vec4(a_position, 0.0, 1.0);\\n\\tv_texcoord = a_texcoord;\\n}\\n\";\n  var GlslCanvasDefaultFragment = \"\\n#ifdef GL_ES\\nprecision mediump float;\\n#endif\\n\\nvarying vec2 v_texcoord;\\n\\nvoid main(){\\n\\tgl_FragColor = vec4(0.0);\\n}\\n\";\n\n  var GlslCanvasOptions = function GlslCanvasOptions() {\n    _classCallCheck(this, GlslCanvasOptions);\n  };\n\n  exports.GlslCanvasOptions = GlslCanvasOptions;\n\n  var GlslCanvasTimer =\n  /*#__PURE__*/\n  function () {\n    function GlslCanvasTimer() {\n      _classCallCheck(this, GlslCanvasTimer);\n\n      this.delay = 0.0;\n      this.current = 0.0;\n      this.delta = 0.0;\n      this.paused = false;\n      this.start = this.previous = performance.now() / 1000.0;\n    }\n\n    _createClass(GlslCanvasTimer, [{\n      key: \"play\",\n      value: function play() {\n        if (this.previous) {\n          var now = performance.now() / 1000.0;\n          this.delay += now - this.previous;\n          this.previous = now;\n        } // console.log(this.delay);\n\n\n        this.paused = false;\n      }\n    }, {\n      key: \"pause\",\n      value: function pause() {\n        this.paused = true;\n      }\n    }, {\n      key: \"next\",\n      value: function next() {\n        var now = performance.now() / 1000.0;\n        this.delta = now - this.previous;\n        this.current = now - this.start - this.delay;\n        this.previous = now;\n        return this;\n      }\n    }]);\n\n    return GlslCanvasTimer;\n  }();\n\n  exports.GlslCanvasTimer = GlslCanvasTimer;\n\n  var GlslCanvas =\n  /*#__PURE__*/\n  function (_subscriber_1$default) {\n    _inherits(GlslCanvas, _subscriber_1$default);\n\n    function GlslCanvas(canvas) {\n      var _this;\n\n      var contextOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      _classCallCheck(this, GlslCanvas);\n\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(GlslCanvas).call(this));\n      _this.dirty = true;\n      _this.animated = false;\n      _this.nDelta = 0;\n      _this.nTime = 0;\n      _this.nDate = 0;\n      _this.nMouse = 0;\n      _this.textureList = [];\n      _this.textures = new textures_1.default();\n      _this.buffers = new buffers_1.default();\n      _this.uniforms = new uniforms_1.default();\n      _this.mouse = {\n        x: 0,\n        y: 0\n      };\n      _this.valid = false;\n      _this.visible = false;\n\n      if (!canvas) {\n        return _possibleConstructorReturn(_this);\n      }\n\n      _this.canvas = canvas;\n      _this.width = canvas.clientWidth;\n      _this.height = canvas.clientHeight;\n      _this.rect = canvas.getBoundingClientRect();\n      _this.vertexString = contextOptions.vertexString || GlslCanvasDefaultVertex;\n      _this.fragmentString = contextOptions.fragmentString || GlslCanvasDefaultFragment;\n      var gl = context_1.default.tryGetContext(canvas, contextOptions, options.onError);\n\n      if (!gl) {\n        return _possibleConstructorReturn(_this);\n      }\n\n      _this.gl = gl;\n      _this.pixelRatio = window.devicePixelRatio || 1;\n      canvas.style.backgroundColor = contextOptions.backgroundColor || 'rgba(0,0,0,0)';\n\n      _this.getShaders().then(function (success) {\n        _this.load();\n\n        if (!_this.program) {\n          return;\n        }\n\n        _this.addListeners();\n\n        _this.loop(); // this.animated = false;\n\n      }, function (error) {\n        console.log('error', error);\n      });\n\n      GlslCanvas.items.push(_assertThisInitialized(_assertThisInitialized(_this)));\n      return _this;\n    }\n\n    _createClass(GlslCanvas, [{\n      key: \"fetch\",\n      value: function fetch(url) {\n        return new Promise(function (resolve, reject) {\n          var xhr = new XMLHttpRequest();\n\n          xhr.onload = function () {\n            resolve(xhr.response || xhr.responseText);\n          };\n\n          xhr.onerror = function () {\n            reject(new Error('Network request failed'));\n          };\n\n          xhr.ontimeout = function () {\n            reject(new Error('Network request failed'));\n          };\n\n          xhr.onabort = function () {\n            reject(new Error('Aborted'));\n          };\n\n          xhr.open('GET', url, true);\n          xhr.send(null);\n        });\n      }\n    }, {\n      key: \"getShaders\",\n      value: function getShaders() {\n        var _this2 = this;\n\n        return new Promise(function (resolve, reject) {\n          var canvas = _this2.canvas;\n          var urls = {};\n\n          if (canvas.hasAttribute('data-vertex-url')) {\n            urls.vertex = canvas.getAttribute('data-vertex-url');\n          }\n\n          if (canvas.hasAttribute('data-fragment-url')) {\n            urls.fragment = canvas.getAttribute('data-fragment-url');\n          }\n\n          if (canvas.hasAttribute('data-vertex')) {\n            _this2.vertexString = canvas.getAttribute('data-vertex');\n          }\n\n          if (canvas.hasAttribute('data-fragment')) {\n            _this2.fragmentString = canvas.getAttribute('data-fragment');\n          }\n\n          if (Object.keys(urls).length) {\n            Promise.all(Object.keys(urls).map(function (key, i) {\n              var url = urls[key];\n              return _this2.fetch(url) // .then((response) => response.text())\n              .then(function (body) {\n                if (key === 'vertex') {\n                  return _this2.vertexString = body;\n                } else {\n                  return _this2.fragmentString = body;\n                }\n              });\n            })).then(function (shaders) {\n              resolve([_this2.vertexString, _this2.fragmentString]);\n            });\n          } else {\n            resolve([_this2.vertexString, _this2.fragmentString]);\n          }\n        });\n      }\n    }, {\n      key: \"addListeners\",\n      value: function addListeners() {\n        var _this3 = this;\n\n        // resize buffers on canvas resize\n        // consider applying a throttle of 50 ms on canvas resize\n        // to avoid requestAnimationFrame and Gl violations\n        var resize = function resize(e) {\n          _this3.rect = _this3.canvas.getBoundingClientRect();\n        };\n\n        var scroll = function scroll(e) {\n          _this3.rect = _this3.canvas.getBoundingClientRect();\n        };\n\n        var mousemove = function mousemove(e) {\n          _this3.mouse.x = e.clientX || e.pageX;\n          _this3.mouse.y = e.clientY || e.pageY;\n        };\n\n        var click = function click(e) {\n          _this3.toggle();\n        };\n\n        var loop = function loop(time) {\n          _this3.checkRender();\n\n          window.requestAnimationFrame(loop);\n        };\n\n        this.resize = resize;\n        this.scroll = scroll;\n        this.mousemove = mousemove;\n        this.click = click;\n        this.loop = loop;\n        window.addEventListener('resize', resize);\n        window.addEventListener('scroll', scroll);\n        document.addEventListener('mousemove', mousemove, false);\n\n        if (this.canvas.hasAttribute('controls')) {\n          this.canvas.addEventListener('click', click);\n\n          if (!this.canvas.hasAttribute('data-autoplay')) {\n            this.pause();\n          }\n        }\n      }\n    }, {\n      key: \"load\",\n      value: function load(fragmentString, vertexString) {\n        if (vertexString) {\n          this.vertexString = vertexString;\n        }\n\n        if (fragmentString) {\n          this.fragmentString = fragmentString;\n        }\n\n        var gl = this.gl;\n        var vertexShader = context_1.default.createShader(gl, this.vertexString, gl.VERTEX_SHADER);\n        var fragmentShader = context_1.default.createShader(gl, this.fragmentString, gl.FRAGMENT_SHADER); // If Fragment shader fails load a empty one to sign the error\n\n        if (!fragmentShader) {\n          fragmentShader = context_1.default.createShader(gl, \"void main(){\\n\\t\\t\\t\\tgl_FragColor = vec4(1.0);\\n\\t\\t\\t}\", gl.FRAGMENT_SHADER);\n          this.valid = false;\n        } else {\n          this.valid = true;\n        } // Create and use program\n\n\n        var program = context_1.default.createProgram(gl, [vertexShader, fragmentShader]); //, [0,1],['a_texcoord','a_position']);\n\n        gl.useProgram(program); // Delete shaders\n        // gl.detachShader(program, vertexShader);\n        // gl.detachShader(program, fragmentShader);\n\n        gl.deleteShader(vertexShader);\n        gl.deleteShader(fragmentShader);\n        this.program = program;\n\n        if (this.valid) {\n          this.buffers = buffers_1.default.getBuffers(gl, this.fragmentString, this.vertexString);\n          this.vertexBuffers = context_1.default.createVertexBuffers(gl, program);\n          this.createUniforms(); // this.getBuffers(this.fragmentString);\n        } // Trigger event\n\n\n        this.trigger('load', {}); // this.render();\n      }\n    }, {\n      key: \"test\",\n      value: function test(fragmentString, vertexString) {\n        var _this4 = this;\n\n        return new Promise(function (resolve, reject) {\n          // Thanks to @thespite for the help here\n          // https://www.khronos.org/registry/webgl/extensions/EXT_disjoint_timer_query/\n          var vertex = _this4.vertexString;\n          var fragment = _this4.fragmentString;\n          var paused = _this4.timer.paused;\n\n          var extension = _this4.gl.getExtension('EXT_disjoint_timer_query');\n\n          var query = extension.createQueryEXT();\n          var wasValid = _this4.valid;\n\n          if (fragmentString || vertexString) {\n            _this4.load(fragmentString, vertexString);\n\n            wasValid = _this4.valid;\n\n            _this4.render();\n          }\n\n          _this4.timer.paused = true;\n          extension.beginQueryEXT(extension.TIME_ELAPSED_EXT, query);\n\n          _this4.render();\n\n          extension.endQueryEXT(extension.TIME_ELAPSED_EXT);\n\n          var waitForTest = function waitForTest() {\n            _this4.render();\n\n            var available = extension.getQueryObjectEXT(query, extension.QUERY_RESULT_AVAILABLE_EXT);\n\n            var disjoint = _this4.gl.getParameter(extension.GPU_DISJOINT_EXT);\n\n            if (available && !disjoint) {\n              var result = {\n                wasValid: wasValid,\n                fragment: fragmentString || _this4.fragmentString,\n                vertex: vertexString || _this4.vertexString,\n                timeElapsedMs: extension.getQueryObjectEXT(query, extension.QUERY_RESULT_EXT) / 1000000.0\n              };\n              _this4.timer.paused = paused;\n\n              if (fragmentString || vertexString) {\n                _this4.load(fragment, vertex);\n              }\n\n              resolve(result);\n            } else {\n              window.requestAnimationFrame(waitForTest);\n            }\n          };\n\n          waitForTest();\n        });\n      }\n    }, {\n      key: \"destroy\",\n      value: function destroy() {\n        this.animated = false;\n        this.valid = false;\n        var gl = this.gl;\n        /*\n        // !!!\n        for (let texture in this.textures) {\n            if (texture.destroy) {\n                texture.destroy(gl);\n            }\n        }\n        */\n\n        gl.useProgram(null);\n        gl.deleteProgram(this.program); // this.buffers.forEach((buffer: IOBuffer) => buffer.destroy(gl));\n\n        for (var key in this.buffers.values) {\n          var buffer = this.buffers.values[key];\n          buffer.destroy(gl);\n        }\n\n        this.buffers = null;\n        this.textures = null;\n        this.uniforms = null;\n        this.program = null;\n        this.gl = null;\n        GlslCanvas.items.splice(GlslCanvas.items.indexOf(this), 1);\n      }\n    }, {\n      key: \"setUniform\",\n      value: function setUniform(key) {\n        var _uniforms_1$default;\n\n        for (var _len = arguments.length, values = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          values[_key - 1] = arguments[_key];\n        }\n\n        var uniform = (_uniforms_1$default = uniforms_1.default).parseUniform.apply(_uniforms_1$default, [key].concat(values));\n\n        if (uniform) {\n          if (uniform.type === uniforms_1.UniformType.Sampler2D) {\n            this.loadTexture(key, values[0]);\n          } else {\n            this.uniforms.set(key, uniform);\n          }\n        }\n      }\n    }, {\n      key: \"setUniforms\",\n      value: function setUniforms(values) {\n        var _this5 = this;\n\n        values.forEach(function (value, key) {\n          _this5.setUniform.apply(_this5, [key].concat(_toConsumableArray(value)));\n        });\n      }\n    }, {\n      key: \"pause\",\n      value: function pause() {\n        if (this.valid) {\n          this.timer.pause();\n          this.canvas.classList.add('paused');\n        }\n      }\n    }, {\n      key: \"play\",\n      value: function play() {\n        if (this.valid) {\n          this.timer.play();\n          this.canvas.classList.remove('paused');\n        }\n      }\n    }, {\n      key: \"toggle\",\n      value: function toggle() {\n        if (this.valid) {\n          if (this.timer.paused) {\n            this.play();\n          } else {\n            this.pause();\n          }\n        }\n      }\n    }, {\n      key: \"isVisible\",\n      value: function isVisible() {\n        var rect = this.rect;\n        return rect.top + rect.height > 0 && rect.top < (window.innerHeight || document.documentElement.clientHeight);\n      }\n    }, {\n      key: \"isAnimated\",\n      value: function isAnimated() {\n        return (this.animated || this.textures.animated) && !this.timer.paused;\n      }\n    }, {\n      key: \"isDirty\",\n      value: function isDirty() {\n        return this.dirty || this.uniforms.dirty || this.textures.dirty; // [].slice.call(this.textures.values()).reduce((p, texture) => p || texture.dirty, false);\n        // this.textures.dirty;\n      } // check size change at start of requestFrame\n\n    }, {\n      key: \"sizeDidChanged\",\n      value: function sizeDidChanged() {\n        var gl = this.gl;\n        var rect = this.rect;\n        var W = rect.width,\n            H = rect.height;\n\n        if (this.width !== W || this.height !== H) {\n          this.width = W;\n          this.height = H; // Lookup the size the browser is displaying the canvas in CSS pixels\n          // and compute a size needed to make our drawingbuffer match it in\n          // device pixels.\n\n          var BW = Math.floor(W * this.pixelRatio);\n          var BH = Math.floor(H * this.pixelRatio); // Check if the canvas is not the same size.\n\n          if (gl.canvas.width !== BW || gl.canvas.height !== BH) {\n            // Make the canvas the same size\n            gl.canvas.width = BW;\n            gl.canvas.height = BH; // Set the viewport to match\n            // gl.viewport(0, 0, BW, BH);\n          }\n          /*\n          this.buffers.forEach((buffer: IOBuffer) => {\n              buffer.resize(gl, BW, BH);\n          });\n          */\n\n\n          for (var key in this.buffers.values) {\n            var buffer = this.buffers.values[key];\n            buffer.resize(gl, BW, BH);\n          } // gl.useProgram(this.program);\n\n\n          return true;\n        } else {\n          return false;\n        }\n      }\n    }, {\n      key: \"checkRender\",\n      value: function checkRender() {\n        if (this.isVisible() && (this.sizeDidChanged() || this.isAnimated() || this.isDirty())) {\n          this.render();\n          this.canvas.classList.add('playing');\n        } else {\n          this.canvas.classList.remove('playing');\n        }\n      }\n    }, {\n      key: \"createUniforms\",\n      value: function createUniforms() {\n        var _this6 = this;\n\n        var gl = this.gl;\n        var fragmentString = this.fragmentString;\n        var BW = gl.drawingBufferWidth;\n        var BH = gl.drawingBufferHeight;\n        var timer = this.timer = new GlslCanvasTimer();\n        var hasDelta = (fragmentString.match(/u_delta/g) || []).length > 1;\n        var hasTime = (fragmentString.match(/u_time/g) || []).length > 1;\n        var hasDate = (fragmentString.match(/u_date/g) || []).length > 1;\n        var hasMouse = (fragmentString.match(/u_mouse/g) || []).length > 1;\n        var hasTextures = this.parseTextures(fragmentString);\n        this.animated = hasTime || hasDate || hasMouse;\n\n        if (this.animated) {\n          this.canvas.classList.add('animated');\n        } else {\n          this.canvas.classList.remove('animated');\n        }\n\n        this.uniforms.create(uniforms_1.UniformMethod.Uniform2f, uniforms_1.UniformType.FloatVec2, 'u_resolution', BW, BH);\n\n        if (hasDelta) {\n          this.uniforms.create(uniforms_1.UniformMethod.Uniform1f, uniforms_1.UniformType.Float, 'u_delta', timer.delta);\n        }\n\n        if (hasTime) {\n          this.uniforms.create(uniforms_1.UniformMethod.Uniform1f, uniforms_1.UniformType.Float, 'u_time', timer.current);\n        }\n\n        if (hasDate) {\n          var date = new Date();\n          this.uniforms.create(uniforms_1.UniformMethod.Uniform4f, uniforms_1.UniformType.Float, 'u_date', date.getFullYear(), date.getMonth(), date.getDate(), date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds() + date.getMilliseconds() * 0.001);\n        }\n\n        if (hasMouse) {\n          this.uniforms.create(uniforms_1.UniformMethod.Uniform2f, uniforms_1.UniformType.FloatVec2, 'u_mouse', 0, 0);\n        }\n\n        for (var key in this.buffers.values) {\n          var buffer = this.buffers.values[key];\n          this.uniforms.create(uniforms_1.UniformMethod.Uniform1i, uniforms_1.UniformType.Sampler2D, buffer.key, buffer.input.index);\n        }\n        /*\n        this.buffers.forEach((buffer: IOBuffer) => {\n            this.uniforms.create(UniformMethod.Uniform1i, UniformType.Sampler2D, buffer.key, buffer.input.index);\n        });\n        */\n\n\n        if (hasTextures) {\n          this.textureList.forEach(function (x) {\n            _this6.loadTexture(x.key, x.url);\n          });\n        }\n        /*\n        while (this.textureList.length > 0) {\n            const x = this.textureList.shift();\n            this.loadTexture(x.key, x.url);\n        }\n        */\n\n      }\n    }, {\n      key: \"parseTextures\",\n      value: function parseTextures(fragmentString) {\n        var _this7 = this;\n\n        var regexp = /uniform\\s*sampler2D\\s*([\\w]*);(\\s*\\/\\/\\s*([\\w|\\:\\/\\/|\\.|\\-|\\_]*)|\\s*)/gm;\n        var matches;\n\n        while ((matches = regexp.exec(fragmentString)) !== null) {\n          var key = matches[1];\n\n          if (matches[3]) {\n            var ext = matches[3].split('.').pop().toLowerCase();\n            var url = matches[3];\n\n            if (url && textures_1.TextureExtensions.indexOf(ext) !== -1) {\n              this.textureList.push({\n                key: key,\n                url: url\n              });\n            }\n          } else if (!this.buffers.has(key)) {\n            // create empty texture\n            this.textureList.push({\n              key: key,\n              url: null\n            });\n          }\n        }\n\n        if (this.canvas.hasAttribute('data-textures')) {\n          var urls = this.canvas.getAttribute('data-textures').split(',');\n          urls.forEach(function (url, i) {\n            var key = 'u_tex' + i;\n\n            _this7.textureList.push({\n              key: key,\n              url: url\n            });\n          });\n        }\n\n        return this.textureList.length > 0;\n      }\n    }, {\n      key: \"loadTexture\",\n      value: function loadTexture(key, url) {\n        var _this8 = this;\n\n        if (this.valid) {\n          return this.textures.createOrUpdate(this.gl, key, url, this.buffers.count).then(function (texture) {\n            var index = texture.index;\n\n            var uniform = _this8.uniforms.createTexture(key, index);\n\n            uniform.texture = texture;\n\n            var uniformResolution = _this8.uniforms.create(uniforms_1.UniformMethod.Uniform2f, uniforms_1.UniformType.FloatVec2, key + 'Resolution', texture.width, texture.height); // console.log('loadTexture', key, url, index, texture.width, texture.height);\n\n\n            return texture;\n          });\n        } else {\n          this.textureList.push({\n            key: key,\n            url: url\n          });\n        }\n      }\n    }, {\n      key: \"updateUniforms\",\n      value: function updateUniforms() {\n        var gl = this.gl;\n        var BW = gl.drawingBufferWidth;\n        var BH = gl.drawingBufferHeight;\n        var timer = this.timer.next();\n        this.uniforms.update(uniforms_1.UniformMethod.Uniform2f, uniforms_1.UniformType.FloatVec2, 'u_resolution', BW, BH);\n\n        if (this.uniforms.has('u_delta')) {\n          this.uniforms.update(uniforms_1.UniformMethod.Uniform1f, uniforms_1.UniformType.Float, 'u_delta', timer.delta);\n        }\n\n        if (this.uniforms.has('u_time')) {\n          this.uniforms.update(uniforms_1.UniformMethod.Uniform1f, uniforms_1.UniformType.Float, 'u_time', timer.current);\n        }\n\n        if (this.uniforms.has('u_date')) {\n          var date = new Date();\n          this.uniforms.update(uniforms_1.UniformMethod.Uniform4f, uniforms_1.UniformType.Float, 'u_date', date.getFullYear(), date.getMonth(), date.getDate(), date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds() + date.getMilliseconds() * 0.001);\n        }\n\n        if (this.uniforms.has('u_mouse')) {\n          var rect = this.rect;\n          var mouse = this.mouse;\n\n          if (mouse.x >= rect.left && mouse.x <= rect.right && mouse.y >= rect.top && mouse.y <= rect.bottom) {\n            var MX = (mouse.x - rect.left) * this.pixelRatio;\n            var MY = this.canvas.height - (mouse.y - rect.top) * this.pixelRatio;\n            this.uniforms.update(uniforms_1.UniformMethod.Uniform2f, uniforms_1.UniformType.FloatVec2, 'u_mouse', MX, MY);\n          }\n        }\n\n        for (var key in this.buffers.values) {\n          var buffer = this.buffers.values[key];\n          this.uniforms.update(uniforms_1.UniformMethod.Uniform1i, uniforms_1.UniformType.Sampler2D, buffer.key, buffer.input.index);\n        }\n        /*\n        this.buffers.forEach((buffer: IOBuffer) => {\n            this.uniforms.update(UniformMethod.Uniform1i, UniformType.Sampler2D, buffer.key, buffer.input.index);\n        });\n        */\n\n\n        for (var _key2 in this.textures.values) {\n          var texture = this.textures.values[_key2];\n          texture.tryUpdate(gl); // console.log(texture.key, texture.index);\n\n          this.uniforms.update(uniforms_1.UniformMethod.Uniform1i, uniforms_1.UniformType.Sampler2D, texture.key, texture.index);\n        }\n        /*\n        this.textures.forEach((texture: Texture) => {\n            texture.tryUpdate(gl);\n            // console.log(texture.key, texture.index);\n            this.uniforms.update(UniformMethod.Uniform1i, UniformType.Sampler2D, texture.key, texture.index);\n        });\n        */\n\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var gl = this.gl;\n        var BW = gl.drawingBufferWidth;\n        var BH = gl.drawingBufferHeight;\n        this.updateUniforms();\n        /*\n        this.buffers.forEach((buffer: IOBuffer) => {\n            this.uniforms.apply(gl, buffer.program);\n            buffer.render(gl, BW, BH);\n        });\n        */\n\n        for (var key in this.buffers.values) {\n          var buffer = this.buffers.values[key];\n          this.uniforms.apply(gl, buffer.program);\n          buffer.render(gl, BW, BH);\n        }\n\n        gl.useProgram(this.program);\n        this.uniforms.apply(gl, this.program);\n        gl.viewport(0, 0, BW, BH);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n        this.uniforms.clean();\n        this.textures.clean();\n        this.dirty = false;\n        this.trigger('render', {});\n      }\n    }], [{\n      key: \"version\",\n      value: function version() {\n        return '0.2.0';\n      }\n    }, {\n      key: \"isDifferent\",\n      value: function isDifferent(a, b) {\n        if (a && b) {\n          return a.toString() !== b.toString();\n        }\n\n        return false;\n      }\n    }, {\n      key: \"of\",\n      value: function of(canvas) {\n        return GlslCanvas.items.find(function (x) {\n          return x.canvas === canvas;\n        }) || new GlslCanvas(canvas);\n      }\n    }, {\n      key: \"loadAll\",\n      value: function loadAll() {\n        var canvases = [].slice.call(document.getElementsByClassName('glsl-canvas')).filter(function (x) {\n          return x instanceof HTMLCanvasElement;\n        });\n        return canvases.map(function (x) {\n          return GlslCanvas.of(x);\n        });\n      }\n    }]);\n\n    return GlslCanvas;\n  }(subscriber_1.default);\n\n  GlslCanvas.items = [];\n  exports.default = GlslCanvas;\n  window.GlslCanvas = GlslCanvas;\n  document.addEventListener(\"DOMContentLoaded\", GlslCanvas.loadAll);\n});\n\n},{\"./buffers\":1,\"./context\":3,\"./subscriber\":5,\"./textures\":6,\"./uniforms\":7}],5:[function(require,module,exports){\n\"use strict\";\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (factory) {\n  if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n    var v = factory(require, exports);\n    if (v !== undefined) module.exports = v;\n  } else if (typeof define === \"function\" && define.amd) {\n    define([\"require\", \"exports\"], factory);\n  }\n})(function (require, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  var Listener = function Listener(event, callback) {\n    _classCallCheck(this, Listener);\n\n    this.event = event;\n    this.callback = callback;\n  };\n\n  exports.Listener = Listener;\n\n  var Subscriber =\n  /*#__PURE__*/\n  function () {\n    function Subscriber() {\n      _classCallCheck(this, Subscriber);\n\n      this.listeners = new Set();\n    }\n\n    _createClass(Subscriber, [{\n      key: \"logListeners\",\n      value: function logListeners() {\n        this.listeners.forEach(function (x) {\n          return console.log(x);\n        });\n      }\n    }, {\n      key: \"subscribe\",\n      value: function subscribe(listener) {\n        this.listeners.add(listener);\n      }\n    }, {\n      key: \"unsubscribe\",\n      value: function unsubscribe(listener) {\n        this.listeners.delete(listener);\n      }\n    }, {\n      key: \"unsubscribeAll\",\n      value: function unsubscribeAll() {\n        this.listeners.clear();\n      }\n    }, {\n      key: \"on\",\n      value: function on(event, callback) {\n        this.listeners.add(new Listener(event, callback));\n        return this;\n      }\n    }, {\n      key: \"off\",\n      value: function off(event, callback) {\n        var _this = this;\n\n        if (callback) {\n          this.listeners.delete(new Listener(event, callback));\n        } else {\n          this.listeners.forEach(function (x) {\n            if (x.event === event) {\n              _this.listeners.delete(x);\n            }\n          });\n        }\n\n        return this;\n      }\n    }, {\n      key: \"trigger\",\n      value: function trigger(event) {\n        for (var _len = arguments.length, data = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          data[_key - 1] = arguments[_key];\n        }\n\n        this.listeners.forEach(function (x) {\n          if (x.event === event && typeof x.callback === 'function') {\n            x.callback.apply(x, data);\n          }\n        });\n        return this;\n      }\n    }]);\n\n    return Subscriber;\n  }();\n\n  exports.default = Subscriber;\n});\n\n},{}],6:[function(require,module,exports){\n\"use strict\";\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\n(function (factory) {\n  if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n    var v = factory(require, exports);\n    if (v !== undefined) module.exports = v;\n  } else if (typeof define === \"function\" && define.amd) {\n    define([\"require\", \"exports\", \"./common\", \"./subscriber\"], factory);\n  }\n})(function (require, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  }); // import 'promise-polyfill';\n\n  var common_1 = __importDefault(require(\"./common\"));\n\n  var subscriber_1 = __importDefault(require(\"./subscriber\"));\n\n  exports.TextureImageExtensions = ['jpg', 'jpeg', 'png'];\n  exports.TextureVideoExtensions = ['ogv', 'webm', 'mp4'];\n  exports.TextureExtensions = exports.TextureImageExtensions.concat(exports.TextureVideoExtensions);\n  var TextureSourceType;\n\n  (function (TextureSourceType) {\n    TextureSourceType[TextureSourceType[\"Data\"] = 0] = \"Data\";\n    TextureSourceType[TextureSourceType[\"Element\"] = 1] = \"Element\";\n    TextureSourceType[TextureSourceType[\"Url\"] = 2] = \"Url\";\n  })(TextureSourceType || (TextureSourceType = {}));\n\n  var TextureFilteringType;\n\n  (function (TextureFilteringType) {\n    TextureFilteringType[\"MipMap\"] = \"mipmap\";\n    TextureFilteringType[\"Linear\"] = \"linear\";\n    TextureFilteringType[\"Nearest\"] = \"nearest\";\n  })(TextureFilteringType || (TextureFilteringType = {}));\n\n  var TextureData = function TextureData() {\n    _classCallCheck(this, TextureData);\n  };\n\n  exports.TextureData = TextureData;\n\n  var TextureOptions = function TextureOptions() {\n    _classCallCheck(this, TextureOptions);\n  };\n\n  exports.TextureOptions = TextureOptions; // GL texture wrapper object for keeping track of a global set of textures, keyed by a unique user-defined name\n\n  var Texture =\n  /*#__PURE__*/\n  function (_subscriber_1$default) {\n    _inherits(Texture, _subscriber_1$default);\n\n    function Texture(gl, key, index) {\n      var _this;\n\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new TextureOptions();\n\n      _classCallCheck(this, Texture);\n\n      _this = _possibleConstructorReturn(this, _getPrototypeOf(Texture).call(this));\n      _this.valid = false;\n      _this.dirty = false;\n      _this.animated = false;\n      _this.powerOf2 = false;\n      _this.key = key;\n      _this.index = index;\n      _this.options = options;\n\n      _this.create(gl);\n\n      return _this;\n    }\n\n    _createClass(Texture, [{\n      key: \"create\",\n      value: function create(gl) {\n        this.texture = gl.createTexture();\n\n        if (this.texture) {\n          this.valid = true;\n        } // Default to a 1-pixel black texture so we can safely render while we wait for an image to load\n        // See: http://stackoverflow.com/questions/19722247/webgl-wait-for-texture-to-load\n        // [255, 255, 255, 255]\n\n\n        this.setData(gl, 1, 1, new Uint8Array([0, 0, 0, 0]), {\n          filtering: TextureFilteringType.Linear\n        }); // this.bindTexture();\n        // this.load(options);\n      }\n    }, {\n      key: \"load\",\n      value: function load(gl) {\n        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        this.options = options;\n\n        if (typeof options.url === 'string') {\n          if (this.url === undefined || options.url !== this.url) {\n            return this.setUrl(gl, options.url, options);\n          } else {\n            return Promise.resolve(this);\n          }\n        } else if (options.element) {\n          return this.setElement(gl, options.element, options);\n        } else if (options.data && options.width && options.height) {\n          return this.setData(gl, options.width, options.height, options.data, options);\n        }\n      }\n    }, {\n      key: \"setUrl\",\n      value: function setUrl(gl, url) {\n        var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n        if (!this.valid) {\n          return;\n        }\n\n        this.url = url; // save URL reference (will be overwritten when element is loaded below)\n\n        this.source = url;\n        this.sourceType = TextureSourceType.Url;\n        this.options = Object.assign(this.options, options);\n        var ext = url.split('.').pop().toLowerCase();\n        var isVideo = exports.TextureVideoExtensions.indexOf(ext) !== -1;\n        var element;\n        var promise;\n\n        if (isVideo) {\n          element = document.createElement('video'); // options.filtering = TextureFilteringType.Nearest;\n\n          promise = this.setElement(gl, element, options);\n          element.setAttribute('playsinline', 'true');\n          element.autoplay = true;\n          element.muted = true;\n          element.src = url;\n        } else {\n          element = new Image();\n          promise = this.setElement(gl, element, options);\n\n          if (!(Texture.isSafari() && url.slice(0, 5) === 'data:')) {\n            element.crossOrigin = 'anonymous';\n          }\n\n          element.src = url;\n        }\n\n        return promise;\n      }\n    }, {\n      key: \"setElement\",\n      value: function setElement(gl, element) {\n        var _this2 = this;\n\n        var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        this.options = Object.assign(this.options, options);\n        return new Promise(function (resolve, reject) {\n          var originalElement = element; // a string element is interpeted as a CSS selector\n\n          if (typeof element === 'string') {\n            element = document.querySelector(element);\n          }\n\n          if (element instanceof HTMLCanvasElement || element instanceof HTMLImageElement || element instanceof HTMLVideoElement) {\n            _this2.source = element;\n            _this2.sourceType = TextureSourceType.Element;\n\n            if (element instanceof HTMLVideoElement) {\n              var video = element;\n              video.addEventListener('loadeddata', function (event) {\n                _this2.update(gl, options);\n\n                _this2.setFiltering(gl, options);\n\n                resolve(_this2);\n              });\n              video.addEventListener('error', function (error) {\n                reject(error);\n              });\n            } else if (element instanceof HTMLImageElement) {\n              element.addEventListener('load', function () {\n                _this2.update(gl, options);\n\n                _this2.setFiltering(gl, options);\n\n                resolve(_this2);\n              });\n              element.addEventListener('error', function (error) {\n                reject(error);\n              });\n            } else {\n              _this2.update(gl, options);\n\n              _this2.setFiltering(gl, options);\n\n              resolve(_this2);\n            }\n          } else {\n            var message = \"the 'element' parameter (`element: \".concat(JSON.stringify(originalElement), \"`) must be a CSS selector string, or a <canvas>, <image> or <video> object\");\n            console.log(\"Texture '\".concat(_this2.key, \"': \").concat(message), options);\n            reject(message);\n          }\n        });\n      }\n    }, {\n      key: \"setData\",\n      value: function setData(gl, width, height, data) {\n        var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n        this.width = width;\n        this.height = height;\n        this.options = Object.assign(this.options, options);\n        this.source = data;\n        this.sourceType = TextureSourceType.Data;\n        this.update(gl, options);\n        this.setFiltering(gl, options);\n        return Promise.resolve(this);\n      } // Uploads current image or buffer to the GPU (can be used to update animated textures on the fly)\n\n    }, {\n      key: \"update\",\n      value: function update(gl, options) {\n        if (!this.valid) {\n          return;\n        }\n\n        gl.activeTexture(gl.TEXTURE0 + this.index);\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, options.UNPACK_FLIP_Y_WEBGL === false ? 0 : 1);\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, options.UNPACK_PREMULTIPLY_ALPHA_WEBGL || 0);\n\n        if (this.sourceType === TextureSourceType.Element) {\n          if (this.source instanceof HTMLImageElement && this.source.naturalWidth && this.source.naturalHeight) {\n            this.width = this.source.naturalWidth;\n            this.height = this.source.naturalHeight;\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.source);\n          } else if (this.source instanceof HTMLVideoElement && this.source.videoWidth && this.source.videoHeight) {\n            this.width = this.source.videoWidth;\n            this.height = this.source.videoHeight;\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.source);\n          } else if (this.source instanceof HTMLCanvasElement) {\n            this.width = this.source.width;\n            this.height = this.source.height;\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.source);\n          }\n        } else if (this.sourceType === TextureSourceType.Data) {\n          var imageBuffer = this.source;\n          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, imageBuffer);\n        }\n\n        this.trigger('loaded', this);\n      }\n    }, {\n      key: \"tryUpdate\",\n      value: function tryUpdate(gl) {\n        var dirty = false;\n\n        if (this.animated) {\n          dirty = true;\n          this.update(gl, this.options);\n        }\n\n        return dirty;\n      }\n    }, {\n      key: \"destroy\",\n      value: function destroy(gl) {\n        if (!this.valid) {\n          return;\n        }\n\n        gl.deleteTexture(this.texture);\n        this.texture = null;\n        delete this.source;\n        this.source = null;\n        this.valid = false;\n      }\n    }, {\n      key: \"setFiltering\",\n      value: function setFiltering(gl, options) {\n        if (!this.valid) {\n          return;\n        }\n\n        var powerOf2 = Texture.isPowerOf2(this.width) && Texture.isPowerOf2(this.height);\n        var filtering = options.filtering || TextureFilteringType.MipMap;\n        var wrapS = options.TEXTURE_WRAP_S || options.repeat && gl.REPEAT || gl.CLAMP_TO_EDGE;\n        var wrapT = options.TEXTURE_WRAP_T || options.repeat && gl.REPEAT || gl.CLAMP_TO_EDGE;\n\n        if (!powerOf2) {\n          filtering = filtering === TextureFilteringType.MipMap ? TextureFilteringType.Linear : filtering;\n          wrapS = wrapT = gl.CLAMP_TO_EDGE;\n        }\n\n        this.powerOf2 = powerOf2;\n        this.filtering = filtering; // this.bindTexture();\n        // WebGL has strict requirements on non-power-of-2 textures:\n        // No mipmaps and must clamp to edge\n        // For power-of-2 textures, the following presets are available:\n        // mipmap: linear blend from nearest mip\n        // linear: linear blend from original image (no mips)\n        // nearest: nearest pixel from original image (no mips, 'blocky' look)\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapS);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapT);\n\n        if (this.filtering === TextureFilteringType.MipMap) {\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR); // TODO: use trilinear filtering by defualt instead?\n\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n          gl.generateMipmap(gl.TEXTURE_2D);\n        } else if (this.filtering === TextureFilteringType.Nearest) {\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        } else if (this.filtering === TextureFilteringType.Linear) {\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        }\n      }\n    }], [{\n      key: \"isPowerOf2\",\n      value: function isPowerOf2(value) {\n        return (value & value - 1) === 0;\n      }\n    }, {\n      key: \"isSafari\",\n      value: function isSafari() {\n        return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n      }\n    }, {\n      key: \"isTextureUrl\",\n      value: function isTextureUrl(text) {\n        return /\\.(jpg|jpeg|png|ogv|webm|mp4)$/i.test(text);\n      }\n    }, {\n      key: \"isTexture\",\n      value: function isTexture(urlElementOrData) {\n        var options = Texture.getTextureOptions(urlElementOrData);\n        return options !== undefined;\n      }\n    }, {\n      key: \"getMaxTextureSize\",\n      value: function getMaxTextureSize(gl) {\n        return gl.getParameter(gl.MAX_TEXTURE_SIZE);\n      }\n    }, {\n      key: \"getTextureOptions\",\n      value: function getTextureOptions(urlElementOrData) {\n        var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n        if (typeof urlElementOrData === 'string') {\n          if (Texture.isTextureUrl(urlElementOrData)) {\n            options.url = urlElementOrData;\n            return options;\n          }\n\n          if (document) {\n            urlElementOrData = document.querySelector(urlElementOrData); // console.log(urlElementOrData);\n          }\n        }\n\n        if (urlElementOrData instanceof HTMLCanvasElement || urlElementOrData instanceof HTMLImageElement || urlElementOrData instanceof HTMLVideoElement) {\n          options.element = urlElementOrData;\n          return options;\n        } else if (urlElementOrData instanceof TextureData) {\n          options.data = urlElementOrData.data;\n          options.width = urlElementOrData.width;\n          options.height = urlElementOrData.height;\n          return options;\n        }\n      }\n    }]);\n\n    return Texture;\n  }(subscriber_1.default);\n\n  exports.Texture = Texture;\n\n  var Textures =\n  /*#__PURE__*/\n  function (_common_1$default) {\n    _inherits(Textures, _common_1$default);\n\n    function Textures() {\n      var _this3;\n\n      _classCallCheck(this, Textures);\n\n      _this3 = _possibleConstructorReturn(this, _getPrototypeOf(Textures).apply(this, arguments));\n      _this3.count = 0;\n      _this3.dirty = false;\n      _this3.animated = false;\n      return _this3;\n    }\n\n    _createClass(Textures, [{\n      key: \"clean\",\n      value: function clean() {\n        for (var key in this.values) {\n          this.values[key].dirty = false;\n        }\n\n        this.dirty = false;\n      }\n    }, {\n      key: \"createOrUpdate\",\n      value: function createOrUpdate(gl, key, urlElementOrData) {\n        var _this4 = this;\n\n        var index = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n        var options = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n        var texture;\n        var textureOptions = Texture.getTextureOptions(urlElementOrData, options);\n        texture = this.get(key);\n\n        if (!texture) {\n          texture = new Texture(gl, key, index + this.count, textureOptions);\n          this.count++;\n          this.set(key, texture);\n        }\n\n        if (textureOptions !== undefined) {\n          return texture.load(gl, textureOptions).then(function (texture) {\n            if (texture.source instanceof HTMLVideoElement) {\n              var video = texture.source; // console.log('video', video);\n\n              video.addEventListener('play', function () {\n                // console.log('play', texture.key);\n                texture.animated = true;\n                _this4.animated = true;\n              });\n              video.addEventListener('pause', function () {\n                // console.log('pause', texture.key);\n                texture.animated = false;\n                _this4.animated = _this4.reduce(function (flag, texture) {\n                  return flag || texture.animated;\n                }, false);\n              });\n              video.addEventListener('seeked', function () {\n                // console.log('seeked');\n                texture.update(gl, texture.options);\n                _this4.dirty = true;\n              }); // console.log('video');\n\n              /*\n              video.addEventListener('canplaythrough', () => {\n                  // !!!\n                  this.intervalID = setInterval(() => {\n                      this.update(gl, options);\n                  }, 15);\n              }, true);\n              video.addEventListener('ended', () => {\n                  video.currentTime = 0;\n                  video.play();\n              }, true);\n              */\n            }\n\n            return texture;\n          });\n        } else {\n          return Promise.resolve(texture);\n        }\n      }\n    }]);\n\n    return Textures;\n  }(common_1.default);\n\n  exports.default = Textures;\n});\n\n},{\"./common\":2,\"./subscriber\":5}],7:[function(require,module,exports){\n\"use strict\";\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar __importDefault = void 0 && (void 0).__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\n(function (factory) {\n  if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === \"object\" && _typeof(module.exports) === \"object\") {\n    var v = factory(require, exports);\n    if (v !== undefined) module.exports = v;\n  } else if (typeof define === \"function\" && define.amd) {\n    define([\"require\", \"exports\", \"./common\", \"./textures\"], factory);\n  }\n})(function (require, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  var common_1 = __importDefault(require(\"./common\"));\n\n  var textures_1 = require(\"./textures\");\n\n  var UniformMethod;\n\n  (function (UniformMethod) {\n    UniformMethod[\"Uniform1i\"] = \"uniform1i\"; // Uniform1i  = 'uniform1i', // (boolUniformLoc,   v);                // for bool\n    // Uniform1i  = 'uniform1i', // (sampler2DUniformLoc,   v);           // for sampler2D\n    // Uniform1i  = 'uniform1i', // (samplerCubeUniformLoc,   v);         // for samplerCube\n\n    UniformMethod[\"Uniform1iv\"] = \"uniform1iv\"; // Uniform1iv = 'uniform1iv', // (boolUniformLoc, [v]);                // for bool or bool array\n    // Uniform1iv = 'uniform1iv', // (sampler2DUniformLoc, [v]);           // for sampler2D or sampler2D array\n    // Uniform1iv = 'uniform1iv', // (samplerCubeUniformLoc, [v]);         // for samplerCube or samplerCube array\n\n    UniformMethod[\"Uniform2i\"] = \"uniform2i\";\n    UniformMethod[\"Uniform2iv\"] = \"uniform2iv\";\n    UniformMethod[\"Uniform3i\"] = \"uniform3i\";\n    UniformMethod[\"Uniform3iv\"] = \"uniform3iv\";\n    UniformMethod[\"Uniform4i\"] = \"uniform4i\";\n    UniformMethod[\"Uniform4iv\"] = \"uniform4iv\"; //\n\n    UniformMethod[\"Uniform1f\"] = \"uniform1f\";\n    UniformMethod[\"Uniform1fv\"] = \"uniform1fv\";\n    UniformMethod[\"Uniform2f\"] = \"uniform2f\";\n    UniformMethod[\"Uniform2fv\"] = \"uniform2fv\";\n    UniformMethod[\"Uniform3f\"] = \"uniform3f\";\n    UniformMethod[\"Uniform3fv\"] = \"uniform3fv\";\n    UniformMethod[\"Uniform4f\"] = \"uniform4f\";\n    UniformMethod[\"Uniform4fv\"] = \"uniform4fv\"; //\n\n    UniformMethod[\"UniformMatrix2fv\"] = \"uniformMatrix2fv\";\n    UniformMethod[\"UniformMatrix3fv\"] = \"uniformMatrix3fv\";\n    UniformMethod[\"UniformMatrix4fv\"] = \"uniformMatrix4fv\";\n  })(UniformMethod = exports.UniformMethod || (exports.UniformMethod = {}));\n\n  var UniformType;\n\n  (function (UniformType) {\n    UniformType[UniformType[\"Bool\"] = 0] = \"Bool\";\n    UniformType[UniformType[\"BoolArray\"] = 1] = \"BoolArray\";\n    UniformType[UniformType[\"Int\"] = 2] = \"Int\";\n    UniformType[UniformType[\"IntArray\"] = 3] = \"IntArray\";\n    UniformType[UniformType[\"IntVec2\"] = 4] = \"IntVec2\";\n    UniformType[UniformType[\"IntVec2Array\"] = 5] = \"IntVec2Array\";\n    UniformType[UniformType[\"IntVec3\"] = 6] = \"IntVec3\";\n    UniformType[UniformType[\"IntVec3Array\"] = 7] = \"IntVec3Array\";\n    UniformType[UniformType[\"IntVec4\"] = 8] = \"IntVec4\";\n    UniformType[UniformType[\"IntVec4Array\"] = 9] = \"IntVec4Array\";\n    UniformType[UniformType[\"Float\"] = 10] = \"Float\";\n    UniformType[UniformType[\"FloatArray\"] = 11] = \"FloatArray\";\n    UniformType[UniformType[\"FloatVec2\"] = 12] = \"FloatVec2\";\n    UniformType[UniformType[\"FloatVec2Array\"] = 13] = \"FloatVec2Array\";\n    UniformType[UniformType[\"FloatVec3\"] = 14] = \"FloatVec3\";\n    UniformType[UniformType[\"FloatVec3Array\"] = 15] = \"FloatVec3Array\";\n    UniformType[UniformType[\"FloatVec4\"] = 16] = \"FloatVec4\";\n    UniformType[UniformType[\"FloatVec4Array\"] = 17] = \"FloatVec4Array\";\n    UniformType[UniformType[\"Sampler2D\"] = 18] = \"Sampler2D\";\n    UniformType[UniformType[\"Sampler2DArray\"] = 19] = \"Sampler2DArray\";\n    UniformType[UniformType[\"SamplerCube\"] = 20] = \"SamplerCube\";\n    UniformType[UniformType[\"SamplerCubeArray\"] = 21] = \"SamplerCubeArray\";\n    UniformType[UniformType[\"Matrix2fv\"] = 22] = \"Matrix2fv\";\n    UniformType[UniformType[\"Matrix3fv\"] = 23] = \"Matrix3fv\";\n    UniformType[UniformType[\"Matrix4fv\"] = 24] = \"Matrix4fv\";\n  })(UniformType = exports.UniformType || (exports.UniformType = {}));\n\n  var Uniform =\n  /*#__PURE__*/\n  function () {\n    function Uniform(options) {\n      var _this = this;\n\n      _classCallCheck(this, Uniform);\n\n      this.dirty = true;\n\n      if (options) {\n        Object.assign(this, options);\n      }\n\n      this.apply = function (gl, program) {\n        if (_this.dirty) {\n          gl.useProgram(program);\n          var location = gl.getUniformLocation(program, _this.key);\n\n          gl[_this.method].apply(gl, [location].concat(_this.values));\n        }\n      };\n    }\n\n    _createClass(Uniform, null, [{\n      key: \"isDifferent\",\n      value: function isDifferent(a, b) {\n        if (a && b) {\n          return a.toString() !== b.toString();\n        }\n\n        return false;\n      }\n    }]);\n\n    return Uniform;\n  }();\n\n  exports.Uniform = Uniform;\n\n  var UniformTexture =\n  /*#__PURE__*/\n  function (_Uniform) {\n    _inherits(UniformTexture, _Uniform);\n\n    function UniformTexture(options) {\n      _classCallCheck(this, UniformTexture);\n\n      return _possibleConstructorReturn(this, _getPrototypeOf(UniformTexture).call(this, options));\n    }\n\n    return UniformTexture;\n  }(Uniform);\n\n  exports.UniformTexture = UniformTexture;\n\n  var Uniforms =\n  /*#__PURE__*/\n  function (_common_1$default) {\n    _inherits(Uniforms, _common_1$default);\n\n    function Uniforms() {\n      var _this2;\n\n      _classCallCheck(this, Uniforms);\n\n      _this2 = _possibleConstructorReturn(this, _getPrototypeOf(Uniforms).apply(this, arguments));\n      _this2.dirty = false;\n      return _this2;\n    }\n\n    _createClass(Uniforms, [{\n      key: \"clean\",\n      value: function clean() {\n        for (var key in this.values) {\n          this.values[key].dirty = false;\n        }\n\n        this.dirty = false;\n      }\n    }, {\n      key: \"setParse\",\n      value: function setParse(key) {\n        for (var _len = arguments.length, values = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          values[_key - 1] = arguments[_key];\n        }\n\n        var uniform = Uniforms.parseUniform.apply(Uniforms, [key].concat(values));\n\n        if (uniform) {\n          this.set(key, uniform);\n        }\n\n        return uniform;\n      }\n    }, {\n      key: \"create\",\n      value: function create(method, type, key) {\n        for (var _len2 = arguments.length, values = new Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {\n          values[_key2 - 3] = arguments[_key2];\n        }\n\n        var uniform = new Uniform({\n          method: method,\n          type: type,\n          key: key,\n          values: values\n        });\n        this.set(key, uniform);\n        this.dirty = true;\n        return uniform;\n      }\n    }, {\n      key: \"createTexture\",\n      value: function createTexture(key, index) {\n        var uniform = new UniformTexture({\n          method: UniformMethod.Uniform1i,\n          type: UniformType.Sampler2D,\n          key: key,\n          values: [index]\n        });\n        this.set(key, uniform);\n        this.dirty = true;\n        return uniform; // const uniform = this.setParse(key, url) as UniformTexture; // !!!\n        // console.log(uniform.type, key, url);\n\n        /*\n        if (uniform.type === 'sampler2D') {\n            // console.log(u, uniform);\n            // For textures, we need to track texture units, so we have a special setter\n            // this.uniformTexture(uniform.key, uniform.value[0]);\n            if (uniform.method === '1iv') {\n                // todo\n                uniform.values.map((\n                    urlElementOrData: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | TextureData,\n                    i: number\n                ) => this.uniformTexture(uniform.key + i, urlElementOrData));\n            } else {\n                this.uniformTexture(uniform.key, uniform.values[0]);\n            }\n        }\n        */\n\n        return uniform;\n      }\n    }, {\n      key: \"update\",\n      value: function update(method, type, key) {\n        var uniform = this.get(key);\n\n        for (var _len3 = arguments.length, values = new Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {\n          values[_key3 - 3] = arguments[_key3];\n        }\n\n        if (uniform && (uniform.method !== method || uniform.type !== type || uniform.values !== values)) {\n          uniform.method = method;\n          uniform.type = type;\n          uniform.values = values;\n          uniform.dirty = true;\n          this.dirty = true;\n        }\n      }\n    }, {\n      key: \"createOrUpdate\",\n      value: function createOrUpdate(method, type, key) {\n        for (var _len4 = arguments.length, values = new Array(_len4 > 3 ? _len4 - 3 : 0), _key4 = 3; _key4 < _len4; _key4++) {\n          values[_key4 - 3] = arguments[_key4];\n        }\n\n        if (this.has(key)) {\n          this.update.apply(this, [method, type, key].concat(values));\n        } else {\n          this.create.apply(this, [method, type, key].concat(values));\n        }\n      }\n    }, {\n      key: \"apply\",\n      value: function apply(gl, program) {\n        for (var key in this.values) {\n          this.values[key].apply(gl, program);\n        } // this.forEach(uniform => uniform.apply(gl, program));\n\n      }\n    }], [{\n      key: \"isArrayOfNumbers\",\n      value: function isArrayOfNumbers(array) {\n        return array.reduce(function (flag, value) {\n          return flag && typeof value === 'number';\n        }, true);\n      }\n    }, {\n      key: \"parseUniform\",\n      value: function parseUniform(key) {\n        for (var _len5 = arguments.length, values = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n          values[_key5 - 1] = arguments[_key5];\n        }\n\n        var value = values.length === 1 ? values[0] : values;\n        var uniform; // console.log(key, value);\n        // Single float\n\n        if (typeof value === 'number') {\n          uniform = new Uniform({\n            method: UniformMethod.Uniform1f,\n            type: UniformType.Float,\n            key: key,\n            values: [value]\n          });\n        } else if (typeof value === 'boolean') {\n          // Boolean\n          uniform = new Uniform({\n            method: UniformMethod.Uniform1i,\n            type: UniformType.Bool,\n            key: key,\n            values: [value]\n          });\n        } else if (textures_1.Texture.isTexture(value)) {\n          // Texture\n          uniform = new Uniform({\n            method: UniformMethod.Uniform1i,\n            type: UniformType.Sampler2D,\n            key: key,\n            values: value // !!!\n\n          });\n        } else if (Array.isArray(value)) {\n          // Array: vector, array of floats, array of textures, or array of structs\n          // Numeric values\n          if (Uniforms.isArrayOfNumbers(value)) {\n            switch (value.length) {\n              case 1:\n                uniform = new Uniform({\n                  method: UniformMethod.Uniform1f,\n                  type: UniformType.Float,\n                  key: key,\n                  values: value\n                });\n                break;\n\n              case 2:\n                uniform = new Uniform({\n                  method: UniformMethod.Uniform2fv,\n                  type: UniformType.FloatVec2,\n                  key: key,\n                  values: value\n                });\n                break;\n\n              case 3:\n                uniform = new Uniform({\n                  method: UniformMethod.Uniform3fv,\n                  type: UniformType.FloatVec3,\n                  key: key,\n                  values: value\n                });\n                break;\n\n              case 4:\n                uniform = new Uniform({\n                  method: UniformMethod.Uniform4fv,\n                  type: UniformType.FloatVec4,\n                  key: key,\n                  values: value\n                });\n                break;\n\n              default:\n                // float array\n                uniform = new Uniform({\n                  method: UniformMethod.Uniform1fv,\n                  type: UniformType.FloatArray,\n                  key: key,\n                  values: value\n                });\n            } // TODO: assume matrix for (typeof == Float32Array && length == 16)?\n\n          } else if (textures_1.Texture.getTextureOptions(value[0])) {\n            // Array of textures\n            uniform = new Uniform({\n              method: UniformMethod.Uniform1iv,\n              type: UniformType.Sampler2D,\n              key: key,\n              values: value\n            });\n          } else if (Array.isArray(value[0]) && typeof value[0][0] === 'number') {\n            // Array of arrays - but only arrays of vectors are allowed in this case\n            // float vectors (vec2, vec3, vec4)\n            if (value[0].length >= 2 && value[0].length <= 4) {\n              // Set each vector in the array\n              for (var u = 0; u < value.length; u++) {\n                switch (value.length) {\n                  case 2:\n                    uniform = new Uniform({\n                      method: UniformMethod.Uniform2fv,\n                      type: UniformType.FloatVec2,\n                      key: key + '[' + u + ']',\n                      values: value\n                    });\n                    break;\n\n                  case 3:\n                    uniform = new Uniform({\n                      method: UniformMethod.Uniform3fv,\n                      type: UniformType.FloatVec3,\n                      key: key + '[' + u + ']',\n                      values: value\n                    });\n                    break;\n\n                  case 4:\n                    uniform = new Uniform({\n                      method: UniformMethod.Uniform4fv,\n                      type: UniformType.FloatVec4,\n                      key: key + '[' + u + ']',\n                      values: value\n                    });\n                    break;\n                }\n              }\n            } // else error?\n\n          } else if (_typeof(value[0]) === 'object') {\n            // Array of structures\n            for (var _u = 0; _u < value.length; _u++) {// Set each struct in the array\n              // !!! uniform = new Uniform(...Uniforms.parseUniforms(value[u], key + '[' + u + ']'));\n            }\n          }\n        } else if (_typeof(value) === 'object') {} // Structure\n        // Set each field in the struct\n        // !!! uniform = new Uniform(...Uniforms.parseUniforms(value, key));\n        // TODO: support other non-float types? (int, etc.)\n\n\n        return uniform;\n      }\n    }, {\n      key: \"parseUniforms\",\n      value: function parseUniforms(values, prefix) {\n        var uniforms = new Map();\n\n        for (var key in values) {\n          var value = values[key];\n\n          if (prefix) {\n            key = prefix + '.' + key;\n          }\n\n          var uniform = Uniforms.parseUniform(key, value);\n\n          if (uniform) {\n            uniforms.set(key, uniform);\n          }\n        }\n\n        return uniforms;\n      }\n    }]);\n\n    return Uniforms;\n  }(common_1.default);\n\n  exports.default = Uniforms;\n});\n\n},{\"./common\":2,\"./textures\":6}]},{},[4]);\n\n//# sourceMappingURL=glsl-canvas.js.map\n"]}