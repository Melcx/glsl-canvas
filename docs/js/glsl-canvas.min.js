!function o(a,s,u){function f(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return f(a[t][1][e]||e)},i,i.exports,o,a,s,u)}return s[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)f(u[e]);return f}({1:[function(e,t,r){var n,i;n=this,i=function(s){"use strict";var r="URLSearchParams"in self,n="Symbol"in self&&"iterator"in Symbol,u="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in self,o="ArrayBuffer"in self;if(o)var t=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(e){return e&&-1<t.indexOf(Object.prototype.toString.call(e))};function f(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function e(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function l(t){this.map={},t instanceof l?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(r){return new Promise(function(e,t){r.onload=function(){e(r.result)},r.onerror=function(){t(r.error)}})}function p(e){var t=new FileReader,r=d(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){var t;(this._bodyInit=e)?"string"==typeof e?this._bodyText=e:u&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():o&&u&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e,t,r,n=h(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=d(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(e,t){e=f(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},l.prototype.delete=function(e){delete this.map[f(e)]},l.prototype.get=function(e){return e=f(e),this.has(e)?this.map[e]:null},l.prototype.has=function(e){return this.map.hasOwnProperty(f(e))},l.prototype.set=function(e,t){this.map[f(e)]=c(t)},l.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},l.prototype.keys=function(){var r=[];return this.forEach(function(e,t){r.push(t)}),e(r)},l.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),e(t)},l.prototype.entries=function(){var r=[];return this.forEach(function(e,t){r.push([t,e])}),e(r)},n&&(l.prototype[Symbol.iterator]=l.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function g(e,t){var r,n,i=(t=t||{}).body;if(e instanceof g){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),-1<m.indexOf(n)?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function b(e){var i=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),r=t.shift().replace(/\+/g," "),n=t.join("=").replace(/\+/g," ");i.append(decodeURIComponent(r),decodeURIComponent(n))}}),i}function E(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},v.call(g.prototype),v.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},E.error=function(){var e=new E(null,{status:0,statusText:""});return e.type="error",e};var T=[301,302,303,307,308];E.redirect=function(e,t){if(-1===T.indexOf(t))throw new RangeError("Invalid status code");return new E(null,{status:t,headers:{location:e}})},s.DOMException=self.DOMException;try{new s.DOMException}catch(e){s.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function x(i,a){return new Promise(function(n,e){var t=new g(i,a);if(t.signal&&t.signal.aborted)return e(new s.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function r(){o.abort()}o.onload=function(){var e,i,t={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",i=new l,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),r=t.shift().trim();if(r){var n=t.join(":").trim();i.append(r,n)}}),i)};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var r="response"in o?o.response:o.responseText;n(new E(r,t))},o.onerror=function(){e(new TypeError("Network request failed"))},o.ontimeout=function(){e(new TypeError("Network request failed"))},o.onabort=function(){e(new s.DOMException("Aborted","AbortError"))},o.open(t.method,t.url,!0),"include"===t.credentials?o.withCredentials=!0:"omit"===t.credentials&&(o.withCredentials=!1),"responseType"in o&&u&&(o.responseType="blob"),t.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),t.signal&&(t.signal.addEventListener("abort",r),o.onreadystatechange=function(){4===o.readyState&&t.signal.removeEventListener("abort",r)}),o.send(void 0===t._bodyInit?null:t._bodyInit)})}x.polyfill=!0,self.fetch||(self.fetch=x,self.Headers=l,self.Request=g,self.Response=E),s.Headers=l,s.Request=g,s.Response=E,s.fetch=x,Object.defineProperty(s,"__esModule",{value:!0})},"object"==typeof r&&void 0!==t?i(r):"function"==typeof define&&define.amd?define(["exports"],i):i(n.WHATWGFetch={})},{}],2:[function(r,n,i){"use strict";function o(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function a(e){var n="function"==typeof Map?new Map:void 0;return(a=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return s(e,arguments,d(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),h(r,e)})(e)}function s(e,t,r){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&h(i,r.prototype),i}).apply(null,arguments)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c=function(e){return e&&e.__esModule?e:{default:e}};!function(e){if("object"===(void 0===n?"undefined":f(n))&&"object"===f(n.exports)){var t=e(r,i);void 0!==t&&(n.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./context"],e)}(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var u=c(e("./context")),f=function(){function a(e,t,r,n){p(this,a),e.getExtension("OES_texture_float"),e.activeTexture(e.TEXTURE0+n);var i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.FLOAT,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var o=e.createFramebuffer();this.texture=i,this.buffer=o,this.BW=t,this.BH=r,this.index=n}return y(a,[{key:"resize",value:function(e,t,r){if(t!==this.BW||r!==this.BH){var n=this.buffer,i=this.texture,o=this.index;e.bindFramebuffer(e.FRAMEBUFFER,n);var a,s=e.checkFramebufferStatus(e.FRAMEBUFFER),u=Math.min(t,this.BW),f=Math.min(r,this.BH);s===e.FRAMEBUFFER_COMPLETE&&(a=new Float32Array(u*f*4),e.readPixels(0,0,u,f,e.RGBA,e.FLOAT,a)),e.bindFramebuffer(e.FRAMEBUFFER,null);var c=e.createTexture(),l=o+1;e.activeTexture(e.TEXTURE0+l),e.bindTexture(e.TEXTURE_2D,c),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.FLOAT,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),a&&e.texSubImage2D(e.TEXTURE_2D,0,0,0,u,f,e.RGBA,e.FLOAT,a);var h=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(i),e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,c),this.index=o,this.texture=c,this.buffer=h,this.BW=t,this.BH=r}}}]),a}();t.Buffer=f;var l=function(){function i(e,t,r,n){p(this,i),this.isValid=!1,this.index=e,this.key=t,this.vertexString=r,this.fragmentString=n}return y(i,[{key:"create",value:function(e,t,r){var n=u.default.createShader(e,this.vertexString,e.VERTEX_SHADER),i=u.default.createShader(e,this.fragmentString,e.FRAGMENT_SHADER,1);this.isValid=!!i||(i=u.default.createShader(e,"void main(){\n\tgl_FragColor = vec4(1.0);\n}",e.FRAGMENT_SHADER),!1);var o=u.default.createProgram(e,[n,i]),a=new f(e,t,r,this.index+0),s=new f(e,t,r,this.index+2);this.program=o,this.input=a,this.output=s,e.deleteShader(n),e.deleteShader(i)}},{key:"render",value:function(e,t,r){e.useProgram(this.program),e.viewport(0,0,t,r),e.bindFramebuffer(e.FRAMEBUFFER,this.output.buffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.output.texture,0),e.drawArrays(e.TRIANGLES,0,6);var n=this.input,i=this.output,o=n;this.input=i,this.output=o}},{key:"resize",value:function(e,t,r){e.useProgram(this.program),e.viewport(0,0,t,r),this.input.resize(e,t,r),this.output.resize(e,t,r)}},{key:"destroy",value:function(e){e.deleteProgram(this.program),this.program=null,this.input=null,this.output=null}}]),i}();t.IOBuffer=l;var r=function(e){function c(){return p(this,c),o(this,d(c).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(c,a(Map)),y(c,[{key:"count",get:function(){return 4*this.size}}],[{key:"getBuffers",value:function(e,t,r){var n=new c,i=0;if(t)for(var o,a=/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm;null!==(o=a.exec(t));){var s=o[3]||o[4],u="u_buffer"+s,f=new l(i,u,r,"#define BUFFER_"+s+"\n"+t);f.create(e,e.drawingBufferWidth,e.drawingBufferHeight),n.set(u,f),i+=4}return n}}]),c}();t.default=r})},{"./context":3}],3:[function(r,n,i){"use strict";function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){if("object"===(void 0===n?"undefined":o(n))&&"object"===o(n.exports)){var t=e(r,i);void 0!==t&&(n.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,t){var o,r;Object.defineProperty(t,"__esModule",{value:!0}),(r=o=t.ContextError||(t.ContextError={}))[r.BrowserSupport=1]="BrowserSupport",r[r.Other=2]="Other";var a=function e(){f(this,e)};t.ContextVertexBuffers=a;var n=function(){function s(){f(this,s)}var e,t,r;return e=s,r=[{key:"tryGetContext",value:function(n,e,i){function t(e,t){if("function"==typeof i)i(e);else{var r=n.parentNode;r&&(r.innerHTML='<div class="glsl-canvas--error">'.concat(t,"</div>"))}}if(!WebGLRenderingContext)return t(o.BrowserSupport,'This page requires a browser that supports WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var r=s.getContext(n,e);return r?r.getExtension("OES_standard_derivatives"):t(o.Other,'It does not appear your computer can support WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'),r}},{key:"getContext",value:function(e,t){for(var r=["webgl","experimental-webgl"],n=null,i=0;i<r.length;++i)try{n=e.getContext(r[i],t)}catch(e){if(n)break}return n}},{key:"createShader",value:function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,i=e.createShader(r);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw s.lastError=e.getShaderInfoLog(i),console.error("*** Error compiling shader "+i+":"+s.lastError),e.deleteShader(i),{shader:i,source:t,type:r,error:s.lastError,offset:n};return i}},{key:"createProgram",value:function(e,t,r,n){for(var i=e.createProgram(),o=0;o<t.length;++o)e.attachShader(i,t[o]);if(r&&n)for(var a=0;a<r.length;++a)e.bindAttribLocation(i,n?n[a]:a,r[a]);return e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?i:(s.lastError=e.getProgramInfoLog(i),console.log("Error in program linking:"+s.lastError),e.deleteProgram(i),null)}},{key:"createVertexBuffers",value:function(e,t){var r=new a,n=e.getAttribLocation(t,"a_texcoord");r.texcoord=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.texcoord),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);var i=e.getAttribLocation(t,"a_position");return r.position=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.position),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),r}}],(t=null)&&u(e.prototype,t),r&&u(e,r),s}();n.lastError="",t.default=n})},{}],4:[function(r,n,i){"use strict";function c(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var m=function(e){return e&&e.__esModule?e:{default:e}},g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};!function(e){if("object"===(void 0===n?"undefined":a(n))&&"object"===a(n.exports)){var t=e(r,i);void 0!==t&&(n.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","whatwg-fetch","./buffers","./context","./listener.subscriber","./textures","./uniforms"],e)}(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),e("whatwg-fetch");var a=m(e("./buffers")),s=m(e("./context")),r=m(e("./listener.subscriber")),u=g(e("./textures")),f=m(e("./uniforms"));t.GlslCanvasOptions=function e(){v(this,e)};var h=function(){function e(){v(this,e),this.delay=0,this.current=0,this.delta=0,this.paused=!1,this.start=this.previous=performance.now()/1e3}return y(e,[{key:"play",value:function(){if(this.previous){var e=performance.now()/1e3;this.delay+=e-this.previous,this.previous=e}this.paused=!1}},{key:"pause",value:function(){this.paused=!0}},{key:"next",value:function(){var e=performance.now()/1e3;return this.delta=e-this.previous,this.current=e-this.start-this.delay,this.previous=e,this}}]),e}();t.GlslCanvasTimer=h;var n=function(e){function o(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(v(this,o),(t=l(this,d(o).call(this))).dirty=!0,t.animated=!1,t.nDelta=0,t.nTime=0,t.nDate=0,t.nMouse=0,t.textureList=[],t.textures=new u.default,t.buffers=new a.default,t.uniforms=new f.default,t.mouse={x:0,y:0},t.valid=!1,t.visible=!1,!e)return l(t);t.canvas=e,t.width=e.clientWidth,t.height=e.clientHeight,t.rect=e.getBoundingClientRect(),t.vertexString=r.vertexString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n\tgl_Position = vec4(a_position, 0.0, 1.0);\n\tv_texcoord = a_texcoord;\n}\n",t.fragmentString=r.fragmentString||"\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n\tgl_FragColor = vec4(0.0);\n}\n";var i=s.default.tryGetContext(e,r,n.onError);return i?(t.gl=i,t.pixelRatio=window.devicePixelRatio||1,e.style.backgroundColor=r.backgroundColor||"rgba(0,0,0,0)",t.getShaders().then(function(e){t.load(),t.program&&(t.addListeners(),t.loop())},function(e){console.log("error",e)}),t):l(t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(o,r.default),y(o,[{key:"getShaders",value:function(){var i=this;return new Promise(function(t,e){var r=i.canvas,n={};r.hasAttribute("data-vertex-url")&&(n.vertex=r.getAttribute("data-vertex-url")),r.hasAttribute("data-fragment-url")&&(n.fragment=r.getAttribute("data-fragment-url")),r.hasAttribute("data-vertex")&&(i.vertexString=r.getAttribute("data-vertex")),r.hasAttribute("data-fragment")&&(i.fragmentString=r.getAttribute("data-fragment")),Object.keys(n).length?Promise.all(Object.keys(n).map(function(t,e){var r=n[t];return fetch(r).then(function(e){return e.text()}).then(function(e){return"vertex"===t?i.vertexString=e:i.fragmentString=e})})).then(function(e){t([i.vertexString,i.fragmentString])}):t([i.vertexString,i.fragmentString])})}},{key:"addListeners",value:function(){var r=this,e=function(e){r.rect=r.canvas.getBoundingClientRect()},t=function(e){r.rect=r.canvas.getBoundingClientRect()},n=function(e){r.mouse.x=e.clientX||e.pageX,r.mouse.y=e.clientY||e.pageY},i=function(e){r.toggle()};this.resize=e,this.scroll=t,this.mousemove=n,this.click=i,this.loop=function e(t){r.checkRender(),window.requestAnimationFrame(e)},window.addEventListener("resize",e),window.addEventListener("scroll",t),document.addEventListener("mousemove",n,!1),this.canvas.hasAttribute("controls")&&(this.canvas.addEventListener("click",i),this.canvas.hasAttribute("data-autoplay")||this.pause())}},{key:"load",value:function(e,t){t&&(this.vertexString=t),e&&(this.fragmentString=e);var r=this.gl,n=s.default.createShader(r,this.vertexString,r.VERTEX_SHADER),i=s.default.createShader(r,this.fragmentString,r.FRAGMENT_SHADER);this.valid=!!i||(i=s.default.createShader(r,"void main(){\n\t\t\t\tgl_FragColor = vec4(1.0);\n\t\t\t}",r.FRAGMENT_SHADER),!1);var o=s.default.createProgram(r,[n,i]);r.useProgram(o),r.deleteShader(n),r.deleteShader(i),this.program=o,this.valid&&(this.buffers=a.default.getBuffers(r,this.fragmentString,this.vertexString),this.vertexBuffers=s.default.createVertexBuffers(r,o),this.createUniforms()),this.trigger("load",{})}},{key:"test",value:function(l,h){var d=this;return new Promise(function(i,e){var o=d.vertexString,a=d.fragmentString,s=d.timer.paused,u=d.gl.getExtension("EXT_disjoint_timer_query"),f=u.createQueryEXT(),c=d.valid;(l||h)&&(d.load(l,h),c=d.valid,d.render()),d.timer.paused=!0,u.beginQueryEXT(u.TIME_ELAPSED_EXT,f),d.render(),u.endQueryEXT(u.TIME_ELAPSED_EXT);!function e(){d.render();var t=u.getQueryObjectEXT(f,u.QUERY_RESULT_AVAILABLE_EXT),r=d.gl.getParameter(u.GPU_DISJOINT_EXT);if(t&&!r){var n={wasValid:c,fragment:l||d.fragmentString,vertex:h||d.vertexString,timeElapsedMs:u.getQueryObjectEXT(f,u.QUERY_RESULT_EXT)/1e6};d.timer.paused=s,(l||h)&&d.load(a,o),i(n)}else window.requestAnimationFrame(e)}()})}},{key:"destroy",value:function(){this.animated=!1,this.valid=!1;var t=this.gl;t.useProgram(null),t.deleteProgram(this.program),this.buffers.forEach(function(e){return e.destroy(t)}),this.buffers=null,this.textures=null,this.uniforms=null,this.program=null,this.gl=null}},{key:"setUniform",value:function(e){for(var t,r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o=(t=f.default).parseUniform.apply(t,[e].concat(n));o&&("sampler2D"===o.type?this.loadTexture(e,n[0]):this.uniforms.set(e,o))}},{key:"setUniforms",value:function(e){var r=this;e.forEach(function(e,t){r.setUniform.apply(r,[t].concat(c(e)))})}},{key:"pause",value:function(){this.valid&&(this.timer.pause(),this.canvas.classList.add("paused"))}},{key:"play",value:function(){this.valid&&(this.timer.play(),this.canvas.classList.remove("paused"))}},{key:"toggle",value:function(){this.valid&&(this.timer.paused?this.play():this.pause())}},{key:"isVisible",value:function(){var e=this.rect;return 0<e.top+e.height&&e.top<(window.innerHeight||document.documentElement.clientHeight)}},{key:"isAnimated",value:function(){return(this.animated||this.textures.animated)&&!this.timer.paused}},{key:"isDirty",value:function(){return this.dirty||this.uniforms.dirty||this.textures.dirty}},{key:"sizeDidChanged",value:function(){var t=this.gl,e=this.rect,r=e.width,n=e.height;if(this.width===r&&this.height===n)return!1;this.width=r,this.height=n;var i=Math.floor(r*this.pixelRatio),o=Math.floor(n*this.pixelRatio);return t.canvas.width===i&&t.canvas.height===o||(t.canvas.width=i,t.canvas.height=o),this.buffers.forEach(function(e){e.resize(t,i,o)}),!0}},{key:"checkRender",value:function(){this.isVisible()&&(this.sizeDidChanged()||this.isAnimated()||this.isDirty())?(this.render(),this.canvas.classList.add("playing")):this.canvas.classList.remove("playing")}},{key:"createUniforms",value:function(){var t=this,e=this.gl,r=this.fragmentString,n=e.drawingBufferWidth,i=e.drawingBufferHeight,o=this.timer=new h,a=1<(r.match(/u_delta/g)||[]).length,s=1<(r.match(/u_time/g)||[]).length,u=1<(r.match(/u_date/g)||[]).length,f=1<(r.match(/u_mouse/g)||[]).length,c=this.parseTextures(r);if(this.animated=s||u||f,this.animated?this.canvas.classList.add("animated"):this.canvas.classList.remove("animated"),this.uniforms.create("2f","vec2","u_resolution",n,i),a&&this.uniforms.create("1f","float","u_delta",o.delta),s&&this.uniforms.create("1f","float","u_time",o.current),u){var l=new Date;this.uniforms.create("4f","float","u_date",l.getFullYear(),l.getMonth(),l.getDate(),3600*l.getHours()+60*l.getMinutes()+l.getSeconds()+.001*l.getMilliseconds())}f&&this.uniforms.create("2f","vec2","u_mouse",0,0),this.buffers.forEach(function(e){t.uniforms.create("1i","sampler2D",e.key,e.input.index)}),c&&this.textureList.forEach(function(e){t.loadTexture(e.key,e.url)})}},{key:"parseTextures",value:function(e){var n=this;if(e.search(/sampler2D/g))for(var t=e.split("\n"),r=0;r<t.length;r++){var i=t[r].match(/uniform\s*sampler2D\s*([\w]*);\s*\/\/\s*([\w|\:\/\/|\.|\-|\_]*)/i);if(i){var o=i[2].split(".").pop().toLowerCase(),a=i[1],s=i[2];a&&s&&-1!==u.TextureExtensions.indexOf(o)&&this.textureList.push({key:a,url:s})}if(t[r].match(/\s*void\s*main\s*/g))break}this.canvas.hasAttribute("data-textures")&&this.canvas.getAttribute("data-textures").split(",").forEach(function(e,t){var r="u_tex"+t;n.textureList.push({key:r,url:e})});return 0<this.textureList.length}},{key:"loadTexture",value:function(r,e){var n=this;if(this.valid)return this.textures.createOrUpdate(this.gl,r,e,this.buffers.count).then(function(e){var t=e.index;n.uniforms.createTexture(r,t).texture=e;n.uniforms.create("2f","vec2",r+"Resolution",e.width,e.height);return e});this.textureList.push({key:r,url:e})}},{key:"updateUniforms",value:function(){var t=this,r=this.gl,e=r.drawingBufferWidth,n=r.drawingBufferHeight,i=this.timer.next();if(this.uniforms.update("2f","vec2","u_resolution",e,n),this.uniforms.has("u_delta")&&this.uniforms.update("1f","float","u_delta",i.delta),this.uniforms.has("u_time")&&this.uniforms.update("1f","float","u_time",i.current),this.uniforms.has("u_date")){var o=new Date;this.uniforms.update("4f","float","u_date",o.getFullYear(),o.getMonth(),o.getDate(),3600*o.getHours()+60*o.getMinutes()+o.getSeconds()+.001*o.getMilliseconds())}if(this.uniforms.has("u_mouse")){var a=this.rect,s=this.mouse;if(s.x>=a.left&&s.x<=a.right&&s.y>=a.top&&s.y<=a.bottom){var u=(s.x-a.left)*this.pixelRatio,f=this.canvas.height-(s.y-a.top)*this.pixelRatio;this.uniforms.update("2f","vec2","u_mouse",u,f)}}this.buffers.forEach(function(e){t.uniforms.update("1i","sampler2D",e.key,e.input.index)}),this.textures.forEach(function(e){e.tryUpdate(r),t.uniforms.update("1i","sampler2D",e.key,e.index)})}},{key:"render",value:function(){var t=this,r=this.gl,n=r.drawingBufferWidth,i=r.drawingBufferHeight;this.updateUniforms(),this.buffers.forEach(function(e){t.uniforms.apply(r,e.program),e.render(r,n,i)}),r.useProgram(this.program),this.uniforms.apply(r,this.program),r.viewport(0,0,n,i),r.bindFramebuffer(r.FRAMEBUFFER,null),r.drawArrays(r.TRIANGLES,0,6),this.uniforms.forEach(function(e){return e.dirty=!1}),this.uniforms.dirty=!1,this.textures.forEach(function(e){return e.dirty=!1}),this.textures.dirty=!1,this.dirty=!1,this.trigger("render",{})}}],[{key:"version",value:function(){return"0.1.8"}},{key:"isDifferent",value:function(e,t){return!(!e||!t)&&e.toString()!==t.toString()}}]),o}();t.default=n,window.GlslCanvas=n;window.addEventListener("load",function(){var e;e=Array.from(document.getElementsByClassName("glslCanvas")).filter(function(e){return e instanceof HTMLCanvasElement}),window.glslCanvases=e.map(function(e){return new n(e)}).filter(function(e){return e.valid})})})},{"./buffers":2,"./context":3,"./listener.subscriber":5,"./textures":6,"./uniforms":7,"whatwg-fetch":1}],5:[function(r,n,i){"use strict";function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){if("object"===(void 0===n?"undefined":s(n))&&"object"===s(n.exports)){var t=e(r,i);void 0!==t&&(n.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports"],e)}(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function e(t,r){a(this,e),this.event=t,this.callback=r};t.Listener=i;var r=function(){function e(){a(this,e),this.listeners=new Set}var t,r,n;return t=e,(r=[{key:"listSubscriptions",value:function(){this.listeners.forEach(function(e){return console.log(e)})}},{key:"subscribe",value:function(e){this.listeners.add(e)}},{key:"unsubscribe",value:function(e){this.listeners.delete(e)}},{key:"unsubscribeAll",value:function(){this.listeners.clear()}},{key:"on",value:function(e,t){return this.listeners.add(new i(e,t)),this}},{key:"off",value:function(t,e){var r=this;return e?this.listeners.delete(new i(t,e)):this.listeners.forEach(function(e){e.event===t&&r.listeners.delete(e)}),this}},{key:"trigger",value:function(t){for(var e=arguments.length,r=new Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.listeners.forEach(function(e){e.event===t&&"function"==typeof e.callback&&e.callback.apply(e,r)}),this}}])&&o(t.prototype,r),n&&o(t,n),e}();t.default=r})},{}],6:[function(r,n,i){"use strict";function l(e){var n="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return o(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function o(e,t,r){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&s(i,r.prototype),i}).apply(null,arguments)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}function d(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var m=function(e){return e&&e.__esModule?e:{default:e}};!function(e){if("object"===(void 0===n?"undefined":u(n))&&"object"===u(n.exports)){var t=e(r,i);void 0!==t&&(n.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./listener.subscriber"],e)}(function(e,u){Object.defineProperty(u,"__esModule",{value:!0});var f,t,a,r,n=m(e("./listener.subscriber"));u.TextureImageExtensions=["jpg","jpeg","png"],u.TextureVideoExtensions=["ogv","webm","mp4"],u.TextureExtensions=u.TextureImageExtensions.concat(u.TextureVideoExtensions),(t=f||(f={}))[t.Data=0]="Data",t[t.Element=1]="Element",t[t.Url=2]="Url",(r=a||(a={})).MipMap="mipmap",r.Linear="linear",r.Nearest="nearest";var i=function e(){v(this,e)};u.TextureData=i;var o=function e(){v(this,e)};u.TextureOptions=o;var c=function(e){function s(e,t,r){var n,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new o;return v(this,s),(n=d(this,p(s).call(this))).valid=!1,n.dirty=!1,n.animated=!1,n.powerOf2=!1,n.key=t,n.index=r,n.options=i,n.create(e),n}return y(s,n.default),h(s,[{key:"create",value:function(e){this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.setData(e,1,1,new Uint8Array([0,0,0,0]),{filtering:a.Linear})}},{key:"load",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof(this.options=t).url?void 0===this.url||t.url!==this.url?this.setUrl(e,t.url,t):Promise.resolve(this):t.element?this.setElement(e,t.element,t):t.data&&t.width&&t.height?this.setData(e,t.width,t.height,t.data,t):void 0}},{key:"setUrl",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this.valid){this.url=t,this.source=t,this.sourceType=f.Url,this.options=Object.assign(this.options,r);var n,i,o=t.split(".").pop().toLowerCase(),a=-1!==u.TextureVideoExtensions.indexOf(o);return n.src=(a?(n=document.createElement("video"),i=this.setElement(e,n,r),n.setAttribute("playsinline","true"),n.autoplay=!0,n.muted=!0):(n=new Image,i=this.setElement(e,n,r),s.isSafari()&&"data:"===t.slice(0,5)||(n.crossOrigin="anonymous")),t),i}}},{key:"setElement",value:function(o,a){var s=this,u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.options=Object.assign(this.options,u),new Promise(function(t,r){var e=a;if("string"==typeof a&&(a=document.querySelector(a)),a instanceof HTMLCanvasElement||a instanceof HTMLImageElement||a instanceof HTMLVideoElement)if(s.source=a,s.sourceType=f.Element,a instanceof HTMLVideoElement){var n=a;n.addEventListener("loadeddata",function(e){s.update(o,u),s.setFiltering(o,u),t(s)}),n.addEventListener("error",function(e){r(e)})}else a instanceof HTMLImageElement?(a.addEventListener("load",function(){s.update(o,u),s.setFiltering(o,u),t(s)}),a.addEventListener("error",function(e){r(e)})):(s.update(o,u),s.setFiltering(o,u),t(s));else{var i="the 'element' parameter (`element: ".concat(JSON.stringify(e),"`) must be a CSS selector string, or a <canvas>, <image> or <video> object");console.log("Texture '".concat(s.key,"': ").concat(i),u),r(i)}})}},{key:"setData",value:function(e,t,r,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};return this.width=t,this.height=r,this.options=Object.assign(this.options,i),this.source=n,this.sourceType=f.Data,this.update(e,i),this.setFiltering(e,i),Promise.resolve(this)}},{key:"update",value:function(e,t){if(this.valid){if(e.activeTexture(e.TEXTURE0+this.index),e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1===t.UNPACK_FLIP_Y_WEBGL?0:1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL||0),this.sourceType===f.Element)this.source instanceof HTMLImageElement&&this.source.naturalWidth&&this.source.naturalHeight?(this.width=this.source.naturalWidth,this.height=this.source.naturalHeight,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLVideoElement&&this.source.videoWidth&&this.source.videoHeight?(this.width=this.source.videoWidth,this.height=this.source.videoHeight,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLCanvasElement&&(this.width=this.source.width,this.height=this.source.height,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.source));else if(this.sourceType===f.Data){var r=this.source;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,r)}this.trigger("loaded",this)}}},{key:"tryUpdate",value:function(e){var t=!1;return this.animated&&(t=!0,this.update(e,this.options)),t}},{key:"destroy",value:function(e){this.valid&&(e.deleteTexture(this.texture),this.texture=null,delete this.source,this.source=null,this.valid=!1)}},{key:"setFiltering",value:function(e,t){if(this.valid){var r=s.isPowerOf2(this.width)&&s.isPowerOf2(this.height),n=t.filtering||a.MipMap,i=t.TEXTURE_WRAP_S||t.repeat&&e.REPEAT||e.CLAMP_TO_EDGE,o=t.TEXTURE_WRAP_T||t.repeat&&e.REPEAT||e.CLAMP_TO_EDGE;r||(n=n===a.MipMap?a.Linear:n,i=o=e.CLAMP_TO_EDGE),this.powerOf2=r,this.filtering=n,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o),this.filtering===a.MipMap?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):this.filtering===a.Nearest?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):this.filtering===a.Linear&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR))}}}],[{key:"isPowerOf2",value:function(e){return 0==(e&e-1)}},{key:"isSafari",value:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}},{key:"isTextureUrl",value:function(e){return/\.(jpg|jpeg|png|ogv|webm|mp4)$/i.test(e)}},{key:"isTexture",value:function(e){return void 0!==s.getTextureOptions(e)}},{key:"getMaxTextureSize",value:function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)}},{key:"getTextureOptions",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){if(s.isTextureUrl(e))return t.url=e,t;document&&(e=document.querySelector(e))}return e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement?(t.element=e,t):e instanceof i?(t.data=e.data,t.width=e.width,t.height=e.height,t):void 0}}]),s}();u.Texture=c;var s=function(e){function t(){var e;return v(this,t),(e=d(this,p(t).apply(this,arguments))).count=0,e.dirty=!1,e.animated=!1,e}return y(t,l(Map)),h(t,[{key:"createOrUpdate",value:function(r,e,t){var n,i=this,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},s=c.getTextureOptions(t,a);return void 0!==s?((n=this.get(e))||(n=new c(r,e,o+this.count,s),this.count++,this.set(e,n)),n.load(r,s).then(function(e){if(e.source instanceof HTMLVideoElement){var t=e.source;t.addEventListener("play",function(){e.animated=!0,i.animated=!0}),t.addEventListener("pause",function(){e.animated=!1,i.animated=Array.from(i.values()).reduce(function(e,t){return e||t.animated},!1)}),t.addEventListener("seeked",function(){e.update(r,e.options),i.dirty=!0})}return e})):Promise.reject(null)}}]),t}();u.default=s})},{"./listener.subscriber":5}],7:[function(r,n,i){"use strict";function o(e){var n="function"==typeof Map?new Map:void 0;return(o=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return a(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)})(e)}function a(e,t,r){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&u(i,r.prototype),i}).apply(null,arguments)}function s(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){if("object"===(void 0===n?"undefined":y(n))&&"object"===y(n.exports)){var t=e(r,i);void 0!==t&&(n.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./textures"],e)}(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=e("./textures"),c=function(){function t(e){var i=this;d(this,t),this.dirty=!0,e&&Object.assign(this,e),this.apply=function(e,t){if(i.dirty){e.useProgram(t);var r="uniform"+i.method,n=e.getUniformLocation(t,i.key);e[r].apply(e,[n].concat(i.values))}}}return p(t,null,[{key:"isDifferent",value:function(e,t){return!(!e||!t)&&e.toString()!==t.toString()}}]),t}();t.Uniform=c;var n=function(e){function t(e){return d(this,t),s(this,l(t).call(this,e))}return h(t,c),t}();t.UniformTexture=n;var r=function(e){function u(){var e;return d(this,u),(e=s(this,l(u).apply(this,arguments))).dirty=!1,e}return h(u,o(Map)),p(u,[{key:"setParse",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=u.parseUniform.apply(u,[e].concat(r));return i&&this.set(e,i),i}},{key:"create",value:function(e,t,r){for(var n=arguments.length,i=new Array(3<n?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];var a=new c({method:e,type:t,key:r,values:i});return this.set(r,a),this.dirty=!0,a}},{key:"createTexture",value:function(e,t){var r=new n({method:"1i",type:"sampler2D",key:e,values:[t]});return this.set(e,r),this.dirty=!0,r}},{key:"update",value:function(e,t,r){for(var n=this.get(r),i=arguments.length,o=new Array(3<i?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];!n||n.method===e&&n.type===t&&n.values===o||(n.method=e,n.type=t,n.values=o,n.dirty=!0,this.dirty=!0)}},{key:"createOrUpdate",value:function(e,t,r){for(var n=arguments.length,i=new Array(3<n?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];this.has(r)?this.update.apply(this,[e,t,r].concat(i)):this.create.apply(this,[e,t,r].concat(i))}},{key:"apply",value:function(t,r){this.forEach(function(e){return e.apply(t,r)})}}],[{key:"isArrayOfNumbers",value:function(e){return e.reduce(function(e,t){return e&&"number"==typeof t},!0)}},{key:"parseUniform",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i,o=1===r.length?r[0]:r;if("number"==typeof o)i=new c({type:"float",method:"1f",key:e,values:[o]});else if("boolean"==typeof o)i=new c({type:"bool",method:"1i",key:e,values:[o]});else if(f.Texture.isTexture(o))i=new c({type:"sampler2D",method:"1i",key:e,values:o});else if(Array.isArray(o)){if(u.isArrayOfNumbers(o))1===o.length?i=new c({type:"float",method:"1f",key:e,values:o}):2<=o.length&&o.length<=4?i=new c({type:"vec"+o.length,method:o.length+"fv",key:e,values:o}):4<o.length&&(i=new c({type:"float[]",method:"1fv",key:e,values:o}));else if(f.Texture.getTextureOptions(o[0]))i=new c({type:"sampler2D",method:"1iv",key:e,values:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]){if(2<=o[0].length&&o[0].length<=4)for(var a=0;a<o.length;a++)i=new c({type:"vec"+o[0].length,method:o[a].length+"fv",key:e+"["+a+"]",values:o[a]})}else if("object"===y(o[0]))for(var s=0;s<o.length;s++);}else y(o);return i}},{key:"parseUniforms",value:function(e,t){var r=new Map;for(var n in e){var i=e[n];t&&(n=t+"."+n);var o=u.parseUniform(n,i);o&&r.set(n,o)}return r}}]),u}();t.default=r})},{"./textures":6}]},{},[4]);
//# sourceMappingURL=glsl-canvas.min.js.map
