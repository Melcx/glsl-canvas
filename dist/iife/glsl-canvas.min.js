/**
 * @license glsl-canvas-js v0.2.0
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
var glsl=function(e){"use strict";function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var n=setTimeout;function o(e){return Boolean(e&&void 0!==e.length)}function s(){}function a(e){if(!(this instanceof a))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function u(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,a._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var i;try{i=r(e._value)}catch(e){return void h(t.promise,e)}f(t.promise,i)}else(1===e._state?f:h)(t.promise,e._value)}))):e._deferreds.push(t)}function f(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof a)return e._state=3,e._value=t,void l(e);if("function"==typeof r)return void d((i=r,n=t,function(){i.apply(n,arguments)}),e)}e._state=1,e._value=t,l(e)}catch(t){h(e,t)}var i,n}function h(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&a._immediateFn((function(){e._handled||a._unhandledRejectionFn(e._value)}));for(var t=0,r=e._deferreds.length;t<r;t++)u(e,e._deferreds[t]);e._deferreds=null}function c(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function d(e,t){var r=!1;try{e((function(e){r||(r=!0,f(t,e))}),(function(e){r||(r=!0,h(t,e))}))}catch(e){if(r)return;r=!0,h(t,e)}}a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var r=new this.constructor(s);return u(this,new c(e,t,r)),r},a.prototype.finally=function(e){var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){return t.reject(r)}))}))},a.all=function(e){return new a((function(t,r){if(!o(e))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);var n=i.length;function s(e,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var a=o.then;if("function"==typeof a)return void a.call(o,(function(t){s(e,t)}),r)}i[e]=o,0==--n&&t(i)}catch(e){r(e)}}for(var a=0;a<i.length;a++)s(a,i[a])}))},a.resolve=function(e){return e&&"object"==typeof e&&e.constructor===a?e:new a((function(t){t(e)}))},a.reject=function(e){return new a((function(t,r){r(e)}))},a.race=function(e){return new a((function(t,r){if(!o(e))return r(new TypeError("Promise.race accepts an array"));for(var i=0,n=e.length;i<n;i++)a.resolve(e[i]).then(t,r)}))},a._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){n(e,0)},a._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var m,v=function(){function e(){}return e.fetch=function(e){return new Promise((function(t,r){var i=new XMLHttpRequest;i.onload=function(){t(i.response||i.responseText)},i.onerror=function(t){r(new Error("Network request failed for url "+e))},i.ontimeout=function(t){r(new Error("Network request failed for url "+e))},i.onabort=function(){r(new Error("Aborted"))},i.open("GET",e,!0),i.send(null)}))},e}();!function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Log=3]="Log"}(m||(m={}));var p=function(){function e(){}return e.log=function(){var t;e.enabled&&e.level>=m.Log&&(t=console).log.apply(t,arguments)},e.warn=function(){var t;e.enabled&&e.level>=m.Warn&&(t=console).warn.apply(t,arguments)},e.error=function(){var t;e.enabled&&e.level>=m.Error&&(t=console).error.apply(t,arguments)},e}();p.level=m.Warn,p.enabled=!0;var g,T,E="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 a_position;\nattribute vec2 a_texcoord;\n\nvarying vec2 v_texcoord;\n\nvoid main(){\n\tgl_Position = vec4(a_position, 0.0, 1.0);\n\tv_texcoord = a_texcoord;\n}\n",_="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvoid main(){\n\tgl_FragColor = vec4(0.0);\n}\n",y="#version 300 es\n\nin vec2 a_position;\nin vec2 a_texcoord;\n\nout vec2 v_texcoord;\n\nvoid main() {\n\tgl_Position = vec4(a_position, 0.0, 1.0);\n\tv_texcoord = a_texcoord;\n}\n",x="#version 300 es\n\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n\toutColor = vec4(0.0);\n}\n";(g=e.ContextVersion||(e.ContextVersion={}))[g.WebGl=1]="WebGl",g[g.WebGl2=2]="WebGl2",(T=e.ContextError||(e.ContextError={}))[T.BrowserSupport=1]="BrowserSupport",T[T.Other=2]="Other";var U=function(){},b=function(){function t(){}return t.getContext_=function(e,t){for(var r=["webgl","experimental-webgl"],i=null,n=0;n<r.length;++n)try{i=e.getContext(r[n],t)}catch(e){if(i)break}return i},t.getContext2_=function(e,t){var r=null;try{r=e.getContext("webgl2",t)}catch(e){}return r},t.getIncludes=function(e){if(void 0===e)return Promise.resolve(e);for(var t,r=/#include\s*['|"](.*.glsl)['|"]/gm,i=[],n=0;null!==(t=r.exec(e));)i.push(Promise.resolve(e.slice(n,t.index))),n=t.index+t[0].length,i.push(v.fetch(t[1]));return i.push(Promise.resolve(e.slice(n))),Promise.all(i).then((function(e){return e.join("")}))},t.isWebGl=function(e){return e instanceof WebGLRenderingContext},t.isWebGl2=function(e){return window.WebGL2RenderingContext&&e instanceof WebGL2RenderingContext},t.inferVersion=function(t,r){var i=t||r;return i&&0===i.indexOf("#version 300 es")?e.ContextVersion.WebGl2:e.ContextVersion.WebGl},t.versionDiffers=function(r,i,n){if(r){var o=this.isWebGl2(r)?e.ContextVersion.WebGl2:e.ContextVersion.WebGl;return t.inferVersion(i,n)!==o}return!1},t.getVertex=function(t,r){return t||(this.inferVersion(t,r)===e.ContextVersion.WebGl2?y:E)},t.getFragment=function(t,r){return r||(this.inferVersion(t,r)===e.ContextVersion.WebGl2?x:_)},t.tryInferContext=function(r,i,n,o,s,a){function u(e,t){if("function"==typeof a)a(e);else{var r=n.parentNode;r&&(r.innerHTML='<div class="glsl-canvas--error">'+t+"</div>")}}if(void 0===s&&(s=[]),!WebGLRenderingContext)return u(e.ContextError.BrowserSupport,'This page requires a browser that supports WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var f=t.inferContext(r,i,n,o);if(f){this.isWebGl2(f)||-1!==s.indexOf("OES_standard_derivatives")||s.push("OES_standard_derivatives");var h=f.getSupportedExtensions();s.forEach((function(e){-1!==h.indexOf(e)?f.getExtension(e):p.warn("GlslCanvas "+e+" not supported")}))}else u(e.ContextError.Other,'It does not appear your computer can support WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>');return f},t.tryGetContext=function(r,i,n){function o(e,t){if("function"==typeof n)n(e);else{var i=r.parentNode;i&&(i.innerHTML='<div class="glsl-canvas--error">'+t+"</div>")}}if(!WebGLRenderingContext)return o(e.ContextError.BrowserSupport,'This page requires a browser that supports WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var s=t.getContext_(r,i);return s?s.getExtension("OES_standard_derivatives"):o(e.ContextError.Other,'It does not appear your computer can support WebGL.<br/>\n\t\t\t<a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'),s},t.inferContext=function(t,r,i,n){return this.inferVersion(t,r)===e.ContextVersion.WebGl2?this.getContext2_(i,n):this.getContext_(i,n)},t.createShader=function(e,r,i,n){void 0===n&&(n=0);var o=e.createShader(i);if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw t.lastError=e.getShaderInfoLog(o),p.error("*** Error compiling shader "+o+": "+t.lastError),e.deleteShader(o),{shader:o,source:r,type:i,error:t.lastError,offset:n};return o},t.createProgram=function(e,r,i,n){for(var o=e.createProgram(),s=0;s<r.length;++s)e.attachShader(o,r[s]);if(i&&n)for(var a=0;a<i.length;++a)e.bindAttribLocation(o,n?n[a]:a,i[a]);return e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)?o:(t.lastError=e.getProgramInfoLog(o),p.log("Error in program linking: "+t.lastError),e.deleteProgram(o),null)},t.createVertexBuffers=function(e,t){var r=new U,i=e.getAttribLocation(t,"a_texcoord");r.texcoord=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.texcoord),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);var n=e.getAttribLocation(t,"a_position");return r.position=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.position),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),r},t}();b.lastError="";var A,R=function(){},L=function(){function e(){this.values=new R}var t=e.prototype;return t.has=function(e){return this.values.hasOwnProperty(e)},t.set=function(e,t){this.values[e]=t},t.get=function(e){return this.values[e]},t.forEach=function(e){var t=0;for(var r in this.values)e(this.values[r],t,this.values),t++},t.reduce=function(e,t){var r=t,i=0;for(var n in this.values)r=e(r,this.values[n],i,this.values),i++;return r},e}(),M="#version 300 es\n\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n\toutColor = vec4(1.0);\n}\n";(A=e.BufferFloatType||(e.BufferFloatType={}))[A.FLOAT=0]="FLOAT",A[A.HALF_FLOAT=1]="HALF_FLOAT";var w=function(){function t(e,t,r,i){var n=e.createFramebuffer(),o=this.getTexture(e,t,r,i);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.texture=o,this.buffer=n,this.BW=t,this.BH=r,this.index=i}var r=t.prototype;return r.getFloatType=function(r){var i,n;if(t.floatType===e.BufferFloatType.FLOAT){var o=b.isWebGl2(r)?"EXT_color_buffer_float":"OES_texture_float";if(!(n=r.getExtension(o)))return t.floatType=e.BufferFloatType.HALF_FLOAT,this.getFloatType(r);i=r.FLOAT}else{var s=b.isWebGl2(r)?"EXT_color_buffer_half_float":"OES_texture_half_float";if(!(n=r.getExtension(s)))return t.floatType=e.BufferFloatType.FLOAT,this.getFloatType(r);i=n.HALF_FLOAT_OES}return i},r.getTexture=function(r,i,n,o){var s=this.getFloatType(r),a=r.createTexture();return r.activeTexture(r.TEXTURE0+o),r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,b.isWebGl2(r)?r.RGBA16F:r.RGBA,i,n,0,r.RGBA,s,null),r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE?(t.floatType===e.BufferFloatType.FLOAT?t.floatType=e.BufferFloatType.HALF_FLOAT:t.floatType=e.BufferFloatType.FLOAT,this.getTexture(r,i,n,o)):a},r.resize=function(e,t,r){if(t!==this.BW||r!==this.BH){var i=this.buffer,n=this.texture,o=this.index;e.bindFramebuffer(e.FRAMEBUFFER,i);var s,a=e.checkFramebufferStatus(e.FRAMEBUFFER),u=Math.min(t,this.BW),f=Math.min(r,this.BH),h=this.getFloatType(e);a===e.FRAMEBUFFER_COMPLETE&&(s=new Float32Array(u*f*4),e.readPixels(0,0,u,f,e.RGBA,h,s)),e.bindFramebuffer(e.FRAMEBUFFER,null);var l=o+1,c=this.getTexture(e,t,r,l);h=this.getFloatType(e),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s&&e.texSubImage2D(e.TEXTURE_2D,0,0,0,u,f,e.RGBA,h,s);var d=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,c),this.index=o,this.texture=c,this.buffer=d,this.BW=t,this.BH=r}},t}();w.floatType=e.BufferFloatType.HALF_FLOAT;var F,S,P=function(){function e(e,t,r,i){this.isValid=!1,this.index=e,this.key=t,this.vertexString=r,this.fragmentString=i}var t=e.prototype;return t.create=function(e,t,r){var i=b.createShader(e,this.vertexString,e.VERTEX_SHADER),n=b.createShader(e,this.fragmentString,e.FRAGMENT_SHADER,1);n?this.isValid=!0:(n=b.createShader(e,b.isWebGl2(e)?M:"\nvoid main(){\n\tgl_FragColor = vec4(1.0);\n}",e.FRAGMENT_SHADER),this.isValid=!1);var o=b.createProgram(e,[i,n]);e.linkProgram(o);var s=new w(e,t,r,this.index+0),a=new w(e,t,r,this.index+2);this.program=o,this.input=s,this.output=a,e.deleteShader(i),e.deleteShader(n)},t.render=function(e,t,r){e.useProgram(this.program),e.viewport(0,0,t,r),e.bindFramebuffer(e.FRAMEBUFFER,this.output.buffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.output.texture,0),e.drawArrays(e.TRIANGLES,0,6);var i=this.input,n=this.output;this.input=n,this.output=i},t.resize=function(e,t,r){e.useProgram(this.program),e.viewport(0,0,t,r),this.input.resize(e,t,r),this.output.resize(e,t,r)},t.destroy=function(e){e.deleteProgram(this.program),this.program=null,this.input=null,this.output=null},e}(),C=function(e){function i(){return e.apply(this,arguments)||this}var n,o,s;return r(i,e),i.getBuffers=function(e,t,r){var n=new i,o=0;if(t){b.isWebGl2(e)&&(t=t.replace(/^\#version\s*300\s*es\s*\n/,""));for(var s,a=/(?:^\s*)((?:#if|#elif)(?:\s*)(defined\s*\(\s*BUFFER_)(\d+)(?:\s*\))|(?:#ifdef)(?:\s*BUFFER_)(\d+)(?:\s*))/gm;null!==(s=a.exec(t));){var u=s[3]||s[4],f="u_buffer"+u,h=b.isWebGl2(e)?"#version 300 es\n#define BUFFER_"+u+"\n"+t:"#define BUFFER_"+u+"\n"+t,l=new P(o,f,r,h);l.create(e,e.drawingBufferWidth,e.drawingBufferHeight),n.set(f,l),o+=4}}return n},n=i,(o=[{key:"count",get:function(){return 4*Object.keys(this.values).length}}])&&t(n.prototype,o),s&&t(n,s),i}(L),D=function(e,t){this.event=e,this.callback=t},B=function(){function e(){this.listeners=new Set}var t=e.prototype;return t.logListeners=function(){this.listeners.forEach((function(e){return p.log(e)}))},t.subscribe=function(e){this.listeners.add(e)},t.unsubscribe=function(e){this.listeners.delete(e)},t.unsubscribeAll=function(){this.listeners.clear()},t.on=function(e,t){return this.listeners.add(new D(e,t)),this},t.off=function(e,t){var r=this;return t?this.listeners.delete(new D(e,t)):this.listeners.forEach((function(t){t.event===e&&r.listeners.delete(t)})),this},t.trigger=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return this.listeners.forEach((function(t){t.event===e&&"function"==typeof t.callback&&t.callback.apply(t,r)})),this},e}(),O=["jpg","jpeg","png"],G=["ogv","webm","mp4"],I=O.concat(G);function k(e){return"data"in e&&"width"in e&&"height"in e}(F=e.TextureSourceType||(e.TextureSourceType={}))[F.Data=0]="Data",F[F.Element=1]="Element",F[F.Url=2]="Url",(S=e.TextureFilteringType||(e.TextureFilteringType={})).MipMap="mipmap",S.Linear="linear",S.Nearest="nearest";var X,W,N=function(t){function i(r,i,n,o,s){var a;return void 0===o&&(o={filtering:e.TextureFilteringType.Linear}),(a=t.call(this)||this).valid=!1,a.dirty=!1,a.animated=!1,a.powerOf2=!1,a.key=i,a.index=n,a.options=o,a.workpath=s,a.create(r),a}r(i,t),i.isPowerOf2=function(e){return 0==(e&e-1)},i.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},i.isTextureUrl=function(e){return e&&/\.(jpg|jpeg|png|ogv|webm|mp4)$/i.test(e.split("?")[0])},i.isTexture=function(e){return void 0!==i.getTextureOptions(e)},i.getMaxTextureSize=function(e){return e.getParameter(e.MAX_TEXTURE_SIZE)},i.getTextureOptions=function(e,t){if(void 0===t&&(t={}),"string"==typeof e&&""!==e){if(i.isTextureUrl(e))return t.url=e,-1!==e.indexOf("?")&&(t=e.split("?")[1].split("&").reduce((function(e,t){var r=t.split("="),i=decodeURIComponent(r[0]),n=decodeURIComponent(r[1]);switch(i){case"filtering":e[i]=n;break;case"repeat":case"UNPACK_FLIP_Y_WEBGL":e[i]=Boolean(n);break;case"UNPACK_PREMULTIPLY_ALPHA_WEBGL":case"TEXTURE_WRAP_S":case"TEXTURE_WRAP_T":e[i]=Number(n)}return e}),t)),t;document&&(e=document.querySelector(e))}return e instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement?(t.element=e,t):k(e)?(t.data=e.data,t.width=e.width,t.height=e.height,t):null};var n=i.prototype;return n.create=function(e){this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.setData(e,1,1,new Uint8Array([0,0,0,0]),this.options)},n.load=function(e,t){return void 0===t&&(t={}),this.options=t,"string"==typeof t.url?void 0===this.url||t.url!==this.url?this.setUrl(e,t.url,t):Promise.resolve(this):t.element?this.setElement(e,t.element,t):t.data&&t.width&&t.height?this.setData(e,t.width,t.height,t.data,t):Promise.reject(this)},n.setUrl=function(t,r,n){if(void 0===n&&(n={}),!this.valid)return Promise.reject(this);this.url=r,this.source=r,this.sourceType=e.TextureSourceType.Url,this.options=Object.assign(this.options,n);var o,s,a=String(-1===r.indexOf(":/")&&void 0!==this.workpath?this.workpath+"/"+r:r),u=r.split("?")[0].split(".").pop().toLowerCase();return-1!==G.indexOf(u)?(p.log("GlslCanvas.setUrl video",a),(o=document.createElement("video")).setAttribute("preload","auto"),o.setAttribute("loop","true"),o.setAttribute("muted","true"),o.setAttribute("playsinline","true"),o.loop=!0,o.muted=!0,s=this.setElement(t,o,n),o.src=a,o.addEventListener("canplay",(function(){o.play()}))):(p.log("GlslCanvas.setUrl image",a),o=document.createElement("img"),s=this.setElement(t,o,n),i.isSafari()&&"data:"===r.slice(0,5)||(o.crossOrigin="anonymous"),o.src=a),s},n.setElement=function(t,r,i){var n=this;return void 0===i&&(i={}),i=this.options=Object.assign(this.options,i),new Promise((function(o,s){var a=r;if("string"==typeof r&&(r=document.querySelector(r)),r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof HTMLVideoElement)if(n.source=r,n.sourceType=e.TextureSourceType.Element,r instanceof HTMLVideoElement){var u=r;u.addEventListener("loadeddata",(function(e){n.update(t,i),n.setFiltering(t,i),o(n)})),u.addEventListener("error",(function(e){s(e)})),u.load()}else r instanceof HTMLImageElement?(r.addEventListener("load",(function(){n.update(t,i),n.setFiltering(t,i),o(n)})),r.addEventListener("error",(function(e){s(e)}))):(n.update(t,i),n.setFiltering(t,i),o(n));else{var f="the 'element' parameter (`element: "+JSON.stringify(a)+"`) must be a CSS selector string, or a <canvas>, <image> or <video> object";p.log("Texture '"+n.key+"': "+f,i),s(f)}}))},n.setData=function(t,r,i,n,o){return void 0===o&&(o={}),this.width=r,this.height=i,this.options=Object.assign(this.options,o),this.source=n,this.sourceType=e.TextureSourceType.Data,this.update(t,o),this.setFiltering(t,o),Promise.resolve(this)},n.update=function(t,r){if(this.valid){if(t.activeTexture(t.TEXTURE0+this.index),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1===r.UNPACK_FLIP_Y_WEBGL?0:1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.UNPACK_PREMULTIPLY_ALPHA_WEBGL||0),this.sourceType===e.TextureSourceType.Element)this.source instanceof HTMLImageElement&&this.source.naturalWidth&&this.source.naturalHeight?(this.width=this.source.naturalWidth,this.height=this.source.naturalHeight,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLVideoElement&&this.source.videoWidth&&this.source.videoHeight?(this.width=this.source.videoWidth,this.height=this.source.videoHeight,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.source)):this.source instanceof HTMLCanvasElement&&(this.width=this.source.width,this.height=this.source.height,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.source));else if(this.sourceType===e.TextureSourceType.Data){var i=this.source;t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,i)}this.trigger("loaded",this)}},n.tryUpdate=function(e){var t=!1;return this.animated&&(t=!0,this.update(e,this.options)),t},n.destroy=function(e){this.valid&&(e.deleteTexture(this.texture),this.texture=null,delete this.source,this.source=null,this.valid=!1)},n.setFiltering=function(t,r){if(this.valid){var n=i.isPowerOf2(this.width)&&i.isPowerOf2(this.height),o=r.filtering||e.TextureFilteringType.MipMap,s=r.TEXTURE_WRAP_S||(r.repeat?t.REPEAT:t.CLAMP_TO_EDGE),a=r.TEXTURE_WRAP_T||(r.repeat?t.REPEAT:t.CLAMP_TO_EDGE);n||(o=o===e.TextureFilteringType.MipMap?e.TextureFilteringType.Linear:o,s=a=t.CLAMP_TO_EDGE,(r.repeat||r.TEXTURE_WRAP_S||r.TEXTURE_WRAP_T)&&p.warn("GlslCanvas: cannot repeat texture "+r.url+" cause is not power of 2.")),this.powerOf2=n,this.filtering=o,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,a),this.filtering===e.TextureFilteringType.MipMap?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D)):this.filtering===e.TextureFilteringType.Nearest?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)):this.filtering===e.TextureFilteringType.Linear&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR))}},i}(B),H=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).count=0,t.dirty=!1,t.animated=!1,t}r(t,e);var i=t.prototype;return i.clean=function(){for(var e in this.values)this.values[e].dirty=!1;this.dirty=!1},i.createOrUpdate=function(e,t,r,i,n,o){var s,a=this;void 0===i&&(i=0),void 0===n&&(n={});var u=N.getTextureOptions(r,n);return(s=this.get(t))||(s=new N(e,t,i+this.count,u,o),this.count++,this.set(t,s)),void 0!==u?s.load(e,u).then((function(t){if(t.source instanceof HTMLVideoElement){var r=t.source;r.addEventListener("play",(function(){t.animated=!0,a.animated=!0})),r.addEventListener("pause",(function(){t.animated=!1,a.animated=a.reduce((function(e,t){return e||t.animated}),!1)})),r.addEventListener("seeked",(function(){t.update(e,t.options),a.dirty=!0}))}return t})):Promise.resolve(s)},t}(L);(X=e.UniformMethod||(e.UniformMethod={}))[X.Unknown=0]="Unknown",X.Uniform1i="uniform1i",X.Uniform2i="uniform2i",X.Uniform3i="uniform3i",X.Uniform4i="uniform4i",X.Uniform1f="uniform1f",X.Uniform2f="uniform2f",X.Uniform3f="uniform3f",X.Uniform4f="uniform4f",X.Uniform1iv="uniform1iv",X.Uniform2iv="uniform2iv",X.Uniform3iv="uniform3iv",X.Uniform4iv="uniform4iv",X.Uniform1fv="uniform1fv",X.Uniform2fv="uniform2fv",X.Uniform3fv="uniform3fv",X.Uniform4fv="uniform4fv",X.UniformMatrix2fv="uniformMatrix2fv",X.UniformMatrix3fv="uniformMatrix3fv",X.UniformMatrix4fv="uniformMatrix4fv",(W=e.UniformType||(e.UniformType={}))[W.Unknown=0]="Unknown",W[W.Float=1]="Float",W[W.Int=2]="Int",W[W.Bool=3]="Bool",W[W.Sampler2D=4]="Sampler2D",W[W.SamplerCube=5]="SamplerCube",W[W.Matrix2fv=6]="Matrix2fv",W[W.Matrix3fv=7]="Matrix3fv",W[W.Matrix4fv=8]="Matrix4fv";var V=[e.UniformMethod.Uniform1i,e.UniformMethod.Uniform2i,e.UniformMethod.Uniform3i,e.UniformMethod.Uniform4i],j=[e.UniformMethod.Uniform1f,e.UniformMethod.Uniform2f,e.UniformMethod.Uniform3f,e.UniformMethod.Uniform4f],Y=[e.UniformMethod.Uniform1iv,e.UniformMethod.Uniform2iv,e.UniformMethod.Uniform3iv,e.UniformMethod.Uniform4iv],q=[e.UniformMethod.Uniform1fv,e.UniformMethod.Uniform2fv,e.UniformMethod.Uniform3fv,e.UniformMethod.Uniform4fv],z=function(e){var t=this;this.dirty=!0,e&&Object.assign(this,e),this.apply=function(e,r){if(t.dirty){e.useProgram(r);var i=e.getUniformLocation(r,t.key);e[t.method].apply(e,[i].concat(t.values))}}},K=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t}(z),Q=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).dirty=!1,e}r(i,t),i.isDifferent=function(e,t){return e.length!==t.length||e.reduce((function(e,r,i){return e||r!==t[i]}),!1)},i.isArrayOfInteger=function(e){return e.reduce((function(e,t){return e&&Number.isInteger(t)}),!0)},i.isArrayOfNumber=function(e){return e.reduce((function(e,t){return e&&"number"==typeof t}),!0)},i.isArrayOfBoolean=function(e){return e.reduce((function(e,t){return e&&"boolean"==typeof t}),!0)},i.isArrayOfTexture=function(e){return e.reduce((function(e,t){return e&&N.isTexture(t)}),!0)},i.isArrayOfSampler2D=function(t){return t.reduce((function(t,r){return t&&r.type===e.UniformType.Sampler2D}),!0)},i.getType_=function(t){var r=e.UniformType.Unknown,n=1===t.length&&Array.isArray(t[0])?t[0]:t;return i.isArrayOfNumber(n)?r=e.UniformType.Float:i.isArrayOfBoolean(n)?r=e.UniformType.Bool:i.isArrayOfTexture(n)&&(r=e.UniformType.Sampler2D),r},i.getMethod_=function(t,r){var i=e.UniformMethod.Unknown,n=1===r.length&&Array.isArray(r[0]),o=(n?r[0]:r).length,s=o-1;switch(t){case e.UniformType.Float:i=n?s<q.length?q[s]:e.UniformMethod.Unknown:s<j.length?j[s]:e.UniformMethod.Uniform1fv;break;case e.UniformType.Int:case e.UniformType.Bool:i=n?s<Y.length?Y[s]:e.UniformMethod.Unknown:s<V.length?V[s]:e.UniformMethod.Uniform1iv;break;case e.UniformType.Sampler2D:i=n?e.UniformMethod.Uniform1iv:1===o?e.UniformMethod.Uniform1i:e.UniformMethod.Uniform1iv}return i},i.parseUniform=function(t,r,n){var o;void 0===n&&(n=null),n=n||i.getType_(r);var s=i.getMethod_(n,r);if(n!==e.UniformType.Unknown&&s!==e.UniformMethod.Unknown){if(n===e.UniformType.Sampler2D&&s===e.UniformMethod.Uniform1iv)return r[0].map((function(e,r){return new z({method:s,type:n,key:t+"["+r+"]",values:[e]})}));o=new z({method:s,type:n,key:t,values:r})}else p.error("Uniforms.parseUniform.Unknown",t,r);return o};var n=i.prototype;return n.create=function(e,t,r,i){var n=new z({method:e,type:t,key:r,values:i});return this.set(r,n),this.dirty=!0,n},n.createTexture=function(t,r){var i;return i=-1!==t.indexOf("]")?new K({method:e.UniformMethod.Uniform1iv,type:e.UniformType.Sampler2D,key:t,values:[[r]]}):new K({method:e.UniformMethod.Uniform1i,type:e.UniformType.Sampler2D,key:t,values:[r]}),this.set(t,i),this.dirty=!0,i},n.update=function(e,t,r,n){var o=this.get(r);o&&(o.method!==e||o.type!==t||i.isDifferent(o.values,n))&&(o.method=e,o.type=t,o.values=n,o.dirty=!0,this.dirty=!0)},n.createOrUpdate=function(e,t,r,i){this.has(r)?this.update(e,t,r,i):this.create(e,t,r,i)},n.apply=function(e,t){for(var r in this.values)this.values[r].apply(e,t)},n.clean=function(){for(var e in this.values)this.values[e].dirty=!1;this.dirty=!1},i}(L),J=function(){function e(){this.delay=0,this.current=0,this.delta=0,this.paused=!1,this.start=this.previous=this.now()}var t=e.prototype;return t.now=function(){return performance.now()},t.play=function(){if(this.previous){var e=this.now();this.delay+=e-this.previous,this.previous=e}this.paused=!1},t.pause=function(){this.paused=!0},t.next=function(){var e=this.now();return this.delta=e-this.previous,this.current=e-this.start-this.delay,this.previous=e,this},e}(),Z=function(t){function n(e,r){var o;return void 0===r&&(r={}),(o=t.call(this)||this).mouse={x:0,y:0},o.uniforms=new Q,o.buffers=new C,o.textures=new H,o.textureList=[],o.valid=!1,o.animated=!1,o.dirty=!0,o.visible=!1,e?(o.options=r,o.canvas=e,o.width=0,o.height=0,o.rect=e.getBoundingClientRect(),o.devicePixelRatio=window.devicePixelRatio||1,e.style.backgroundColor=r.backgroundColor||"rgba(0,0,0,0)",o.getShaders_().then((function(e){o.load().then((function(e){o.program&&(o.addListeners_(),o.onLoop())}))}),(function(e){p.log("GlslCanvas.getShaders_.error",e)})),n.items.push(i(o)),o):i(o)}r(n,t),n.version=function(){return"0.1.6"},n.of=function(e,t){return n.items.find((function(t){return t.canvas===e}))||new n(e,t)},n.loadAll=function(){return[].slice.call(document.getElementsByClassName("glsl-canvas")).filter((function(e){return e instanceof HTMLCanvasElement})).map((function(e){return n.of(e)}))};var o=n.prototype;return o.getShaders_=function(){var e=this;return new Promise((function(t,r){var i=e.canvas,n={};i.hasAttribute("data-vertex-url")&&(n.vertex=i.getAttribute("data-vertex-url")),i.hasAttribute("data-fragment-url")&&(n.fragment=i.getAttribute("data-fragment-url")),i.hasAttribute("data-vertex")&&(e.vertexString=i.getAttribute("data-vertex")),i.hasAttribute("data-fragment")&&(e.fragmentString=i.getAttribute("data-fragment")),Object.keys(n).length?Promise.all(Object.keys(n).map((function(t,r){var i=n[t];return v.fetch(i).then((function(r){return"vertex"===t?e.vertexString=r:e.fragmentString=r}))}))).then((function(r){t([e.vertexString,e.fragmentString])})):t([e.vertexString,e.fragmentString])}))},o.addListeners_=function(){this.onScroll=this.onScroll.bind(this),this.onClick=this.onClick.bind(this),this.onMove=this.onMove.bind(this),this.onMousemove=this.onMousemove.bind(this),this.onMouseover=this.onMouseover.bind(this),this.onMouseout=this.onMouseout.bind(this),this.onTouchmove=this.onTouchmove.bind(this),this.onTouchend=this.onTouchend.bind(this),this.onTouchstart=this.onTouchstart.bind(this),this.onLoop=this.onLoop.bind(this),window.addEventListener("scroll",this.onScroll),document.addEventListener("mousemove",this.onMousemove,!1),document.addEventListener("touchmove",this.onTouchmove),this.addCanvasListeners_()},o.addCanvasListeners_=function(){this.canvas.hasAttribute("controls")&&(this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mouseover",this.onMouseover),this.canvas.addEventListener("mouseout",this.onMouseout),this.canvas.addEventListener("touchstart",this.onTouchstart),this.canvas.hasAttribute("data-autoplay")||this.pause())},o.removeCanvasListeners_=function(){this.canvas.hasAttribute("controls")&&(this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mouseover",this.onMouseover),this.canvas.removeEventListener("mouseout",this.onMouseout),this.canvas.removeEventListener("touchstart",this.onTouchstart))},o.removeListeners_=function(){window.cancelAnimationFrame(this.rafId),window.removeEventListener("scroll",this.onScroll),document.removeEventListener("mousemove",this.onMousemove),document.removeEventListener("touchmove",this.onTouchmove),this.removeCanvasListeners_()},o.onScroll=function(e){this.rect=this.canvas.getBoundingClientRect()},o.onClick=function(e){this.toggle(),this.trigger("click",e)},o.onMove=function(e,t){var r=this.rect,i=(e-r.left)*this.devicePixelRatio,n=(r.height-(t-r.top))*this.devicePixelRatio;i===this.mouse.x&&n===this.mouse.y||(this.mouse.x=i,this.mouse.y=n,this.trigger("move",this.mouse))},o.onMousemove=function(e){this.onMove(e.clientX||e.pageX,e.clientY||e.pageY)},o.onMouseover=function(e){this.play(),this.trigger("over",e)},o.onMouseout=function(e){this.pause(),this.trigger("out",e)},o.onTouchmove=function(e){var t=[].slice.call(e.touches).reduce((function(e,t){return(e=e||{x:0,y:0}).x+=t.clientX,e.y+=t.clientY,e}),null);t&&this.onMove(t.x/e.touches.length,t.y/e.touches.length)},o.onTouchend=function(e){this.pause(),this.trigger("out",e),document.removeEventListener("touchend",this.onTouchend)},o.onTouchstart=function(e){this.play(),this.trigger("over",e),document.addEventListener("touchend",this.onTouchend),document.removeEventListener("mousemove",this.onMousemove),this.canvas.hasAttribute("controls")&&(this.canvas.removeEventListener("mouseover",this.onMouseover),this.canvas.removeEventListener("mouseout",this.onMouseout))},o.onLoop=function(e){this.checkRender(),this.rafId=window.requestAnimationFrame(this.onLoop)},o.setUniform_=function(t,r,i,n){var o=this;void 0===i&&(i={}),void 0===n&&(n=null);var s=Q.parseUniform(t,r,n);if(Array.isArray(s))Q.isArrayOfSampler2D(s)?s.forEach((function(e){return o.loadTexture(e.key,e.values[0],i)})):s.forEach((function(e){return o.uniforms.set(e.key,e.values[0])}));else if(s)switch(s.type){case e.UniformType.Sampler2D:this.loadTexture(t,r[0],i);break;default:this.uniforms.set(t,s)}},o.parseTextures_=function(e){for(var t,r=this,i=/uniform\s*sampler2D\s*([\w]*);(\s*\/\/\s*([\w|\:\/\/|\.|\-|\_|\?|\&|\=]*)|\s*)/gm;null!==(t=i.exec(e));){var n=t[1],o=t[3];N.isTextureUrl(o)?this.textureList.push({key:n,url:o}):this.buffers.has(n)||this.textureList.push({key:n,url:null})}this.canvas.hasAttribute("data-textures")&&this.canvas.getAttribute("data-textures").split(",").forEach((function(e,t){var i="u_texture"+t;r.textureList.push({key:i,url:e})}));return this.textureList.length>0},o.createUniforms_=function(){var t=this,r=this.gl,i=this.fragmentString,n=r.drawingBufferWidth,o=r.drawingBufferHeight,s=this.timer=new J,a=(i.match(/u_delta/g)||[]).length>1,u=(i.match(/u_time/g)||[]).length>1,f=(i.match(/u_date/g)||[]).length>1,h=(i.match(/u_mouse/g)||[]).length>1,l=this.parseTextures_(i);if(this.animated=u||f||h,this.animated?this.canvas.classList.add("animated"):this.canvas.classList.remove("animated"),this.uniforms.create(e.UniformMethod.Uniform2f,e.UniformType.Float,"u_resolution",[n,o]),a&&this.uniforms.create(e.UniformMethod.Uniform1f,e.UniformType.Float,"u_delta",[s.delta/1e3]),u&&this.uniforms.create(e.UniformMethod.Uniform1f,e.UniformType.Float,"u_time",[s.current/1e3]),f){var c=new Date;this.uniforms.create(e.UniformMethod.Uniform4f,e.UniformType.Float,"u_date",[c.getFullYear(),c.getMonth(),c.getDate(),3600*c.getHours()+60*c.getMinutes()+c.getSeconds()+.001*c.getMilliseconds()])}for(var d in h&&this.uniforms.create(e.UniformMethod.Uniform2f,e.UniformType.Float,"u_mouse",[0,0]),this.buffers.values){var m=this.buffers.values[d];this.uniforms.create(e.UniformMethod.Uniform1i,e.UniformType.Sampler2D,m.key,[m.input.index])}l&&(this.textureList.filter((function(e){return e.url})).forEach((function(e){t.setTexture(e.key,e.url,e.options)})),this.textureList=[])},o.updateUniforms_=function(){var t=this.gl,r=t.drawingBufferWidth,i=t.drawingBufferHeight;if(this.timer){var n=this.timer.next();if(this.uniforms.update(e.UniformMethod.Uniform2f,e.UniformType.Float,"u_resolution",[r,i]),this.uniforms.has("u_delta")&&this.uniforms.update(e.UniformMethod.Uniform1f,e.UniformType.Float,"u_delta",[n.delta/1e3]),this.uniforms.has("u_time")&&this.uniforms.update(e.UniformMethod.Uniform1f,e.UniformType.Float,"u_time",[n.current/1e3]),this.uniforms.has("u_date")){var o=new Date;this.uniforms.update(e.UniformMethod.Uniform4f,e.UniformType.Float,"u_date",[o.getFullYear(),o.getMonth(),o.getDate(),3600*o.getHours()+60*o.getMinutes()+o.getSeconds()+.001*o.getMilliseconds()])}if(this.uniforms.has("u_mouse")){var s=this.mouse;this.uniforms.update(e.UniformMethod.Uniform2f,e.UniformType.Float,"u_mouse",[s.x,s.y])}for(var a in this.buffers.values){var u=this.buffers.values[a];this.uniforms.update(e.UniformMethod.Uniform1i,e.UniformType.Sampler2D,u.key,[u.input.index])}for(var f in this.textures.values){var h=this.textures.values[f];h.tryUpdate(t),this.uniforms.update(e.UniformMethod.Uniform1i,e.UniformType.Sampler2D,h.key,[h.index])}}},o.isVisible_=function(){var e=this.rect;return e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)},o.isAnimated_=function(){return(this.animated||this.textures.animated)&&!this.timer.paused},o.isDirty_=function(){return this.dirty||this.uniforms.dirty||this.textures.dirty},o.sizeDidChanged_=function(){var e=this.gl,t=Math.ceil(this.canvas.clientWidth),r=Math.ceil(this.canvas.clientHeight);if(this.width!==t||this.height!==r){this.width=t,this.height=r;var i=Math.ceil(t*this.devicePixelRatio),n=Math.ceil(r*this.devicePixelRatio);for(var o in this.canvas.width=i,this.canvas.height=n,this.buffers.values){this.buffers.values[o].resize(e,i,n)}return this.rect=this.canvas.getBoundingClientRect(),this.trigger("resize"),!0}return!1},o.load=function(e,t){var r=this;return Promise.all([b.getIncludes(e||this.fragmentString),b.getIncludes(t||this.vertexString)]).then((function(e){return r.fragmentString=e[0],r.vertexString=e[1],r.createContext_()}))},o.getContext_=function(){var e=this.vertexString,t=this.fragmentString;if(this.vertexString=b.getVertex(e,t),this.fragmentString=b.getFragment(e,t),b.versionDiffers(this.gl,e,t)&&(this.destroyContext_(),this.swapCanvas_(),this.uniforms=new Q,this.buffers=new C,this.textures=new H,this.textureList=[]),!this.gl){var r=b.tryInferContext(e,t,this.canvas,this.options,this.options.extensions,this.options.onError);if(!r)return null;this.gl=r}return this.gl},o.createContext_=function(){var e,t,r=this.getContext_();if(!r)return!1;try{e=b.createShader(r,this.vertexString,r.VERTEX_SHADER),(t=b.createShader(r,this.fragmentString,r.FRAGMENT_SHADER))?this.valid=!0:(t=b.createShader(r,_,r.FRAGMENT_SHADER),this.valid=!1)}catch(e){return this.trigger("error",e),!1}var i=b.createProgram(r,[e,t]);if(r.useProgram(i),r.deleteShader(e),r.deleteShader(t),this.program=i,this.valid){try{this.buffers=C.getBuffers(r,this.fragmentString,this.vertexString)}catch(e){return this.valid=!1,this.trigger("error",e),!1}this.vertexBuffers=b.createVertexBuffers(r,i),this.createUniforms_()}return this.trigger("load",this),this.valid},o.test=function(e,t){var r=this;return new Promise((function(i,n){var o=r.vertexString,s=r.fragmentString,a=r.timer.paused,u=r.gl.getExtension("EXT_disjoint_timer_query"),f=u.createQueryEXT(),h=r.valid;(e||t)&&(r.load(e,t),h=r.valid,r.render()),r.timer.paused=!0,u.beginQueryEXT(u.TIME_ELAPSED_EXT,f),r.render(),u.endQueryEXT(u.TIME_ELAPSED_EXT);!function n(){r.render();var l=u.getQueryObjectEXT(f,u.QUERY_RESULT_AVAILABLE_EXT),c=r.gl.getParameter(u.GPU_DISJOINT_EXT);if(l&&!c){var d={wasValid:h,fragment:e||r.fragmentString,vertex:t||r.vertexString,timeElapsedMs:u.getQueryObjectEXT(f,u.QUERY_RESULT_EXT)/1e6};r.timer.paused=a,(e||t)&&r.load(s,o),i(d)}else window.requestAnimationFrame(n)}()}))},o.destroyContext_=function(){var e=this.gl;for(var t in e.useProgram(null),this.program&&e.deleteProgram(this.program),this.buffers.values){this.buffers.values[t].destroy(e)}for(var r in this.textures.values){this.textures.values[r].destroy(e)}this.buffers=null,this.textures=null,this.uniforms=null,this.program=null,this.gl=null},o.swapCanvas_=function(){var e=this.canvas,t=e.cloneNode();e.parentNode.replaceChild(t,e),this.canvas=t,this.addCanvasListeners_()},o.destroy=function(){this.removeListeners_(),this.destroyContext_(),this.animated=!1,this.valid=!1,n.items.splice(n.items.indexOf(this),1)},o.loadTexture=function(t,r,i){var n=this;void 0===i&&(i={}),this.valid?this.textures.createOrUpdate(this.gl,t,r,this.buffers.count,i,this.options.workpath).then((function(r){var i=r.index;n.uniforms.createTexture(t,i).texture=r;var o=-1!==t.indexOf("[")?t.replace("[","Resolution["):t+"Resolution";return n.uniforms.create(e.UniformMethod.Uniform2f,e.UniformType.Float,o,[r.width,r.height]),r}),(function(e){var i=Array.isArray(e.path)?e.path.map((function(e){return e.error?e.error.message:""})).join(", "):e.message;p.log("GlslCanvas.loadTexture.error",t,r,i),n.trigger("textureError",{key:t,urlElementOrData:r,message:i})})):this.textureList.push({key:t,url:r,options:i})},o.setTexture=function(e,t,r){return void 0===r&&(r={}),this.setUniform_(e,[t],r)},o.setUniform=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return this.setUniform_(e,r)},o.setUniformOfInt=function(t,r){return this.setUniform_(t,r,null,e.UniformType.Int)},o.setUniforms=function(e){for(var t in e)this.setUniform(t,e[t])},o.pause=function(){this.valid&&(this.timer.pause(),this.canvas.classList.add("paused"),this.trigger("pause"))},o.play=function(){this.valid&&(this.timer.play(),this.canvas.classList.remove("paused"),this.trigger("play"))},o.toggle=function(){this.valid&&(this.timer.paused?this.play():this.pause())},o.checkRender=function(){this.isVisible_()&&(this.sizeDidChanged_()||this.isAnimated_()||this.isDirty_())?(this.render(),this.canvas.classList.add("playing")):this.canvas.classList.remove("playing")},o.render=function(){var e=this.gl;if(e){var t=e.drawingBufferWidth,r=e.drawingBufferHeight;for(var i in this.updateUniforms_(),this.buffers.values){var n=this.buffers.values[i];this.uniforms.apply(e,n.program),n.render(e,t,r)}e.useProgram(this.program),this.uniforms.apply(e,this.program),e.viewport(0,0,t,r),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLES,0,6),this.uniforms.clean(),this.textures.clean(),this.dirty=!1,this.trigger("render",this)}},n}(B);return Z.logger=p,Z.items=[],document&&document.addEventListener("DOMContentLoaded",(function(){Z.loadAll()})),e.Buffer=w,e.Buffers=C,e.BuffersDefaultFragment="\nvoid main(){\n\tgl_FragColor = vec4(1.0);\n}",e.BuffersDefaultFragment2=M,e.Canvas=Z,e.CanvasTimer=J,e.Common=v,e.Context=b,e.ContextDefaultFragment=_,e.ContextDefaultFragment2=x,e.ContextDefaultVertex=E,e.ContextDefaultVertex2=y,e.ContextVertexBuffers=U,e.IOBuffer=P,e.IterableStringMap=L,e.Listener=D,e.Logger=p,e.METHODS_FLOAT=j,e.METHODS_FLOATV=q,e.METHODS_INT=V,e.METHODS_INTV=Y,e.Subscriber=B,e.Texture=N,e.TextureExtensions=I,e.TextureImageExtensions=O,e.TextureVideoExtensions=G,e.Textures=H,e.Uniform=z,e.UniformTexture=K,e.Uniforms=Q,e.isTextureData=k,e}({});
//# sourceMappingURL=glsl-canvas.min.js.map