{"version":3,"sources":["src/glsl.ts","../../node_modules/promise-polyfill/src/index.js","../../node_modules/promise-polyfill/src/finally.js","../../src/logger/logger.ts","../../src/core/common.ts","../../src/context/context.ts","../../src/buffers/buffers.ts","../../src/core/iterable.ts","../../src/geometry/geometry.ts","../../src/geometry/flat-geometry.ts","../../src/math/vector2.ts","../../node_modules/gl-matrix/esm/common.js","../../node_modules/gl-matrix/esm/mat4.js","../../src/textures/textures.ts","../../src/math/vector3.ts","../../src/camera/orbit-camera.ts","../../src/canvas/canvas-timer.ts","../../src/core/subscriber.ts","../../src/geometry/box-geometry.ts","../../src/geometry/sphere-geometry.ts","../../src/geometry/torus-geometry.ts","../../src/loaders/obj-loader.ts","../../src/uniforms/uniforms.ts","../../src/renderer/renderer.ts","../../src/canvas/canvas.ts"],"names":["global","factory","exports","module","define","amd","self","glsl","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_assertThisInitialized","ReferenceError","setTimeoutFunc","setTimeout","isArray","x","Boolean","noop","Promise","fn","TypeError","_state","_handled","_value","undefined","_deferreds","doResolve","handle","deferred","_immediateFn","cb","onFulfilled","onRejected","ret","e","reject","promise","resolve","push","newValue","then","finale","thisArg","apply","arguments","_unhandledRejectionFn","len","Handler","done","value","reason","ex","prom","callback","all","arr","args","Array","slice","call","remaining","res","val","race","setImmediate","err","console","warn","LoggerLevel","Common","fetch","url","xhr","XMLHttpRequest","onload","response","responseText","onerror","error","log","Error","ontimeout","onabort","open","send","Logger","_console","enabled","level","Log","_console2","Warn","_console3","ContextVersion","ContextPrecision","ContextMode","DefaultWebGLBufferVertex","DefaultWebGL2BufferVertex","DefaultWebGLFlatFragment","DefaultWebGLMeshVertex","DefaultWebGL2MeshVertex","DefaultWebGLMeshFragment","DefaultWebGL2FlatFragment","DefaultWebGL2MeshFragment","ContextError","ContextDefault","webgl","flat","vertex","fragment","mesh","webgl2","ContextVertexBuffers","Context","getContext_","canvas","options","names","context","getContext","getContext2_","getFragmentVertex","gl","fragmentString","vertexString","isWebGl2","replace","exec","getIncludes","input","match","regex","promises","index","chunks","join","isWebGl","WebGLRenderingContext","window","WebGL2RenderingContext","inferVersion","source","indexOf","WebGl2","WebGl","inferPrecision","precision","versionDiffers","currentVersion","getBufferVertex","getVertex","mode","Flat","version","getFragment","tryInferContext","attributes","extensions","errorCallback","handleError","errorCode","html","container","parentNode","innerHTML","BrowserSupport","inferContext","supportedExtensions","getSupportedExtensions","forEach","getExtension","Other","tryGetContext","createShader","type","offset","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","lastError","getShaderInfoLog","deleteShader","createProgram","shaders","locations","program","attachShader","bindAttribLocation","linkProgram","validateProgram","getProgramParameter","LINK_STATUS","useProgram","getProgramInfoLog","deleteProgram","createVertexBuffers","vertexBuffers","texcoordIndex","getAttribLocation","texcoord","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","positionIndex","position","MediumP","BufferFloatType","StringMap","IterableStringMap","values","_proto","has","hasOwnProperty","set","item","get","callbackfn","reduce","initialValue","previous","Geometry","assign","positions","size","createData_","createAttributes_","createBufferData_","array","buffer","createAttribLocation_","name","location","positionBuffer","positionLocation","texcoords","texcoordBuffer","texcoordLocation","normals","normalBuffer","normalLocation","colors","colorBuffer","colorLocation","attachAttributes_","attribLocation","bindAttributes_","fromIndices","indices","FlatGeometry","_Geometry","BuffersDefaultFragment","BuffersDefaultFragment2","Buffer","BW","BH","createFramebuffer","texture","getTexture","texParameteri","TEXTURE_2D","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","getFloatType","floatType","extension","extensionName","HALF_FLOAT","HALF_FLOAT_OES","createTexture","activeTexture","TEXTURE0","bindTexture","texImage2D","RGBA16F","RGBA","checkFramebufferStatus","FRAMEBUFFER","FRAMEBUFFER_COMPLETE","resize","bindFramebuffer","pixels","status","minW","Math","min","minH","readPixels","newIndex","newTexture","texSubImage2D","newBuffer","deleteTexture","IOBuffer","isValid","geometry","_proto2","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","output","render","framebufferTexture2D","COLOR_ATTACHMENT0","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","viewport","drawArrays","TRIANGLES","destroy","Buffers","_IterableStringMap","Constructor","protoProps","staticProps","getBuffers","buffers","count","matches","regexp","bufferFragmentString","drawingBufferWidth","drawingBufferHeight","keys","Vector2","y","isVector2","copy","v","sqrt","normalize","divideScalar","scalar","multiplyScalar","subVectors","a","b","addVectors","ARRAY_TYPE","out","glMatrix.ARRAY_TYPE","identity","rotate","rad","axis","s","c","t","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","b00","b01","b02","b10","b11","b12","b20","b21","b22","z","hypot","sin","cos","TextureSourceType","TextureFilteringType","Vector3","isVector3","crossVectors","ax","ay","az","bx","by","bz","RAD","PI","OrbitCamera","theta","phi","radius","_this","_Vector","dirty","down","mouse","move","max","up","wheel","d","fromVector","vector","acos","atan","CanvasTimer","delay","current","delta","paused","start","now","performance","play","pause","next","Listener","event","Subscriber","listeners","Set","logListeners","subscribe","listener","add","unsubscribe","delete","unsubscribeAll","on","off","trigger","_len","data","BoxGeometry","faceColors","j","concat","SphereGeometry","ix","iy","phiLength","thetaLength","p","n","thetaEnd","grid","positionRow","uOffset","u","uvx","uvy","heightDivisions","TorusGeometry","normal","p1","p2","B","T","N","calculatePositionOnCurve","cx","cy","q","cu","su","quOverP","cs","COLORS","CI","ObjLoader","load","text","parse","parseIndices","faceIndices","k","l","NaN","parseFaces","F","V","VN","VT","_this2","si","vl","fill","rgb","_this3","split","line","trim","map","parseFloat","f","parseInt","boundingBox","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","dx","dy","dz","unrapUvw","pitch","asin","yaw","atan2","tx","ty","TextureImageExtensions","TextureVideoExtensions","TextureExtensions","isTextureData","object","UniformMethod","UniformType","Texture","_Subscriber","workpath","filtering","Linear","valid","animated","powerOf2","isPowerOf2","isSafari","test","navigator","userAgent","isTextureUrl","isTexture","urlElementOrData","getTextureOptions","getMaxTextureSize","getParameter","MAX_TEXTURE_SIZE","prev","curr","params","decodeURIComponent","document","querySelector","HTMLCanvasElement","HTMLImageElement","HTMLVideoElement","element","width","height","setData","Uint8Array","setUrl","setElement","sourceType","Url","src","String","ext","pop","toLowerCase","createElement","setAttribute","loop","muted","addEventListener","crossOrigin","originalElement","Element","video","update","setFiltering","message","JSON","stringify","Data","pixelStorei","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","naturalWidth","naturalHeight","UNSIGNED_BYTE","videoWidth","videoHeight","imageBuffer","tryUpdate","MipMap","wrapS","repeat","REPEAT","wrapT","LINEAR_MIPMAP_LINEAR","LINEAR","generateMipmap","Nearest","Textures","clean","createOrUpdate","_this4","textureOptions","flag","METHODS_INT","Uniform1i","Uniform2i","Uniform3i","Uniform4i","METHODS_FLOAT","Uniform1f","Uniform2f","Uniform3f","Uniform4f","METHODS_INTV","Uniform1iv","Uniform2iv","Uniform3iv","Uniform4iv","METHODS_FLOATV","Uniform1fv","Uniform2fv","Uniform3fv","Uniform4fv","Uniform","method","UniformMatrix2fv","UniformMatrix3fv","UniformMatrix4fv","getUniformLocation","UniformTexture","_Uniform","Uniforms","isArrayOfInteger","isInteger","isArrayOfNumber","isArrayOfBoolean","isArrayOfTexture","isArrayOfSampler2D","Sampler2D","getType_","Unknown","subject","Float","Bool","getMethod_","isVector","Int","parseUniform","uniform","isDifferent","Renderer","uniforms","textures","textureList","W","H","radians","camera","cache","drawFunc_","drawArrays_","update_","timer","deltaTime","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","CULL_FACE","doubleSided","cullFace","FRONT","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","BACK","create_","createGeometry_","createUniforms_","parseGeometry_","setMode","defaultMesh","hasDelta","hasTime","hasDate","hasMouse","date","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","projectionMatrix","mat4","modelViewMatrix","normalMatrix","updateUniforms_","updateProjectionMatrix_","updateModelViewMatrix_","updateNormalMatrix_","fieldOfView","aspect","fovy","near","far","nf","tan","Infinity","a30","a31","a32","a33","b03","b04","b05","b06","b07","b08","b09","det","Mesh","Box","Sphere","Torus","getResource","setMesh","Canvas","_Renderer","visible","controls","rect","getBoundingClientRect","devicePixelRatio","style","backgroundColor","getShaders_","success","addListeners_","onLoop","items","of","find","loadAll","getElementsByClassName","filter","urls","hasAttribute","getAttribute","body","onScroll","bind","onWheel","onClick","onMove","onMousedown","onMousemove","onMouseover","onMouseout","onMouseup","onTouchmove","onTouchend","onTouchstart","addCanvasListeners_","removeCanvasListeners_","removeEventListener","removeListeners_","cancelAnimationFrame","rafId","deltaY","toggle","onDown","mx","my","left","top","onUp","clientX","pageX","clientY","pageY","touch","touches","time","checkRender","requestAnimationFrame","setUniform_","loadTexture","isVisible_","innerHeight","documentElement","clientHeight","isAnimated_","isDirty_","sizeDidChanged_","CW","ceil","clientWidth","CH","parseTextures_","_this5","fragmentVertexString","createContext_","destroyContext_","swapCanvas_","onError","defaultFragment","classList","remove","parseMode_","parseMesh_","createBuffers_","createTextures_","_this6","setTexture","updateBuffers_","updateTextures_","canvas_","cloneNode","replaceChild","splice","_this7","keyResolution","path","setUniform","setUniformOfInt","setUniforms"],"mappings":"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","file":"dist/umd/glsl-canvas.min.js","sourcesContent":[null,"import promiseFinally from './finally';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nexport default finallyConstructor;\n","export enum LoggerLevel {\n\tNone = 0,\n\tError = 1,\n\tWarn = 2,\n\tLog = 3,\n}\n\nexport default class Logger {\n\n\tstatic level: LoggerLevel = LoggerLevel.Warn;\n\n\tstatic enabled: boolean = true;\n\n\tstatic log(...datas: any[]) {\n\t\tif (Logger.enabled && Logger.level >= LoggerLevel.Log) {\n\t\t\tconsole.log(...datas);\n\t\t}\n\t}\n\n\tstatic warn(...datas: any[]) {\n\t\tif (Logger.enabled && Logger.level >= LoggerLevel.Warn) {\n\t\t\tconsole.warn(...datas);\n\t\t}\n\t}\n\n\tstatic error(...datas: any[]) {\n\t\tif (Logger.enabled && Logger.level >= LoggerLevel.Error) {\n\t\t\tconsole.error(...datas);\n\t\t}\n\t}\n\n}\n","import 'promise-polyfill';\n\nexport default class Common {\n\tstatic fetch(url: string): Promise<string> {\n\t\t// console.log('Common.fetch', url);\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tconst xhr: XMLHttpRequest = new XMLHttpRequest();\n\t\t\txhr.onload = function () {\n\t\t\t\tresolve(xhr.response || xhr.responseText);\n\t\t\t};\n\t\t\txhr.onerror = function (error) {\n\t\t\t\tconsole.log('Common.error', error);\n\t\t\t\treject(new Error(`Network request failed for url ${url}`));\n\t\t\t};\n\t\t\txhr.ontimeout = function (error) {\n\t\t\t\t// console.log(error);\n\t\t\t\treject(new Error(`Network request failed for url ${url}`));\n\t\t\t};\n\t\t\txhr.onabort = function () {\n\t\t\t\treject(new Error('Aborted'));\n\t\t\t};\n\t\t\txhr.open('GET', url, true);\n\t\t\txhr.send(null);\n\t\t})\n\t}\n}\n","import Common from '../core/common';\nimport Logger from '../logger/logger';\n\nexport const DefaultWebGLBufferVertex = `\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\nattribute vec3 a_normal;\nattribute vec4 a_color;\n\nvarying vec2 v_texcoord;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec3 v_light;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\nuniform mat4 u_normalMatrix;\n\nuniform vec3 u_lightAmbient;\nuniform vec3 u_lightColor;\nuniform vec3 u_lightDirection;\n\nvoid main(void) {\n\tgl_Position = a_position;\n\tv_texcoord = a_texcoord;\n\tv_normal = a_normal;\n\tv_color = a_color;\n\n\t// light\n\tvec4 normal = u_normalMatrix * vec4(a_normal, 1.0);\n\tfloat incidence = max(dot(normal.xyz, u_lightDirection), 0.0);\n\tv_light = u_lightAmbient + (u_lightColor * incidence);\n}\n`;\n\nexport const DefaultWebGL2BufferVertex = `#version 300 es\n\nprecision mediump float;\n\nin vec4 a_position;\nin vec2 a_texcoord;\nin vec3 a_normal;\nin vec4 a_color;\n\nout vec2 v_texcoord;\nout vec3 v_normal;\nout vec4 v_color;\nout vec3 v_light;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\nuniform mat4 u_normalMatrix;\n\nuniform vec3 u_lightAmbient;\nuniform vec3 u_lightColor;\nuniform vec3 u_lightDirection;\n\nvoid main() {\n\tgl_Position = a_position;\n\tv_texcoord = a_texcoord;\n\tv_normal = a_normal;\n\tv_color = a_color;\n\n\t// light\n\tvec4 normal = u_normalMatrix * vec4(a_normal, 1.0);\n\tfloat incidence = max(dot(normal.xyz, u_lightDirection), 0.0);\n\tv_light = u_lightAmbient + (u_lightColor * incidence);\n}\n`;\n\nexport const DefaultWebGLFlatFragment = `\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nuniform vec2 u_resolution;\nuniform float u_time;\n\nvoid main() {\n\tvec2 st = gl_FragCoord.xy / u_resolution.xy;\n\tst.x *= u_resolution.x / u_resolution.y;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * st.y,\n\t\tabs(cos(u_time * 0.2)) * st.y,\n\t\tabs(sin(u_time)) * st.y\n\t);\n\tgl_FragColor = vec4(color, 1.0);\n}\n`;\n\nexport const DefaultWebGLMeshVertex = `\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec4 a_position;\nattribute vec2 a_texcoord;\nattribute vec3 a_normal;\nattribute vec4 a_color;\n\nvarying vec4 v_position;\nvarying vec2 v_texcoord;\nvarying vec3 v_normal;\nvarying vec4 v_color;\nvarying vec3 v_light;\n\nuniform float u_time;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\nuniform mat4 u_normalMatrix;\n\nuniform vec3 u_lightAmbient;\nuniform vec3 u_lightColor;\nuniform vec3 u_lightDirection;\n\nvoid main(void) {\n\tvec4 v_position = a_position;\n\t// v_position.y += sin(v_position.x * 0.1) * 10.0;\n\t// v_position.xyz += a_normal * 0.025 + cos(u_time * 5.0) * a_normal * 0.025;\n\tv_position = u_projectionMatrix * u_modelViewMatrix * v_position;\n\tgl_Position = v_position;\n\n\tv_texcoord = a_texcoord;\n\tv_normal = a_normal;\n\tv_color = a_color;\n\n\t// light\n\tvec4 normal = u_normalMatrix * vec4(a_normal, 1.0) * 1.5;\n\tfloat incidence = max(dot(normal.xyz, u_lightDirection), 0.0);\n\tv_light = u_lightAmbient + (u_lightColor * incidence);\n}\n`;\n\nexport const DefaultWebGL2MeshVertex = `#version 300 es\n\nprecision mediump float;\n\nin vec4 a_position;\nin vec2 a_texcoord;\nin vec3 a_normal;\nin vec4 a_color;\n\nout vec2 v_texcoord;\nout vec3 v_normal;\nout vec4 v_color;\nout vec3 v_light;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelViewMatrix;\nuniform mat4 u_normalMatrix;\n\nuniform vec3 u_lightAmbient;\nuniform vec3 u_lightColor;\nuniform vec3 u_lightDirection;\n\nvoid main() {\n\tgl_Position = u_projectionMatrix * u_modelViewMatrix * a_position;\n\tv_texcoord = a_texcoord;\n\tv_normal = a_normal;\n\tv_color = a_color;\n\n\t// light\n\tvec4 normal = u_normalMatrix * vec4(a_normal, 1.0);\n\tfloat incidence = max(dot(normal.xyz, u_lightDirection), 0.0);\n\tv_light = u_lightAmbient + (u_lightColor * incidence);\n}\n`;\n\nexport const DefaultWebGLMeshFragment = `\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec2 v_texcoord;\nvarying vec3 v_normal;\nvarying vec3 v_light;\nvarying vec4 v_color;\n\nuniform vec2 u_resolution;\nuniform float u_time;\n\nvoid main() {\n\tvec2 uv = v_texcoord;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * uv.y,\n\t\tabs(cos(u_time * 0.2)) * uv.y,\n\t\tabs(sin(u_time)) * uv.y\n\t);\n\tgl_FragColor = vec4(v_color.rgb * color * v_light, 1.0);\n}\n`;\n\nexport const DefaultWebGL2FlatFragment = `#version 300 es\n\nprecision mediump float;\n\nout vec4 outColor;\n\nuniform vec2 u_resolution;\nuniform float u_time;\n\nvoid main() {\n\tvec2 st = gl_FragCoord.xy / u_resolution.xy;\n\tst.x *= u_resolution.x / u_resolution.y;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * st.y,\n\t\tabs(cos(u_time * 0.2)) * st.y,\n\t\tabs(sin(u_time)) * st.y\n\t);\n\toutColor = vec4(color, 1.0);\n}\n`;\n\nexport const DefaultWebGL2MeshFragment = `#version 300 es\n\nprecision mediump float;\n\nin vec2 v_texcoord;\nin vec3 v_light;\nin vec4 v_color;\n\nout vec4 outColor;\n\nuniform vec2 u_resolution;\nuniform float u_time;\n\nvoid main() {\n\tvec2 uv = v_texcoord;\n\tvec3 color = vec3(\n\t\tabs(cos(u_time * 0.1)) * uv.y,\n\t\tabs(cos(u_time * 0.2)) * uv.y,\n\t\tabs(sin(u_time)) * uv.y\n\t);\n\toutColor = vec4(v_color.rgb * color * v_light, 1.0);\n}\n`;\n\nexport enum ContextVersion {\n\tWebGl = 'webgl',\n\tWebGl2 = 'webgl2',\n}\n\nexport enum ContextPrecision {\n\tLowP = 'lowp',\n\tMediumP = 'mediump',\n\tHighP = 'highp',\n}\n\nexport enum ContextMode {\n\tFlat = 'flat',\n\tBox = 'box',\n\tSphere = 'sphere',\n\tTorus = 'torus',\n\tMesh = 'mesh',\n}\n\nexport const ContextDefault = {\n\t'webgl': {\n\t\t'flat': {\n\t\t\tvertex: DefaultWebGLMeshVertex,\n\t\t\tfragment: DefaultWebGLFlatFragment,\n\t\t},\n\t\t'mesh': {\n\t\t\tvertex: DefaultWebGLMeshVertex,\n\t\t\tfragment: DefaultWebGLMeshFragment,\n\t\t}\n\t},\n\t'webgl2': {\n\t\t'flat': {\n\t\t\tvertex: DefaultWebGL2MeshVertex,\n\t\t\tfragment: DefaultWebGL2FlatFragment,\n\t\t},\n\t\t'mesh': {\n\t\t\tvertex: DefaultWebGL2MeshVertex,\n\t\t\tfragment: DefaultWebGL2MeshFragment,\n\t\t}\n\t}\n};\n\nexport enum ContextError {\n\tBrowserSupport = 1,\n\tOther = 2,\n}\n\n/*\nexport interface IContextOptions {\n\talpha?: GLboolean;\n\tantialias?: GLboolean;\n\tdepth?: GLboolean;\n\tfailIfMajorPerformanceCaveat?: boolean;\n\tpowerPreference?: WebGLPowerPreference;\n\tpremultipliedAlpha?: GLboolean;\n\tpreserveDrawingBuffer?: GLboolean;\n\tstencil?: GLboolean;\n}\n*/\n\nexport class ContextVertexBuffers {\n\ttexcoord: WebGLBuffer;\n\tposition: WebGLBuffer;\n}\n\nexport default class Context {\n\n\tstatic precision: ContextPrecision = ContextPrecision.MediumP;\n\tstatic lastError: string = '';\n\n\tstatic getContext_(canvas: HTMLCanvasElement, options?: WebGLContextAttributes): WebGLRenderingContext {\n\t\tconst names = ['webgl', 'experimental-webgl'];\n\t\tlet context = null;\n\t\tfor (let i = 0; i < names.length; ++i) {\n\t\t\ttry {\n\t\t\t\tcontext = canvas.getContext(names[i], options) as WebGLRenderingContext;\n\t\t\t} catch (e) {\n\t\t\t\tif (context) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn context;\n\t}\n\n\tstatic getContext2_(canvas: HTMLCanvasElement, options?: WebGLContextAttributes): WebGL2RenderingContext {\n\t\tlet context = null;\n\t\ttry {\n\t\t\tcontext = canvas.getContext('webgl2', options) as WebGL2RenderingContext;\n\t\t} catch (e) {\n\t\t\t// console.error('GlslCanvas.Context.getContext2_.error', e);\n\t\t}\n\t\treturn context;\n\t}\n\n\tstatic getFragmentVertex(gl: WebGLRenderingContext | WebGL2RenderingContext, fragmentString: string): string {\n\t\tlet vertexString;\n\t\tif (fragmentString) {\n\t\t\tif (Context.isWebGl2(gl)) {\n\t\t\t\tfragmentString = fragmentString.replace(/^\\#version\\s*300\\s*es\\s*\\n/, '');\n\t\t\t}\n\t\t\tconst regexp = /(?:^\\s*)((?:#if|#elif)(?:\\s*)(defined\\s*\\(\\s*VERTEX)(?:\\s*\\))|(?:#ifdef)(?:\\s*VERTEX)(?:\\s*))/gm;\n\t\t\tconst matches = regexp.exec(fragmentString);\n\t\t\tif (matches !== null) {\n\t\t\t\tvertexString = Context.isWebGl2(gl) ? `#version 300 es\n#define VERTEX\n${fragmentString}` : `#define VERTEX\n${fragmentString}`;\n\t\t\t}\n\t\t}\n\t\t// console.log('vertexString', vertexString);\n\t\treturn vertexString;\n\t}\n\n\tstatic getIncludes(input: string | undefined): Promise<string | undefined> {\n\t\tif (input === undefined) {\n\t\t\treturn Promise.resolve(input);\n\t\t}\n\t\tconst regex = /#include\\s*['|\"](.*.glsl)['|\"]/gm;\n\t\tconst promises = [];\n\t\tlet i = 0;\n\t\tlet match;\n\t\twhile ((match = regex.exec(input)) !== null) {\n\t\t\tpromises.push(Promise.resolve(input.slice(i, match.index)));\n\t\t\ti = match.index + match[0].length;\n\t\t\tpromises.push(Common.fetch(match[1]));\n\t\t}\n\t\tpromises.push(Promise.resolve(input.slice(i)));\n\t\treturn Promise.all(promises).then(chunks => {\n\t\t\treturn chunks.join('');\n\t\t});\n\t}\n\n\tstatic isWebGl(context: WebGLRenderingContext | WebGL2RenderingContext): boolean {\n\t\treturn context instanceof WebGLRenderingContext;\n\t}\n\n\tstatic isWebGl2(context: WebGLRenderingContext | WebGL2RenderingContext): boolean {\n\t\t// console.log(context);\n\t\t// return context !== undefined && typeof (context as any).bindBufferRange === 'function';\n\t\treturn (window as any).WebGL2RenderingContext && context instanceof WebGL2RenderingContext;\n\t}\n\n\tstatic inferVersion(vertexString?: string, fragmentString?: string): ContextVersion {\n\t\tconst source: string = vertexString || fragmentString;\n\t\tif (source) {\n\t\t\treturn source.indexOf('#version 300 es') === 0 ? ContextVersion.WebGl2 : ContextVersion.WebGl;\n\t\t} else {\n\t\t\treturn ContextVersion.WebGl;\n\t\t}\n\t}\n\n\tstatic inferPrecision(fragmentString: string): ContextPrecision {\n\t\tconst precision: RegExpMatchArray = fragmentString.match(/precision\\s+(.+)\\s+float/);\n\t\tif (precision && precision.length > 1) {\n\t\t\tContext.precision = precision[1] as ContextPrecision;\n\t\t}\n\t\t// console.log('precision', Context.precision);\n\t\treturn Context.precision;\n\t}\n\n\tstatic versionDiffers(gl: WebGLRenderingContext | WebGL2RenderingContext, vertexString?: string, fragmentString?: string): boolean {\n\t\tif (gl) {\n\t\t\tconst currentVersion = this.isWebGl2(gl) ? ContextVersion.WebGl2 : ContextVersion.WebGl;\n\t\t\tconst newVersion = Context.inferVersion(vertexString, fragmentString);\n\t\t\treturn newVersion !== currentVersion;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tstatic getBufferVertex(gl: WebGLRenderingContext | WebGL2RenderingContext): string {\n\t\treturn this.isWebGl2(gl) ? DefaultWebGL2BufferVertex : DefaultWebGLBufferVertex;\n\t}\n\n\tstatic getVertex(vertexString?: string, fragmentString?: string, mode: ContextMode = ContextMode.Flat): string {\n\t\tif (vertexString) {\n\t\t\treturn vertexString;\n\t\t} else {\n\t\t\tconst version: ContextVersion = this.inferVersion(vertexString, fragmentString);\n\t\t\treturn ContextDefault[version][mode === ContextMode.Flat ? 'flat' : 'mesh'].vertex;\n\t\t}\n\t}\n\n\tstatic getFragment(vertexString?: string, fragmentString?: string, mode: ContextMode = ContextMode.Flat): string {\n\t\tif (fragmentString) {\n\t\t\treturn fragmentString;\n\t\t} else {\n\t\t\tconst version: ContextVersion = this.inferVersion(vertexString, fragmentString);\n\t\t\treturn ContextDefault[version][mode === ContextMode.Flat ? 'flat' : 'mesh'].fragment;\n\t\t}\n\t}\n\n\tstatic tryInferContext(vertexString: string, fragmentString: string, canvas: HTMLCanvasElement, attributes: WebGLContextAttributes, extensions: string[] = [], errorCallback: Function): WebGLRenderingContext | WebGL2RenderingContext {\n\t\tfunction handleError(errorCode: number, html: string) {\n\t\t\tif (typeof errorCallback === 'function') {\n\t\t\t\terrorCallback(errorCode);\n\t\t\t} else {\n\t\t\t\tconst container = canvas.parentNode;\n\t\t\t\tif (container) {\n\t\t\t\t\t(container as HTMLElement).innerHTML = `<div class=\"glsl-canvas--error\">${html}</div>`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!WebGLRenderingContext) {\n\t\t\thandleError(ContextError.BrowserSupport, `This page requires a browser that supports WebGL.<br/>\n\t\t\t<a href=\"http://get.webgl.org\">Click here to upgrade your browser.</a>`);\n\t\t\treturn null;\n\t\t}\n\t\tconst context: WebGLRenderingContext | WebGL2RenderingContext = Context.inferContext(vertexString, fragmentString, canvas, attributes);\n\t\tif (!context) {\n\t\t\thandleError(ContextError.Other, `It does not appear your computer can support WebGL.<br/>\n\t\t\t<a href=\"http://get.webgl.org/troubleshooting/\">Click here for more information.</a>`);\n\t\t} else {\n\t\t\tif (!(this.isWebGl2(context)) && extensions.indexOf('OES_standard_derivatives') === -1) {\n\t\t\t\textensions.push('OES_standard_derivatives');\n\t\t\t}\n\t\t\tconst supportedExtensions = context.getSupportedExtensions();\n\t\t\textensions.forEach(key => {\n\t\t\t\tif (supportedExtensions.indexOf(key) !== -1) {\n\t\t\t\t\tcontext.getExtension(key);\n\t\t\t\t} else {\n\t\t\t\t\tLogger.warn(`GlslCanvas ${key} not supported`);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// context.getExtension('OES_standard_derivatives');\n\t\t}\n\t\treturn context;\n\t}\n\n\tstatic tryGetContext(canvas: HTMLCanvasElement, attributes: WebGLContextAttributes, errorCallback: Function): WebGLRenderingContext {\n\t\tfunction handleError(errorCode: number, html: string) {\n\t\t\tif (typeof errorCallback === 'function') {\n\t\t\t\terrorCallback(errorCode);\n\t\t\t} else {\n\t\t\t\tconst container = canvas.parentNode;\n\t\t\t\tif (container) {\n\t\t\t\t\t(container as HTMLElement).innerHTML = `<div class=\"glsl-canvas--error\">${html}</div>`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!WebGLRenderingContext) {\n\t\t\thandleError(ContextError.BrowserSupport, `This page requires a browser that supports WebGL.<br/>\n\t\t\t<a href=\"http://get.webgl.org\">Click here to upgrade your browser.</a>`);\n\t\t\treturn null;\n\t\t}\n\t\tconst context: WebGLRenderingContext = Context.getContext_(canvas, attributes);\n\t\tif (!context) {\n\t\t\thandleError(ContextError.Other, `It does not appear your computer can support WebGL.<br/>\n\t\t\t<a href=\"http://get.webgl.org/troubleshooting/\">Click here for more information.</a>`);\n\t\t} else {\n\t\t\tcontext.getExtension('OES_standard_derivatives');\n\t\t}\n\t\treturn context;\n\t}\n\n\tstatic inferContext(vertexString: string, fragmentString: string, canvas: HTMLCanvasElement, options?: WebGLContextAttributes): WebGLRenderingContext | WebGL2RenderingContext {\n\t\tconst version: ContextVersion = this.inferVersion(vertexString, fragmentString);\n\t\treturn version === ContextVersion.WebGl2 ? this.getContext2_(canvas, options) : this.getContext_(canvas, options);\n\t}\n\n\tstatic createShader(gl: WebGLRenderingContext | WebGL2RenderingContext, source: string, type: number, offset: number = 0): WebGLShader {\n\t\tconst shader = gl.createShader(type);\n\t\tsource = source.replace(/precision\\s+(.+)\\s+float/, `precision ${Context.precision} float`);\n\t\tgl.shaderSource(shader, source);\n\t\tgl.compileShader(shader);\n\t\tconst compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\t\tif (!compiled) {\n\t\t\t// Something went wrong during compilation; get the error\n\t\t\tContext.lastError = gl.getShaderInfoLog(shader);\n\t\t\t// console.log('lastError', Context.lastError);\n\t\t\tLogger.error(`*** Error compiling shader: ${Context.lastError}`);\n\t\t\t// main.trigger('error', {\n\t\t\tgl.deleteShader(shader);\n\t\t\tthrow ({\n\t\t\t\tshader: shader,\n\t\t\t\tsource: source,\n\t\t\t\ttype: type,\n\t\t\t\terror: Context.lastError,\n\t\t\t\toffset: offset\n\t\t\t});\n\t\t}\n\t\treturn shader;\n\t}\n\n\tstatic createProgram(gl: WebGLRenderingContext | WebGL2RenderingContext, shaders: WebGLShader[], attributes?: any[], locations?: number[]): WebGLProgram {\n\t\tconst program = gl.createProgram();\n\t\tfor (let i = 0; i < shaders.length; ++i) {\n\t\t\tgl.attachShader(program, shaders[i]);\n\t\t}\n\t\tif (attributes && locations) {\n\t\t\tfor (let i = 0; i < attributes.length; ++i) {\n\t\t\t\tgl.bindAttribLocation(program, locations ? locations[i] : i, attributes[i]);\n\t\t\t}\n\t\t}\n\t\tgl.linkProgram(program);\n\t\tgl.validateProgram(program);\n\t\t// Check the link status\n\t\tconst linked = gl.getProgramParameter(program, gl.LINK_STATUS);\n\t\tif (!linked) {\n\t\t\t// something went wrong with the link\n\t\t\tContext.lastError = gl.getProgramInfoLog(program);\n\t\t\tLogger.error(`Error in program linking: ${Context.lastError}`);\n\t\t\tgl.deleteProgram(program);\n\t\t\treturn null;\n\t\t}\n\t\tgl.useProgram(program);\n\t\treturn program;\n\t}\n\n\tstatic createVertexBuffers(gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram): ContextVertexBuffers {\n\t\tconst vertexBuffers: ContextVertexBuffers = new ContextVertexBuffers();\n\t\tconst texcoordIndex: number = gl.getAttribLocation(program, 'a_texcoord');\n\t\tvertexBuffers.texcoord = gl.createBuffer();\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffers.texcoord);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]), gl.STATIC_DRAW);\n\t\tgl.enableVertexAttribArray(texcoordIndex);\n\t\tgl.vertexAttribPointer(texcoordIndex, 2, gl.FLOAT, false, 0, 0);\n\t\tconst positionIndex: number = gl.getAttribLocation(program, 'a_position');\n\t\tvertexBuffers.position = gl.createBuffer();\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffers.position);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0]), gl.STATIC_DRAW);\n\t\tgl.enableVertexAttribArray(positionIndex);\n\t\tgl.vertexAttribPointer(positionIndex, 2, gl.FLOAT, false, 0, 0);\n\t\treturn vertexBuffers;\n\t}\n\n}\n","import Context from '../context/context';\nimport IterableStringMap from '../core/iterable';\nimport FlatGeometry from '../geometry/flat-geometry';\nimport Geometry from '../geometry/geometry';\n\nexport const BuffersDefaultFragment = `\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvoid main(){\n\tgl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}`;\n\nexport const BuffersDefaultFragment2 = `#version 300 es\n\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n\toutColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n`;\n\nexport enum BufferFloatType {\n\tFLOAT = 0,\n\tHALF_FLOAT,\n}\n\nexport class Buffer {\n\n\tstatic floatType: BufferFloatType = BufferFloatType.HALF_FLOAT;\n\ttexture: WebGLTexture;\n\tbuffer: WebGLFramebuffer;\n\tBW: number;\n\tBH: number;\n\tindex: number;\n\n\tconstructor(gl: WebGLRenderingContext | WebGL2RenderingContext, BW: number, BH: number, index: number) {\n\t\t// BW = BH = 1024;\n\t\tconst buffer = gl.createFramebuffer();\n\t\tconst texture = this.getTexture(gl, BW, BH, index);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\tthis.texture = texture;\n\t\tthis.buffer = buffer;\n\t\tthis.BW = BW;\n\t\tthis.BH = BH;\n\t\tthis.index = index;\n\t}\n\n\tgetFloatType(gl: WebGLRenderingContext | WebGL2RenderingContext): number {\n\t\tlet floatType: number, extension;\n\t\tif (Buffer.floatType === BufferFloatType.FLOAT) {\n\t\t\tconst extensionName = Context.isWebGl2(gl) ? 'EXT_color_buffer_float' : 'OES_texture_float';\n\t\t\textension = gl.getExtension(extensionName);\n\t\t\tif (extension) {\n\t\t\t\tfloatType = gl.FLOAT;\n\t\t\t} else {\n\t\t\t\tBuffer.floatType = BufferFloatType.HALF_FLOAT;\n\t\t\t\treturn this.getFloatType(gl);\n\t\t\t}\n\t\t} else {\n\t\t\tconst extensionName = Context.isWebGl2(gl) ? 'EXT_color_buffer_half_float' : 'OES_texture_half_float';\n\t\t\textension = gl.getExtension(extensionName);\n\t\t\tif (extension) {\n\t\t\t\tfloatType = extension.HALF_FLOAT_OES;\n\t\t\t} else {\n\t\t\t\tBuffer.floatType = BufferFloatType.FLOAT;\n\t\t\t\treturn this.getFloatType(gl);\n\t\t\t}\n\t\t}\n\t\treturn floatType;\n\t}\n\n\tgetTexture(gl: WebGLRenderingContext | WebGL2RenderingContext, BW: number, BH: number, index: number): WebGLTexture {\n\t\t// BW = BH = 1024;\n\t\tconst floatType = this.getFloatType(gl);\n\t\tconst texture = gl.createTexture();\n\t\tgl.activeTexture(gl.TEXTURE0 + index);\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, (Context.isWebGl2(gl) ? (gl as WebGL2RenderingContext).RGBA16F : gl.RGBA), BW, BH, 0, gl.RGBA, floatType, null);\n\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tif (status !== gl.FRAMEBUFFER_COMPLETE) {\n\t\t\tif (Buffer.floatType === BufferFloatType.FLOAT) {\n\t\t\t\tBuffer.floatType = BufferFloatType.HALF_FLOAT;\n\t\t\t} else {\n\t\t\t\tBuffer.floatType = BufferFloatType.FLOAT;\n\t\t\t}\n\t\t\treturn this.getTexture(gl, BW, BH, index);\n\t\t}\n\t\treturn texture;\n\t}\n\n\tresize(gl: WebGLRenderingContext | WebGL2RenderingContext, BW: number, BH: number) {\n\t\t// BW = BH = 1024;\n\t\tif (BW !== this.BW || BH !== this.BH) {\n\t\t\tconst buffer = this.buffer;\n\t\t\tconst texture = this.texture;\n\t\t\tconst index = this.index;\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, buffer);\n\t\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\t\tconst minW = Math.min(BW, this.BW);\n\t\t\tconst minH = Math.min(BH, this.BH);\n\t\t\tlet pixels: Float32Array;\n\t\t\tlet floatType = this.getFloatType(gl);\n\t\t\tif (status === gl.FRAMEBUFFER_COMPLETE) {\n\t\t\t\tpixels = new Float32Array(minW * minH * 4);\n\t\t\t\tgl.readPixels(0, 0, minW, minH, gl.RGBA, floatType, pixels);\n\t\t\t}\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\t\tconst newIndex = index + 1; // temporary index\n\t\t\tconst newTexture = this.getTexture(gl, BW, BH, newIndex);\n\t\t\tfloatType = this.getFloatType(gl);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t\tif (pixels) {\n\t\t\t\tgl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, minW, minH, gl.RGBA, floatType, pixels);\n\t\t\t}\n\t\t\tconst newBuffer = gl.createFramebuffer();\n\t\t\t/*\n\t\t\tif (!newBuffer) {\n\t\t\t\tLogger.error('Failed to create the frame buffer object');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t*/\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\t\tgl.deleteTexture(texture);\n\t\t\tgl.activeTexture(gl.TEXTURE0 + index);\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, newTexture);\n\t\t\tthis.index = index;\n\t\t\tthis.texture = newTexture;\n\t\t\tthis.buffer = newBuffer;\n\t\t\tthis.BW = BW;\n\t\t\tthis.BH = BH;\n\t\t}\n\t}\n\n}\n\nexport class IOBuffer {\n\n\tprogram: WebGLProgram;\n\tgeometry: Geometry;\n\tinput: Buffer;\n\toutput: Buffer;\n\tindex: number;\n\tkey: string;\n\tvertexString: string;\n\tfragmentString: string;\n\tBW: number;\n\tBH: number;\n\tisValid: boolean = false;\n\n\tconstructor(index: number, key: string, vertexString: string, fragmentString: string) {\n\t\tthis.index = index;\n\t\tthis.key = key;\n\t\tthis.vertexString = vertexString;\n\t\tthis.fragmentString = fragmentString;\n\t\tthis.geometry = new FlatGeometry();\n\t}\n\n\tcreate(gl: WebGLRenderingContext | WebGL2RenderingContext, BW: number, BH: number) {\n\t\t// BW = BH = 1024;\n\t\tconst vertexShader = Context.createShader(gl, this.vertexString, gl.VERTEX_SHADER);\n\t\tlet fragmentShader = Context.createShader(gl, this.fragmentString, gl.FRAGMENT_SHADER, 1);\n\t\tif (!fragmentShader) {\n\t\t\tfragmentShader = Context.createShader(gl, Context.isWebGl2(gl) ? BuffersDefaultFragment2 : BuffersDefaultFragment, gl.FRAGMENT_SHADER);\n\t\t\tthis.isValid = false;\n\t\t} else {\n\t\t\tthis.isValid = true;\n\t\t}\n\t\tconst program = Context.createProgram(gl, [vertexShader, fragmentShader]);\n\t\tif (!program) {\n\t\t\tthis.isValid = false;\n\t\t\tgl.deleteShader(vertexShader);\n\t\t\tgl.deleteShader(fragmentShader);\n\t\t\treturn;\n\t\t}\n\t\tthis.geometry.create(gl, program);\n\t\tgl.deleteShader(vertexShader);\n\t\tgl.deleteShader(fragmentShader);\n\t\tconst input = new Buffer(gl, BW, BH, this.index + 0);\n\t\tconst output = new Buffer(gl, BW, BH, this.index + 2);\n\t\tthis.program = program;\n\t\tthis.input = input;\n\t\tthis.output = output;\n\t\t// console.log(geometry.position.length / 3, geometry.size);\n\t\t// console.log(gl.getProgramInfoLog(program));\n\t\t// Context.lastError = gl.getProgramInfoLog(program);\n\t\t// Logger.warn(`Error in program linking: ${Context.lastError}`);\n\t}\n\n\trender(gl: WebGLRenderingContext | WebGL2RenderingContext, BW: number, BH: number) {\n\t\t// BW = BH = 1024;\n\t\tgl.useProgram(this.program);\n\t\t// gl.activeTexture(gl.TEXTURE0);\n\t\t// gl.bindTexture(gl.TEXTURE_2D, this.input.texture);\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this.output.buffer);\n\t\t// gl.bindTexture(gl.TEXTURE_2D, this.output.texture);\n\t\t// console.log(this.output.texture);\n\t\t// console.log('binding', gl.getParameter(gl.FRAMEBUFFER_BINDING));\n\t\t// gl.enable(gl.DEPTH_TEST); // Enable depth testing\n\t\t// gl.depthFunc(gl.LEQUAL); // Near things obscure far things\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.output.texture, 0);\n\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\t\tif (status === gl.FRAMEBUFFER_COMPLETE) {\n\t\t\t// Clear the canvas before we start drawing on it.\n\t\t\tgl.clearColor(0, 0, 0, 1);  // black\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\t\t}\n\t\t// this.geometry.createAttributes_(gl, this.program);\n\t\t// this.geometry.bindAttributes_(gl, this.program);\n\t\tgl.viewport(0, 0, BW, BH);\n\t\tgl.drawArrays(gl.TRIANGLES, 0, this.geometry.size);\n\t\t// console.log(this.geometry.size);\n\t\t// gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\t// console.log(BW, BH);\n\t\t// console.log(gl.getProgramInfoLog(this.program));\n\t\t// swap\n\t\tconst input = this.input;\n\t\t// const output = this.output;\n\t\tthis.input = this.output;\n\t\tthis.output = input;\n\t\t// console.log('swap');\n\t}\n\n\tresize(gl: WebGLRenderingContext | WebGL2RenderingContext, BW: number, BH: number) {\n\t\t// BW = BH = 1024;\n\t\tgl.useProgram(this.program);\n\t\tgl.viewport(0, 0, BW, BH);\n\t\tthis.input.resize(gl, BW, BH);\n\t\tthis.output.resize(gl, BW, BH);\n\t}\n\n\tdestroy(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n\t\tgl.deleteProgram(this.program);\n\t\tthis.program = null;\n\t\tthis.input = null;\n\t\tthis.output = null;\n\t}\n\n}\n\nexport default class Buffers extends IterableStringMap<IOBuffer> {\n\n\tget count(): number {\n\t\treturn Object.keys(this.values).length * 4;\n\t}\n\n\tstatic getBuffers(gl: WebGLRenderingContext | WebGL2RenderingContext, fragmentString: string, vertexString: string): Buffers {\n\t\tconst buffers: Buffers = new Buffers();\n\t\tlet count = 0;\n\t\tif (fragmentString) {\n\t\t\tif (Context.isWebGl2(gl)) {\n\t\t\t\tfragmentString = fragmentString.replace(/^\\#version\\s*300\\s*es\\s*\\n/, '');\n\t\t\t}\n\t\t\tconst regexp = /(?:^\\s*)((?:#if|#elif)(?:\\s*)(defined\\s*\\(\\s*BUFFER_)(\\d+)(?:\\s*\\))|(?:#ifdef)(?:\\s*BUFFER_)(\\d+)(?:\\s*))/gm;\n\t\t\tlet matches;\n\t\t\twhile ((matches = regexp.exec(fragmentString)) !== null) {\n\t\t\t\tconst i = matches[3] || matches[4];\n\t\t\t\tconst key = 'u_buffer' + i;\n\t\t\t\tconst bufferFragmentString = Context.isWebGl2(gl) ? `#version 300 es\n#define BUFFER_${i}\n${fragmentString}` : `#define BUFFER_${i}\n${fragmentString}`;\n\t\t\t\tconst buffer = new IOBuffer(count, key, vertexString, bufferFragmentString);\n\t\t\t\tbuffer.create(gl, gl.drawingBufferWidth, gl.drawingBufferHeight);\n\t\t\t\tif (buffer.program) {\n\t\t\t\t\tbuffers.set(key, buffer);\n\t\t\t\t} else {\n\t\t\t\t\tthrow (`buffer error ${key}`);\n\t\t\t\t}\n\t\t\t\tcount += 4;\n\t\t\t}\n\t\t}\n\t\treturn buffers;\n\t}\n\n}\n","export class NumberMap<T> { [key: number]: T; };\nexport class StringMap<T> { [key: string]: T; };\n\nexport default class IterableStringMap<T> {\n\n\tvalues: StringMap<T> = new StringMap<T>();\n\n\thas(key: string) {\n\t\treturn this.values.hasOwnProperty(key);\n\t}\n\n\tset(key: string, item: T) {\n\t\tthis.values[key] = item;\n\t}\n\n\tget(key: string): T {\n\t\treturn this.values[key];\n\t}\n\n\tforEach(callbackfn: Function) {\n\t\tlet i = 0;\n\t\tfor (const key in this.values) {\n\t\t\tcallbackfn(this.values[key], i, this.values);\n\t\t\ti++;\n\t\t}\n\t}\n\n\treduce(callbackfn: Function, initialValue?: any) {\n\t\tlet previous = initialValue, i = 0;\n\t\tfor (const key in this.values) {\n\t\t\tprevious = callbackfn(previous, this.values[key], i, this.values);\n\t\t\ti++;\n\t\t}\n\t\treturn previous;\n\t}\n\n}\n","export interface IGeometry {\n\tpositions: number[];\n\tcolors: number[];\n\tnormals: number[];\n\ttexcoords: number[];\n}\n\nexport default class Geometry implements IGeometry {\n\n\tpositions: number[];\n\tcolors: number[];\n\tnormals: number[];\n\ttexcoords: number[];\n\n\tpositionBuffer: WebGLBuffer;\n\tcolorBuffer: WebGLBuffer;\n\tnormalBuffer: WebGLBuffer;\n\ttexcoordBuffer: WebGLBuffer;\n\n\tpositionLocation: number;\n\tcolorLocation: number;\n\tnormalLocation: number;\n\ttexcoordLocation: number;\n\n\tsize: number;\n\n\tconstructor(options?: IGeometry) {\n\t\tif (options) {\n\t\t\tObject.assign(this, options);\n\t\t\tif (this.positions) {\n\t\t\t\tthis.size = this.positions.length / 3;\n\t\t\t}\n\t\t\t/*\n\t\t\tconsole.log(options);\n\t\t\tthis.positions = Geometry.fromIndices(options.indices, options.positions, 3);\n\t\t\tthis.normals = Geometry.fromIndices(options.indices, options.normals, 3);\n\t\t\tthis.texcoords = Geometry.fromIndices(options.indices, options.texcoords, 2);\n\t\t\tthis.colors = Geometry.fromIndices(options.indices, options.colors, 4);\n\t\t\t*/\n\t\t}\n\t}\n\n\tcreate(gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram) {\n\t\tthis.createData_();\n\t\tthis.createAttributes_(gl, program);\n\t}\n\n\tcreateBufferData_(gl: WebGLRenderingContext | WebGL2RenderingContext, type: number, array: BufferSource) {\n\t\tconst buffer = gl.createBuffer();\n\t\tgl.bindBuffer(type, buffer);\n\t\tgl.bufferData(type, array, gl.STATIC_DRAW);\n\t\treturn buffer;\n\t}\n\n\tcreateAttribLocation_(gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram, name: string, size: number, type: number) {\n\t\tconst location: number = gl.getAttribLocation(program, name);\n\t\tgl.enableVertexAttribArray(location);\n\t\tgl.vertexAttribPointer(location, size, type, false, 0, 0);\n\t\treturn location;\n\t}\n\n\tcreateAttributes_(gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram) {\n\t\tif (this.positions) {\n\t\t\tthis.positionBuffer = this.createBufferData_(gl, gl.ARRAY_BUFFER, new Float32Array(this.positions));\n\t\t\tthis.positionLocation = this.createAttribLocation_(gl, program, 'a_position', this.positions.length / this.size, gl.FLOAT);\n\t\t\tgl.bindAttribLocation(program, this.positionLocation, 'a_position');\n\t\t}\n\t\tif (this.texcoords) {\n\t\t\tthis.texcoordBuffer = this.createBufferData_(gl, gl.ARRAY_BUFFER, new Float32Array(this.texcoords));\n\t\t\tthis.texcoordLocation = this.createAttribLocation_(gl, program, 'a_texcoord', this.texcoords.length / this.size, gl.FLOAT);\n\t\t\tgl.bindAttribLocation(program, this.texcoordLocation, 'a_texcoord');\n\t\t}\n\t\tif (this.normals) {\n\t\t\tthis.normalBuffer = this.createBufferData_(gl, gl.ARRAY_BUFFER, new Float32Array(this.normals));\n\t\t\tthis.normalLocation = this.createAttribLocation_(gl, program, 'a_normal', this.normals.length / this.size, gl.FLOAT);\n\t\t\tgl.bindAttribLocation(program, this.normalLocation, 'a_normal');\n\t\t}\n\t\tif (this.colors) {\n\t\t\tthis.colorBuffer = this.createBufferData_(gl, gl.ARRAY_BUFFER, new Float32Array(this.colors));\n\t\t\tthis.colorLocation = this.createAttribLocation_(gl, program, 'a_color', this.colors.length / this.size, gl.FLOAT);\n\t\t\tgl.bindAttribLocation(program, this.colorLocation, 'a_color');\n\t\t}\n\t\t/*\n\t\tconsole.log('positionLocation', this.positionLocation);\n\t\tconsole.log('texcoordLocation', this.texcoordLocation);\n\t\tconsole.log('normalLocation', this.normalLocation);\n\t\tconsole.log('colorLocation', this.colorLocation);\n\t\t*/\n\t}\n\n\tattachAttributes_(gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram) {\n\t\tlet attribLocation: number;\n\t\tif (this.positions) {\n\t\t\t// this.positionLocation = this.createAttribLocation_(gl, program, 'a_position', this.positions.length / this.size, gl.FLOAT);\n\t\t\tattribLocation = gl.getAttribLocation(program, 'a_position');\n\t\t\tgl.enableVertexAttribArray(attribLocation);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n\t\t\tgl.vertexAttribPointer(attribLocation, this.positions.length / this.size, gl.FLOAT, false, 0, 0);\n\t\t\t// gl.bindAttribLocation(program, this.positionLocation, 'a_position');\n\t\t\t// console.log('positionLocation', attribLocation);\n\t\t}\n\t\tif (this.texcoords) {\n\t\t\t// this.texcoordLocation = this.createAttribLocation_(gl, program, 'a_texcoord', this.texcoords.length / this.size, gl.FLOAT);\n\t\t\tattribLocation = gl.getAttribLocation(program, 'a_texcoord');\n\t\t\tgl.enableVertexAttribArray(this.texcoordLocation);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.texcoordBuffer);\n\t\t\tgl.vertexAttribPointer(this.texcoordLocation, this.texcoords.length / this.size, gl.FLOAT, false, 0, 0);\n\t\t\t// gl.bindAttribLocation(program, this.texcoordLocation, 'a_texcoord');\n\t\t\t// console.log('texcoordLocation', attribLocation);\n\t\t}\n\t\tif (this.normals) {\n\t\t\t// this.normalLocation = this.createAttribLocation_(gl, program, 'a_normal', this.normals.length / this.size, gl.FLOAT);\n\t\t\tattribLocation = gl.getAttribLocation(program, 'a_normal');\n\t\t\tgl.enableVertexAttribArray(this.normalLocation);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.normalBuffer);\n\t\t\tgl.vertexAttribPointer(this.normalLocation, this.normals.length / this.size, gl.FLOAT, false, 0, 0);\n\t\t\t// gl.bindAttribLocation(program, this.normalLocation, 'a_normal');\n\t\t\t// console.log('normalLocation', attribLocation);\n\t\t}\n\t\tif (this.colors) {\n\t\t\t// this.colorLocation = this.createAttribLocation_(gl, program, 'a_color', this.colors.length / this.size, gl.FLOAT);\n\t\t\tattribLocation = gl.getAttribLocation(program, 'a_color');\n\t\t\tgl.enableVertexAttribArray(this.colorLocation);\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.colorBuffer);\n\t\t\tgl.vertexAttribPointer(this.colorLocation, this.colors.length / this.size, gl.FLOAT, false, 0, 0);\n\t\t\t// gl.bindAttribLocation(program, this.colorLocation, 'a_color');\n\t\t\t// console.log('colorLocation', attribLocation);\n\t\t}\n\t}\n\n\tbindAttributes_(gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram) {\n\t\tif (this.positions) {\n\t\t\tgl.bindAttribLocation(program, this.positionLocation, 'a_position');\n\t\t}\n\t\tif (this.texcoords) {\n\t\t\tgl.bindAttribLocation(program, this.texcoordLocation, 'a_texcoord');\n\t\t}\n\t\tif (this.normals) {\n\t\t\tgl.bindAttribLocation(program, this.normalLocation, 'a_normal');\n\t\t}\n\t\tif (this.colors) {\n\t\t\tgl.bindAttribLocation(program, this.colorLocation, 'a_color');\n\t\t}\n\t}\n\n\tprotected createData_() {\n\t\t// Now create an array of positions for the cube.\n\t\tthis.positions = [];\n\t\tthis.normals = [];\n\t\tthis.texcoords = [];\n\t\tthis.colors = [];\n\t\tthis.size = 0;\n\t\t// console.log('positions', this.positions.length);\n\t\t// console.log('normals', this.normals.length);\n\t\t// console.log('texcoords', this.texcoords.length);\n\t\t// console.log('colors', this.colors.length);\n\t}\n\n\tstatic fromIndices(indices: number[], array: number[], size: number): number[] {\n\t\tconst buffer: number[] = [];\n\t\tindices.forEach(i => {\n\t\t\tbuffer.push.apply(buffer, array.slice(i * size, i * size + size));\n\t\t});\n\t\treturn buffer;\n\t}\n\n}\n","import Geometry from \"./geometry\";\n\nexport default class FlatGeometry extends Geometry {\n\n\tprotected createData_() {\n\t\tthis.size = 6;\n\t\tthis.positions = [\n\t\t\t-1.0, -1.0, 0.0, 1.0, -1.0, 0.0, 1.0, 1.0, 0.0,\n\t\t\t-1.0, -1.0, 0.0, 1.0, 1.0, 0.0, -1.0, 1.0, 0.0,\n\t\t];\n\t\tthis.texcoords = [\n\t\t\t0.0, 0.0, 1.0, 0.0, 1.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n\t\t];\n\t\tthis.normals = [\n\t\t\t0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,\n\t\t];\n\t\tthis.colors = [\n\t\t\t1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,\n\t\t\t1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,\n\t\t];\n\t\t/*\n\t\tconsole.log('positions', this.positions.length);\n\t\tconsole.log('normals', this.normals.length);\n\t\tconsole.log('texcoords', this.texcoords.length);\n\t\tconsole.log('colors', this.colors.length);\n\t\t*/\n\t}\n\n}\n","export default class Vector2 {\n\n\tisVector2: boolean = true;\n\tx: number;\n\ty: number;\n\n\tconstructor(x: number = 0, y: number = 0) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\n\tcopy(v: Vector2): Vector2 {\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\treturn this;\n\t}\n\n\tlength(): number {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n\n\tnormalize(): Vector2 {\n\t\treturn this.divideScalar(this.length() || 1);\n\t}\n\n\tdivideScalar(scalar: number): Vector2 {\n\t\treturn this.multiplyScalar(1 / scalar);\n\t}\n\n\tmultiplyScalar(scalar: number): Vector2 {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\treturn this;\n\t}\n\n\tsubVectors(a: Vector2, b: Vector2): Vector2 {\n\t\tthis.x = a.x - b.x;\n\t\tthis.y = a.y - b.y;\n\t\treturn this;\n\t}\n\n\taddVectors(a: Vector2, b: Vector2): Vector2 {\n\t\tthis.x = a.x + b.x;\n\t\tthis.y = a.y + b.y;\n\t\treturn this;\n\t}\n\n}\n\n","/**\r\n * Common utilities\r\n * @module glMatrix\r\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\r\n * Sets the type of array used when creating new vectors and matrices\r\n *\r\n * @param {Type} type Array type, such as Float32Array or Array\r\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\r\n * Convert Degree To Radian\r\n *\r\n * @param {Number} a Angle in Degrees\r\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\r\n * Tests whether or not the arguments have approximately the same value, within an absolute\r\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\r\n * than or equal to 1.0, and a relative tolerance is used for larger values)\r\n *\r\n * @param {Number} a The first number to test.\r\n * @param {Number} b The second number to test.\r\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\r\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\r\n * @module mat4\r\n */\n\n/**\r\n * Creates a new identity mat4\r\n *\r\n * @returns {mat4} a new 4x4 matrix\r\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a new mat4 initialized with values from an existing matrix\r\n *\r\n * @param {mat4} a matrix to clone\r\n * @returns {mat4} a new 4x4 matrix\r\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\r\n * Copy the values from one mat4 to another\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\r\n * Create a new mat4 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} A new mat4\r\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\r\n * Set the components of a mat4 to the given values\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} out\r\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\r\n * Set a mat4 to the identity matrix\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @returns {mat4} out\r\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Transpose the values of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\r\n * Inverts a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\r\n * Calculates the adjugate of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\r\n * Calculates the determinant of a mat4\r\n *\r\n * @param {mat4} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\r\n * Multiplies two mat4s\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\r\n * Translate a mat4 by the given vector\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to translate\r\n * @param {vec3} v vector to translate by\r\n * @returns {mat4} out\r\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\r\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {vec3} v the vec3 to scale the matrix by\r\n * @returns {mat4} out\r\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\r\n * Rotates a mat4 by the given angle around the given axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\r\n * Rotates a matrix by the given angle around the X axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\r\n * Rotates a matrix by the given angle around the Y axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\r\n * Rotates a matrix by the given angle around the Z axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.scale(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Scaling vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a given angle around a given axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotate(dest, dest, rad, axis);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from the given angle around the X axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateX(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from the given angle around the Y axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateY(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from the given angle around the Z axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateZ(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a quaternion rotation and vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a new mat4 from a dual quat.\r\n *\r\n * @param {mat4} out Matrix\r\n * @param {quat2} a Dual Quaternion\r\n * @returns {mat4} mat4 receiving operation result\r\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\r\n * Returns the translation vector component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslation,\r\n *  the returned vector will be the same as the translation vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive translation component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\r\n * Returns the scaling factor component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslationScale\r\n *  with a normalized Quaternion paramter, the returned vector will be\r\n *  the same as the scaling vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive scaling factor component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\r\n * Returns a quaternion representing the rotational component\r\n *  of a transformation matrix. If a matrix is built with\r\n *  fromRotationTranslation, the returned quaternion will be the\r\n *  same as the quaternion originally supplied.\r\n * @param {quat} out Quaternion to receive the rotation component\r\n * @param {mat4} mat Matrix to be decomposed (input)\r\n * @return {quat} out\r\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     mat4.translate(dest, origin);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *     mat4.translate(dest, negativeOrigin);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @param {vec3} o The origin vector around which to scale and rotate\r\n * @returns {mat4} out\r\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Calculates a 4x4 matrix from the given quaternion\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Quaternion to create matrix from\r\n *\r\n * @returns {mat4} out\r\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Generates a frustum matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Number} left Left bound of the frustum\r\n * @param {Number} right Right bound of the frustum\r\n * @param {Number} bottom Bottom bound of the frustum\r\n * @param {Number} top Top bound of the frustum\r\n * @param {Number} near Near bound of the frustum\r\n * @param {Number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\r\n * Generates a perspective projection matrix with the given bounds.\r\n * Passing null/undefined/no value for far will generate infinite projection matrix.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} fovy Vertical field of view in radians\r\n * @param {number} aspect Aspect ratio. typically viewport width/height\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum, can be null or Infinity\r\n * @returns {mat4} out\r\n */\n\nexport function perspective(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\r\n * Generates a perspective projection matrix with the given field of view.\r\n * This is primarily useful for generating projection matrices to be used\r\n * with the still experiemental WebVR API.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\r\n * Generates a orthogonal projection matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} left Left bound of the frustum\r\n * @param {number} right Right bound of the frustum\r\n * @param {number} bottom Bottom bound of the frustum\r\n * @param {number} top Top bound of the frustum\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\n\nexport function ortho(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\r\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Generates a matrix that makes something look at something else.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n/**\r\n * Returns a string representation of a mat4\r\n *\r\n * @param {mat4} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\n\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n/**\r\n * Returns Frobenius norm of a mat4\r\n *\r\n * @param {mat4} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\r\n * Adds two mat4's\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat4} out\r\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\r\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat4} out the receiving vector\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat4} out\r\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\r\n * Alias for {@link mat4.multiply}\r\n * @function\r\n */\n\nexport var mul = multiply;\n/**\r\n * Alias for {@link mat4.subtract}\r\n * @function\r\n */\n\nexport var sub = subtract;","// import 'promise-polyfill';\nimport IterableStringMap from '../core/iterable';\nimport Subscriber from '../core/subscriber';\nimport Logger from '../logger/logger';\n\nexport const TextureImageExtensions = ['jpg', 'jpeg', 'png'];\nexport const TextureVideoExtensions = ['ogv', 'webm', 'mp4'];\nexport const TextureExtensions = TextureImageExtensions.concat(TextureVideoExtensions);\n\nexport enum TextureSourceType {\n\tData = 0,\n\tElement = 1,\n\tUrl = 2,\n}\n\nexport enum TextureFilteringType {\n\tMipMap = 'mipmap',\n\tLinear = 'linear',\n\tNearest = 'nearest',\n}\n\nexport interface ITextureData {\n\tdata: Uint8Array;\n\twidth: number;\n\theight: number;\n}\n\nexport interface ITextureOptions {\n\turl?: string;\n\telement?: HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | HTMLElement | Element;\n\tdata?: Uint8Array;\n\twidth?: number;\n\theight?: number;\n\tfiltering?: TextureFilteringType;\n\trepeat?: boolean;\n\tUNPACK_FLIP_Y_WEBGL?: boolean;\n\tUNPACK_PREMULTIPLY_ALPHA_WEBGL?: number;\n\tTEXTURE_WRAP_S?: number; // gl.REPEAT | gl.CLAMP_TO_EDGE | gl.MIRRORED_REPEAT;\n\tTEXTURE_WRAP_T?: number; // gl.REPEAT | gl.CLAMP_TO_EDGE | gl.MIRRORED_REPEAT;\n}\n\nexport interface ITextureInput {\n\tkey: string;\n\turl: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | ITextureData;\n\toptions?: ITextureOptions;\n}\n\nexport function isTextureData(object: any): object is ITextureData {\n\treturn 'data' in object && 'width' in object && 'height' in object;\n}\n\n// GL texture wrapper object for keeping track of a global set of textures, keyed by a unique user-defined name\nexport class Texture extends Subscriber {\n\n\tkey: string;\n\tindex: number;\n\toptions: ITextureOptions;\n\tworkpath: string;\n\twidth: number;\n\theight: number;\n\n\ttexture: WebGLTexture;\n\tsource: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | Uint8Array;\n\tsourceType: TextureSourceType;\n\tfiltering: TextureFilteringType;\n\turl: string;\n\tvalid: boolean = false;\n\tdirty: boolean = false;\n\tanimated: boolean = false;\n\tpowerOf2: boolean = false;\n\n\tconstructor(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\tkey: string,\n\t\tindex: number,\n\t\toptions: ITextureOptions = { filtering: TextureFilteringType.Linear },\n\t\tworkpath?: string,\n\t) {\n\t\tsuper();\n\t\tthis.key = key;\n\t\tthis.index = index;\n\t\tthis.options = options;\n\t\tthis.workpath = workpath;\n\t\tthis.create(gl);\n\t}\n\n\tstatic isPowerOf2(value: number): boolean {\n\t\treturn (value & (value - 1)) === 0;\n\t}\n\n\tstatic isSafari(): boolean {\n\t\treturn /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\t}\n\n\tstatic isTextureUrl(text: string): boolean {\n\t\treturn text && (/\\.(jpg|jpeg|png|ogv|webm|mp4)$/i).test(text.split('?')[0]);\n\t}\n\n\tstatic isTexture(\n\t\turlElementOrData: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | ITextureData,\n\t): boolean {\n\t\tconst options = Texture.getTextureOptions(urlElementOrData);\n\t\treturn options !== undefined;\n\t}\n\n\tstatic getMaxTextureSize(gl: WebGLRenderingContext | WebGL2RenderingContext): number {\n\t\treturn gl.getParameter(gl.MAX_TEXTURE_SIZE);\n\t};\n\n\tstatic getTextureOptions(\n\t\turlElementOrData: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | ITextureData,\n\t\toptions: ITextureOptions = {}\n\t): ITextureOptions {\n\t\tif (typeof urlElementOrData === 'string' && urlElementOrData !== '') {\n\t\t\tif (Texture.isTextureUrl(urlElementOrData)) {\n\t\t\t\toptions.url = urlElementOrData;\n\t\t\t\tif (urlElementOrData.indexOf('?') !== -1) {\n\t\t\t\t\toptions = urlElementOrData.split('?')[1].split('&').reduce(function (prev: ITextureOptions, curr) {\n\t\t\t\t\t\tconst params = curr.split('=');\n\t\t\t\t\t\tconst key = decodeURIComponent(params[0]);\n\t\t\t\t\t\tconst value = decodeURIComponent(params[1]);\n\t\t\t\t\t\tswitch (key) {\n\t\t\t\t\t\t\tcase 'filtering':\n\t\t\t\t\t\t\t\tprev[key] = value as TextureFilteringType;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'repeat':\n\t\t\t\t\t\t\tcase 'UNPACK_FLIP_Y_WEBGL':\n\t\t\t\t\t\t\t\tprev[key] = Boolean(value);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'UNPACK_PREMULTIPLY_ALPHA_WEBGL':\n\t\t\t\t\t\t\tcase 'TEXTURE_WRAP_S':\n\t\t\t\t\t\t\tcase 'TEXTURE_WRAP_T':\n\t\t\t\t\t\t\t\tprev[key] = Number(value);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn prev;\n\t\t\t\t\t}, options);\n\t\t\t\t}\n\t\t\t\treturn options;\n\t\t\t}\n\t\t\tif (document) {\n\t\t\t\turlElementOrData = document.querySelector(urlElementOrData);\n\t\t\t\t// Logger.log(urlElementOrData);\n\t\t\t}\n\t\t}\n\t\tif (urlElementOrData instanceof HTMLCanvasElement || urlElementOrData instanceof HTMLImageElement || urlElementOrData instanceof HTMLVideoElement) {\n\t\t\toptions.element = urlElementOrData;\n\t\t\treturn options;\n\t\t} else if (isTextureData(urlElementOrData)) {\n\t\t\toptions.data = urlElementOrData.data;\n\t\t\toptions.width = urlElementOrData.width;\n\t\t\toptions.height = urlElementOrData.height;\n\t\t\treturn options;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tcreate(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext\n\t): void {\n\t\tthis.texture = gl.createTexture();\n\t\tif (this.texture) {\n\t\t\tthis.valid = true;\n\t\t}\n\t\t// Default to a 1-pixel black texture so we can safely render while we wait for an image to load\n\t\t// See: http://stackoverflow.com/questions/19722247/webgl-wait-for-texture-to-load\n\t\t// [255, 255, 255, 255]\n\t\tthis.setData(gl, 1, 1, new Uint8Array([0, 0, 0, 0]), this.options);\n\t\t// this.bindTexture();\n\t\t// this.load(options);\n\t}\n\n\tload(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\toptions: ITextureOptions = {}\n\t): Promise<Texture> {\n\t\tthis.options = options;\n\t\tif (typeof options.url === 'string') {\n\t\t\tif (this.url === undefined || options.url !== this.url) {\n\t\t\t\treturn this.setUrl(gl, options.url, options);\n\t\t\t} else {\n\t\t\t\treturn Promise.resolve(this);\n\t\t\t}\n\t\t} else if (options.element) {\n\t\t\treturn this.setElement(gl, options.element, options);\n\t\t} else if (options.data && options.width && options.height) {\n\t\t\treturn this.setData(gl, options.width, options.height, options.data, options);\n\t\t} else {\n\t\t\treturn Promise.reject(this);\n\t\t}\n\t}\n\n\tsetUrl(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\turl: string,\n\t\toptions: ITextureOptions = {}\n\t): Promise<Texture> {\n\t\tif (!this.valid) {\n\t\t\treturn Promise.reject(this);\n\t\t}\n\t\tthis.url = url; // save URL reference (will be overwritten when element is loaded below)\n\t\tthis.source = url;\n\t\tthis.sourceType = TextureSourceType.Url;\n\t\tthis.options = Object.assign(this.options, options);\n\t\tconst src = String((url.indexOf(':/') === -1 && this.workpath !== undefined) ? `${this.workpath}/${url}` : url);\n\t\tconst ext = url.split('?')[0].split('.').pop().toLowerCase();\n\t\tconst isVideo = TextureVideoExtensions.indexOf(ext) !== -1;\n\t\tlet element: HTMLVideoElement | HTMLImageElement;\n\t\tlet promise: Promise<Texture>;\n\t\tif (isVideo) {\n\t\t\tLogger.log('GlslCanvas.setUrl video', src);\n\t\t\telement = document.createElement('video'); // new HTMLVideoElement();\n\t\t\telement.setAttribute('preload', 'auto');\n\t\t\t// element.setAttribute('autoplay', 'true');\n\t\t\telement.setAttribute('loop', 'true');\n\t\t\telement.setAttribute('muted', 'true');\n\t\t\telement.setAttribute('playsinline', 'true');\n\t\t\t// element.autoplay = true;\n\t\t\telement.loop = true;\n\t\t\telement.muted = true;\n\t\t\t/*\n\t\t\tif (!(Texture.isSafari() && /(?<!http|https):\\//.test(url))) {\n\t\t\t\telement.crossOrigin = 'anonymous';\n\t\t\t}\n\t\t\t*/\n\t\t\tpromise = this.setElement(gl, element, options);\n\t\t\telement.src = src;\n\t\t\telement.addEventListener('canplay', () => {\n\t\t\t\t(element as HTMLVideoElement).play();\n\t\t\t});\n\t\t} else {\n\t\t\tLogger.log('GlslCanvas.setUrl image', src);\n\t\t\telement = document.createElement('img'); // new HTMLImageElement();\n\t\t\tpromise = this.setElement(gl, element, options);\n\t\t\tif (!(Texture.isSafari() && url.slice(0, 5) === 'data:')) {\n\t\t\t\telement.crossOrigin = 'anonymous';\n\t\t\t}\n\t\t\telement.src = src;\n\t\t}\n\t\treturn promise;\n\t}\n\n\tsetElement(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\telement: HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | HTMLElement | Element,\n\t\toptions: ITextureOptions = {}\n\t): Promise<Texture> {\n\t\toptions = this.options = Object.assign(this.options, options);\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst originalElement = element;\n\t\t\t// a string element is interpeted as a CSS selector\n\t\t\tif (typeof element === 'string') {\n\t\t\t\telement = document.querySelector(element);\n\t\t\t}\n\t\t\tif (element instanceof HTMLCanvasElement ||\n\t\t\t\telement instanceof HTMLImageElement ||\n\t\t\t\telement instanceof HTMLVideoElement) {\n\t\t\t\tthis.source = element;\n\t\t\t\tthis.sourceType = TextureSourceType.Element;\n\t\t\t\tif (element instanceof HTMLVideoElement) {\n\t\t\t\t\tconst video = element as HTMLVideoElement;\n\t\t\t\t\tvideo.addEventListener('loadeddata', (event) => {\n\t\t\t\t\t\tthis.update(gl, options);\n\t\t\t\t\t\tthis.setFiltering(gl, options);\n\t\t\t\t\t\tresolve(this);\n\t\t\t\t\t});\n\t\t\t\t\tvideo.addEventListener('error', (error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t\t\tvideo.load();\n\t\t\t\t} else if (element instanceof HTMLImageElement) {\n\t\t\t\t\telement.addEventListener('load', () => {\n\t\t\t\t\t\tthis.update(gl, options);\n\t\t\t\t\t\tthis.setFiltering(gl, options);\n\t\t\t\t\t\tresolve(this);\n\t\t\t\t\t});\n\t\t\t\t\telement.addEventListener('error', (error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.update(gl, options);\n\t\t\t\t\tthis.setFiltering(gl, options);\n\t\t\t\t\tresolve(this);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet message = `the 'element' parameter (\\`element: ${JSON.stringify(originalElement)}\\`) must be a CSS selector string, or a <canvas>, <image> or <video> object`;\n\t\t\t\tLogger.log(`Texture '${this.key}': ${message}`, options);\n\t\t\t\treject(message);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetData(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\twidth: number,\n\t\theight: number,\n\t\tdata: Uint8Array,\n\t\toptions: ITextureOptions = {}\n\t): Promise<Texture> {\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.options = Object.assign(this.options, options);\n\t\tthis.source = data;\n\t\tthis.sourceType = TextureSourceType.Data;\n\t\tthis.update(gl, options);\n\t\tthis.setFiltering(gl, options);\n\t\treturn Promise.resolve(this);\n\t}\n\n\t// Uploads current image or buffer to the GPU (can be used to update animated textures on the fly)\n\tupdate(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\toptions: ITextureOptions\n\t): void {\n\t\tif (!this.valid) {\n\t\t\treturn;\n\t\t}\n\t\tgl.activeTexture(gl.TEXTURE0 + this.index);\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.texture);\n\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, (options.UNPACK_FLIP_Y_WEBGL === false ? 0 : 1));\n\t\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, options.UNPACK_PREMULTIPLY_ALPHA_WEBGL || 0);\n\t\tif (this.sourceType === TextureSourceType.Element) {\n\t\t\tif (this.source instanceof HTMLImageElement && this.source.naturalWidth && this.source.naturalHeight) {\n\t\t\t\tthis.width = this.source.naturalWidth;\n\t\t\t\tthis.height = this.source.naturalHeight;\n\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.source);\n\t\t\t} else if (this.source instanceof HTMLVideoElement && this.source.videoWidth && this.source.videoHeight) {\n\t\t\t\tthis.width = this.source.videoWidth;\n\t\t\t\tthis.height = this.source.videoHeight;\n\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.source);\n\t\t\t} else if (this.source instanceof HTMLCanvasElement) {\n\t\t\t\tthis.width = this.source.width;\n\t\t\t\tthis.height = this.source.height;\n\t\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.source);\n\t\t\t}\n\t\t} else if (this.sourceType === TextureSourceType.Data) {\n\t\t\tconst imageBuffer: ArrayBufferView = this.source as ArrayBufferView;\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, imageBuffer);\n\t\t}\n\t\tthis.trigger('loaded', this);\n\t}\n\n\ttryUpdate(gl: WebGLRenderingContext | WebGL2RenderingContext): boolean {\n\t\tlet dirty = false;\n\t\tif (this.animated) {\n\t\t\tdirty = true;\n\t\t\tthis.update(gl, this.options);\n\t\t}\n\t\treturn dirty;\n\t}\n\n\tdestroy(gl: WebGLRenderingContext | WebGL2RenderingContext): void {\n\t\tif (!this.valid) {\n\t\t\treturn;\n\t\t}\n\t\tgl.deleteTexture(this.texture);\n\t\tthis.texture = null;\n\t\tdelete this.source;\n\t\tthis.source = null;\n\t\tthis.valid = false;\n\t}\n\n\tsetFiltering(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\toptions: ITextureOptions\n\t): void {\n\t\tif (!this.valid) {\n\t\t\treturn;\n\t\t}\n\t\tconst powerOf2 = Texture.isPowerOf2(this.width) && Texture.isPowerOf2(this.height);\n\t\tlet filtering = options.filtering || TextureFilteringType.MipMap;\n\t\tlet wrapS = options.TEXTURE_WRAP_S || (options.repeat ? gl.REPEAT : gl.CLAMP_TO_EDGE);\n\t\tlet wrapT = options.TEXTURE_WRAP_T || (options.repeat ? gl.REPEAT : gl.CLAMP_TO_EDGE);\n\t\tif (!powerOf2) {\n\t\t\tfiltering = filtering === TextureFilteringType.MipMap ? TextureFilteringType.Linear : filtering;\n\t\t\twrapS = wrapT = gl.CLAMP_TO_EDGE;\n\t\t\tif (options.repeat || options.TEXTURE_WRAP_S || options.TEXTURE_WRAP_T) {\n\t\t\t\tLogger.warn(`GlslCanvas: cannot repeat texture ${options.url} cause is not power of 2.`);\n\t\t\t}\n\t\t}\n\t\tthis.powerOf2 = powerOf2;\n\t\tthis.filtering = filtering;\n\t\t// this.bindTexture();\n\t\t// WebGL has strict requirements on non-power-of-2 textures:\n\t\t// No mipmaps and must clamp to edge\n\t\t// For power-of-2 textures, the following presets are available:\n\t\t// mipmap: linear blend from nearest mip\n\t\t// linear: linear blend from original image (no mips)\n\t\t// nearest: nearest pixel from original image (no mips, 'blocky' look)\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapS);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapT);\n\t\tif (this.filtering === TextureFilteringType.MipMap) {\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR); // TODO: use trilinear filtering by defualt instead?\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t\tgl.generateMipmap(gl.TEXTURE_2D);\n\t\t} else if (this.filtering === TextureFilteringType.Nearest) {\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\t\t} else if (this.filtering === TextureFilteringType.Linear) {\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\t\t}\n\t}\n}\n\nexport default class Textures extends IterableStringMap<Texture> {\n\n\tcount: number = 0;\n\tdirty: boolean = false;\n\tanimated: boolean = false;\n\n\tclean() {\n\t\tfor (const key in this.values) {\n\t\t\tthis.values[key].dirty = false;\n\t\t}\n\t\tthis.dirty = false;\n\t}\n\n\tcreateOrUpdate(\n\t\tgl: WebGLRenderingContext | WebGL2RenderingContext,\n\t\tkey: string,\n\t\turlElementOrData: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | ITextureData,\n\t\tindex: number = 0,\n\t\toptions: ITextureOptions = {},\n\t\tworkpath: string,\n\t): Promise<Texture> {\n\t\tlet texture;\n\t\tconst textureOptions = Texture.getTextureOptions(urlElementOrData, options);\n\t\ttexture = this.get(key);\n\t\tif (!texture) {\n\t\t\ttexture = new Texture(gl, key, index + this.count, textureOptions, workpath);\n\t\t\tthis.count++;\n\t\t\tthis.set(key, texture);\n\t\t}\n\t\tif (textureOptions !== undefined) {\n\t\t\treturn texture.load(gl, textureOptions).then(\n\t\t\t\t(texture) => {\n\t\t\t\t\tif (texture.source instanceof HTMLVideoElement) {\n\t\t\t\t\t\tconst video = texture.source as HTMLVideoElement;\n\t\t\t\t\t\t// Logger.log('video', video);\n\t\t\t\t\t\tvideo.addEventListener('play', () => {\n\t\t\t\t\t\t\t// Logger.log('play', texture.key);\n\t\t\t\t\t\t\ttexture.animated = true;\n\t\t\t\t\t\t\tthis.animated = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvideo.addEventListener('pause', () => {\n\t\t\t\t\t\t\t// Logger.log('pause', texture.key);\n\t\t\t\t\t\t\ttexture.animated = false;\n\t\t\t\t\t\t\tthis.animated = this.reduce((flag: boolean, texture: Texture) => {\n\t\t\t\t\t\t\t\treturn flag || texture.animated;\n\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvideo.addEventListener('seeked', () => {\n\t\t\t\t\t\t\t// Logger.log('seeked');\n\t\t\t\t\t\t\ttexture.update(gl, texture.options);\n\t\t\t\t\t\t\tthis.dirty = true;\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Logger.log('video');\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tvideo.addEventListener('canplaythrough', () => {\n\t\t\t\t\t\t\t// !!!\n\t\t\t\t\t\t\tthis.intervalID = setInterval(() => {\n\t\t\t\t\t\t\t\tthis.update(gl, options);\n\t\t\t\t\t\t\t}, 15);\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t\tvideo.addEventListener('ended', () => {\n\t\t\t\t\t\t\tvideo.currentTime = 0;\n\t\t\t\t\t\t\tvideo.play();\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t\t*/\n\t\t\t\t\t}\n\t\t\t\t\treturn texture;\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\treturn Promise.resolve(texture);\n\t\t}\n\t}\n}\n","export default class Vector3 {\n\n\tisVector3: boolean = true;\n\tx: number;\n\ty: number;\n\tz: number;\n\n\tconstructor(x: number = 0, y: number = 0, z: number = 0) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t}\n\n\tcopy(v: Vector3): Vector3 {\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\t\treturn this;\n\t}\n\n\tlength(): number {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n\t}\n\n\tnormalize(): Vector3 {\n\t\treturn this.divideScalar(this.length() || 1);\n\t}\n\n\n\tdivideScalar(scalar: number): Vector3 {\n\t\treturn this.multiplyScalar(1 / scalar);\n\t}\n\n\tmultiplyScalar(scalar: number): Vector3 {\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\tthis.z *= scalar;\n\t\treturn this;\n\t}\n\n\tsubVectors(a: Vector3, b: Vector3): Vector3 {\n\t\tthis.x = a.x - b.x;\n\t\tthis.y = a.y - b.y;\n\t\tthis.z = a.z - b.z;\n\t\treturn this;\n\t}\n\n\taddVectors(a: Vector3, b: Vector3): Vector3 {\n\t\tthis.x = a.x + b.x;\n\t\tthis.y = a.y + b.y;\n\t\tthis.z = a.z + b.z;\n\t\treturn this;\n\t}\n\n\tcrossVectors(a: Vector3, b: Vector3): Vector3 {\n\t\tvar ax = a.x, ay = a.y, az = a.z;\n\t\tvar bx = b.x, by = b.y, bz = b.z;\n\t\tthis.x = ay * bz - az * by;\n\t\tthis.y = az * bx - ax * bz;\n\t\tthis.z = ax * by - ay * bx;\n\t\treturn this;\n\t}\n\n\t/*\n\tset(x, y, z) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\treturn this;\n\t}\n\n\tsetScalar(scalar) {\n\t\tthis.x = scalar;\n\t\tthis.y = scalar;\n\t\tthis.z = scalar;\n\t\treturn this;\n\t}\n\n\tsetX(x) {\n\t\tthis.x = x;\n\t\treturn this;\n\t}\n\n\tsetY(y) {\n\t\tthis.y = y;\n\t\treturn this;\n\t}\n\n\tsetZ(z) {\n\t\tthis.z = z;\n\t\treturn this;\n\t}\n\n\tsetComponent(index, value) {\n\t\tswitch (index) {\n\t\t\tcase 0: this.x = value; break;\n\t\t\tcase 1: this.y = value; break;\n\t\t\tcase 2: this.z = value; break;\n\t\t\tdefault: throw new Error('index is out of range: ' + index);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetComponent(index) {\n\t\tswitch (index) {\n\t\t\tcase 0: return this.x;\n\t\t\tcase 1: return this.y;\n\t\t\tcase 2: return this.z;\n\t\t\tdefault: throw new Error('index is out of range: ' + index);\n\t\t}\n\n\t}\n\n\tclone() {\n\t\treturn new Vector3(this.x, this.y, this.z);\n\t}\n\n\tadd(v, w) {\n\t\tif (w !== undefined) {\n\t\t\treturn this.addVectors(v, w);\n\t\t}\n\t\tthis.x += v.x;\n\t\tthis.y += v.y;\n\t\tthis.z += v.z;\n\t\treturn this;\n\t}\n\n\taddScalar(s) {\n\t\tthis.x += s;\n\t\tthis.y += s;\n\t\tthis.z += s;\n\t\treturn this;\n\t}\n\n\taddScaledVector(v, s) {\n\t\tthis.x += v.x * s;\n\t\tthis.y += v.y * s;\n\t\tthis.z += v.z * s;\n\t\treturn this;\n\t}\n\n\tsub(v, w) {\n\t\tif (w !== undefined) {\n\t\t\treturn this.subVectors(v, w);\n\t\t}\n\t\tthis.x -= v.x;\n\t\tthis.y -= v.y;\n\t\tthis.z -= v.z;\n\t\treturn this;\n\t}\n\n\tsubScalar(s) {\n\t\tthis.x -= s;\n\t\tthis.y -= s;\n\t\tthis.z -= s;\n\t\treturn this;\n\t}\n\n\n\tmultiply(v, w) {\n\t\tif (w !== undefined) {\n\t\t\treturn this.multiplyVectors(v, w);\n\t\t}\n\t\tthis.x *= v.x;\n\t\tthis.y *= v.y;\n\t\tthis.z *= v.z;\n\t\treturn this;\n\t}\n\n\tmultiplyVectors(a:Vector3, b:Vector3):Vector3 {\n\t\tthis.x = a.x * b.x;\n\t\tthis.y = a.y * b.y;\n\t\tthis.z = a.z * b.z;\n\t\treturn this;\n\t}\n\n\tapplyMatrix3(m) {\n\t\tvar x = this.x, y = this.y, z = this.z;\n\t\tvar e = m.elements;\n\t\tthis.x = e[0] * x + e[3] * y + e[6] * z;\n\t\tthis.y = e[1] * x + e[4] * y + e[7] * z;\n\t\tthis.z = e[2] * x + e[5] * y + e[8] * z;\n\t\treturn this;\n\t}\n\n\tapplyNormalMatrix(m) {\n\t\treturn this.applyMatrix3(m).normalize();\n\t}\n\n\tapplyMatrix4(m) {\n\t\tvar x = this.x, y = this.y, z = this.z;\n\t\tvar e = m.elements;\n\t\tvar w = 1 / (e[3] * x + e[7] * y + e[11] * z + e[15]);\n\t\tthis.x = (e[0] * x + e[4] * y + e[8] * z + e[12]) * w;\n\t\tthis.y = (e[1] * x + e[5] * y + e[9] * z + e[13]) * w;\n\t\tthis.z = (e[2] * x + e[6] * y + e[10] * z + e[14]) * w;\n\t\treturn this;\n\t}\n\n\tapplyQuaternion(q) {\n\t\tvar x = this.x, y = this.y, z = this.z;\n\t\tvar qx = q.x, qy = q.y, qz = q.z, qw = q.w;\n\t\t// calculate quat * vector\n\t\tvar ix = qw * x + qy * z - qz * y;\n\t\tvar iy = qw * y + qz * x - qx * z;\n\t\tvar iz = qw * z + qx * y - qy * x;\n\t\tvar iw = - qx * x - qy * y - qz * z;\n\t\t// calculate result * inverse quat\n\t\tthis.x = ix * qw + iw * - qx + iy * - qz - iz * - qy;\n\t\tthis.y = iy * qw + iw * - qy + iz * - qx - ix * - qz;\n\t\tthis.z = iz * qw + iw * - qz + ix * - qy - iy * - qx;\n\t\treturn this;\n\t}\n\n\tproject(camera) {\n\t\treturn this.applyMatrix4(camera.matrixWorldInverse).applyMatrix4(camera.projectionMatrix);\n\t}\n\n\tunproject(camera) {\n\t\treturn this.applyMatrix4(camera.projectionMatrixInverse).applyMatrix4(camera.matrixWorld);\n\t}\n\n\ttransformDirection(m) {\n\t\t// input: THREE.Matrix4 affine matrix\n\t\t// vector interpreted as a direction\n\t\tvar x = this.x, y = this.y, z = this.z;\n\t\tvar e = m.elements;\n\t\tthis.x = e[0] * x + e[4] * y + e[8] * z;\n\t\tthis.y = e[1] * x + e[5] * y + e[9] * z;\n\t\tthis.z = e[2] * x + e[6] * y + e[10] * z;\n\t\treturn this.normalize();\n\t}\n\n\tdivide(v) {\n\t\tthis.x /= v.x;\n\t\tthis.y /= v.y;\n\t\tthis.z /= v.z;\n\t\treturn this;\n\t}\n\n\tmin(v) {\n\t\tthis.x = Math.min(this.x, v.x);\n\t\tthis.y = Math.min(this.y, v.y);\n\t\tthis.z = Math.min(this.z, v.z);\n\t\treturn this;\n\t}\n\n\tmax(v) {\n\t\tthis.x = Math.max(this.x, v.x);\n\t\tthis.y = Math.max(this.y, v.y);\n\t\tthis.z = Math.max(this.z, v.z);\n\t\treturn this;\n\t}\n\n\tclamp(min, max) {\n\t\t// assumes min < max, componentwise\n\t\tthis.x = Math.max(min.x, Math.min(max.x, this.x));\n\t\tthis.y = Math.max(min.y, Math.min(max.y, this.y));\n\t\tthis.z = Math.max(min.z, Math.min(max.z, this.z));\n\t\treturn this;\n\t}\n\n\tclampScalar(minVal, maxVal) {\n\t\tthis.x = Math.max(minVal, Math.min(maxVal, this.x));\n\t\tthis.y = Math.max(minVal, Math.min(maxVal, this.y));\n\t\tthis.z = Math.max(minVal, Math.min(maxVal, this.z));\n\t\treturn this;\n\t}\n\n\tclampLength(min, max) {\n\t\tvar length = this.length();\n\t\treturn this.divideScalar(length || 1).multiplyScalar(Math.max(min, Math.min(max, length)));\n\t}\n\n\tfloor() {\n\t\tthis.x = Math.floor(this.x);\n\t\tthis.y = Math.floor(this.y);\n\t\tthis.z = Math.floor(this.z);\n\t\treturn this;\n\t}\n\n\tceil() {\n\t\tthis.x = Math.ceil(this.x);\n\t\tthis.y = Math.ceil(this.y);\n\t\tthis.z = Math.ceil(this.z);\n\t\treturn this;\n\t}\n\n\tround() {\n\t\tthis.x = Math.round(this.x);\n\t\tthis.y = Math.round(this.y);\n\t\tthis.z = Math.round(this.z);\n\t\treturn this;\n\t}\n\n\troundToZero() {\n\t\tthis.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\n\t\tthis.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\n\t\tthis.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\n\t\treturn this;\n\t}\n\n\tnegate() {\n\t\tthis.x = - this.x;\n\t\tthis.y = - this.y;\n\t\tthis.z = - this.z;\n\t\treturn this;\n\t}\n\n\tdot(v) {\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\n\t}\n\n\t// TODO lengthSquared?\n\tlengthSq() {\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\n\t}\n\n\tmanhattanLength() {\n\t\treturn Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z);\n\t}\n\n\tsetLength(length) {\n\t\treturn this.normalize().multiplyScalar(length);\n\t}\n\n\tlerp(v, alpha) {\n\t\tthis.x += (v.x - this.x) * alpha;\n\t\tthis.y += (v.y - this.y) * alpha;\n\t\tthis.z += (v.z - this.z) * alpha;\n\t\treturn this;\n\t}\n\n\tlerpVectors(v1, v2, alpha) {\n\t\treturn this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\n\t}\n\n\tcross(v, w) {\n\t\tif (w !== undefined) {\n\t\t\treturn this.crossVectors(v, w);\n\t\t}\n\t\treturn this.crossVectors(this, v);\n\t}\n\n\tprojectOnVector(v) {\n\t\tvar denominator = v.lengthSq();\n\t\tif (denominator === 0) return this.set(0, 0, 0);\n\t\tvar scalar = v.dot(this) / denominator;\n\t\treturn this.copy(v).multiplyScalar(scalar);\n\t}\n\n\tprojectOnPlane(planeNormal) {\n\t\tconst v = new Vector3();\n\t\tv.copy(this).projectOnVector(planeNormal);\n\t\treturn this.sub(v);\n\t}\n\n\treflect(normal) {\n\t\tconst v = new Vector3();\n\t\treturn this.sub(v.copy(normal).multiplyScalar(2 * this.dot(normal)));\n\t}\n\n\tangleTo(v) {\n\t\tvar denominator = Math.sqrt(this.lengthSq() * v.lengthSq());\n\t\tif (denominator === 0) return Math.PI / 2;\n\t\tvar theta = this.dot(v) / denominator;\n\t\t// clamp, to handle numerical problems\n\t\treturn Math.acos(MathUtils.clamp(theta, - 1, 1));\n\t}\n\n\tdistanceTo(v) {\n\t\treturn Math.sqrt(this.distanceToSquared(v));\n\t}\n\n\tdistanceToSquared(v) {\n\t\tvar dx = this.x - v.x, dy = this.y - v.y, dz = this.z - v.z;\n\t\treturn dx * dx + dy * dy + dz * dz;\n\t}\n\n\tmanhattanDistanceTo(v) {\n\t\treturn Math.abs(this.x - v.x) + Math.abs(this.y - v.y) + Math.abs(this.z - v.z);\n\t}\n\n\tsetFromSpherical(s) {\n\t\treturn this.setFromSphericalCoords(s.radius, s.phi, s.theta);\n\t}\n\n\tsetFromSphericalCoords(radius, phi, theta) {\n\t\tvar sinPhiRadius = Math.sin(phi) * radius;\n\t\tthis.x = sinPhiRadius * Math.sin(theta);\n\t\tthis.y = Math.cos(phi) * radius;\n\t\tthis.z = sinPhiRadius * Math.cos(theta);\n\t\treturn this;\n\t}\n\n\tsetFromCylindrical(c) {\n\t\treturn this.setFromCylindricalCoords(c.radius, c.theta, c.y);\n\t}\n\n\tsetFromCylindricalCoords(radius, theta, y) {\n\t\tthis.x = radius * Math.sin(theta);\n\t\tthis.y = y;\n\t\tthis.z = radius * Math.cos(theta);\n\t\treturn this;\n\t}\n\n\tsetFromMatrixPosition(m) {\n\t\tvar e = m.elements;\n\t\tthis.x = e[12];\n\t\tthis.y = e[13];\n\t\tthis.z = e[14];\n\t\treturn this;\n\t}\n\n\tsetFromMatrixScale(m) {\n\t\tvar sx = this.setFromMatrixColumn(m, 0).length();\n\t\tvar sy = this.setFromMatrixColumn(m, 1).length();\n\t\tvar sz = this.setFromMatrixColumn(m, 2).length();\n\t\tthis.x = sx;\n\t\tthis.y = sy;\n\t\tthis.z = sz;\n\t\treturn this;\n\t}\n\n\tsetFromMatrixColumn(m, index) {\n\t\treturn this.fromArray(m.elements, index * 4);\n\t}\n\n\tsetFromMatrix3Column(m, index) {\n\t\treturn this.fromArray(m.elements, index * 3);\n\t}\n\n\tequals(v) {\n\t\treturn ((v.x === this.x) && (v.y === this.y) && (v.z === this.z));\n\t}\n\n\tfromArray(array, offset) {\n\t\tif (offset === undefined) offset = 0;\n\t\tthis.x = array[offset];\n\t\tthis.y = array[offset + 1];\n\t\tthis.z = array[offset + 2];\n\t\treturn this;\n\t}\n\n\ttoArray(array, offset) {\n\t\tif (array === undefined) array = [];\n\t\tif (offset === undefined) offset = 0;\n\t\tarray[offset] = this.x;\n\t\tarray[offset + 1] = this.y;\n\t\tarray[offset + 2] = this.z;\n\t\treturn array;\n\t}\n\n\tfromBufferAttribute(attribute, index) {\n\t\tthis.x = attribute.getX(index);\n\t\tthis.y = attribute.getY(index);\n\t\tthis.z = attribute.getZ(index);\n\t\treturn this;\n\t}\n\n\trandom() {\n\t\tthis.x = Math.random();\n\t\tthis.y = Math.random();\n\t\tthis.z = Math.random();\n\t\treturn this;\n\t}\n\t*/\n\n}\n\n","\nimport Vector2 from '../math/vector2';\nimport Vector3 from '../math/vector3';\n\nconst PI = Math.PI;\nconst RAD = PI / 180;\n\nexport default class OrbitCamera extends Vector3 {\n\n\ttheta: number;\n\tphi: number;\n\tradius: number;\n\tposition: Vector3 = new Vector3();\n\tvalue: Float32Array = new Float32Array([0, 0, 0]);\n\tmouse: Vector2;\n\tdirty: boolean = false;\n\n\tconstructor(theta?: number, phi?: number, radius?: number) {\n\t\tsuper();\n\t\tthis.theta = (theta || 0) * RAD;\n\t\tthis.phi = (phi || 0) * RAD;\n\t\tthis.radius = radius || 6.0;\n\t\t// this.update();\n\t}\n\n\tdown(x: number, y: number) {\n\t\tthis.mouse = new Vector2(x, y);\n\t}\n\n\tmove(x: number, y: number) {\n\t\tconst mouse = this.mouse;\n\t\tif (mouse && (mouse.x !== x || mouse.y !== y)) {\n\t\t\tconst theta = (x - mouse.x) * 180 * RAD;\n\t\t\tconst phi = (y - mouse.y) * 180 * RAD;\n\t\t\tmouse.x = x;\n\t\t\tmouse.y = y;\n\t\t\tthis.theta += theta;\n\t\t\tthis.phi = Math.max(-60 * RAD, Math.min(60 * RAD, this.phi + phi));\n\t\t\t// this.update();\n\t\t}\n\t}\n\n\tup() {\n\t\tthis.mouse = null;\n\t}\n\n\twheel(d: number) {\n\t\tthis.radius = Math.max(4.0, Math.min(10.0, this.radius + d * 0.02));\n\t}\n\n\t/*\n\n\tupdate() {\n\t\tconst spr = Math.sin(this.phi) * this.radius;\n\t\tconst x = spr * Math.sin(this.theta);\n\t\tconst y = Math.cos(this.phi) * this.radius;\n\t\tconst z = spr * Math.cos(this.theta);\n\t\tthis.position.x = x;\n\t\tthis.position.y = y;\n\t\tthis.position.z = z;\n\t\tthis.value[0] = x;\n\t\tthis.value[1] = y;\n\t\tthis.value[2] = z;\n\t}\n\n\trender(canvas: Canvas) {\n\t\tconst vector = OrbitCamera.toVector(this);\n\t\tconst array = new Float32Array([vector.x, vector.y, vector.z]);\n\t\tthis.update_(canvas, '3fv', 'vec3', 'u_camera', array);\n\t}\n\n\tupdate_(canvas: Canvas, method, type, name, value) {\n\t\ttry {\n\t\t\tconst u = canvas.uniforms[name] = canvas.uniforms[name] || {};\n\t\t\tu.name = name;\n\t\t\tu.value = value;\n\t\t\tu.type = type;\n\t\t\tu.method = 'uniform' + method;\n\t\t\tu.location = canvas.gl.getUniformLocation(canvas.program, name);\n\t\t\tcanvas.gl[u.method].apply(canvas.gl, [u.location].concat(u.value));\n\t\t} catch (e) {\n\t\t\tconsole.log('fastUpdate', e);\n\t\t}\n\t}\n\n\tstatic toVector(camera: OrbitCamera): Vector3 {\n\t\tcamera.update();\n\t\treturn camera.position;\n\t\tconst spr = Math.sin(camera.phi) * camera.radius;\n\t\tconst x = spr * Math.sin(camera.theta);\n\t\tconst y = Math.cos(camera.phi) * camera.radius;\n\t\tconst z = spr * Math.cos(camera.theta);\n\t\treturn new Vector3(x, y, z);\n\t}\n\t*/\n\n\tstatic fromVector(vector: Vector3) {\n\t\tconst radius = vector.length();\n\t\tconst theta = Math.acos(vector.y / radius); //theta\n\t\tconst phi = Math.atan(vector.x / vector.z); //phi\n\t\treturn new OrbitCamera(theta, phi, radius);\n\t}\n\n}\n","export default class CanvasTimer {\n\n\tstart: number;\n\tprevious: number;\n\tdelay: number = 0.0;\n\tcurrent: number = 0.0;\n\tdelta: number = 0.0;\n\tpaused: boolean = false;\n\n\tconstructor() {\n\t\tthis.start = this.previous = this.now();\n\t}\n\n\tnow() {\n\t\treturn performance.now();\n\t}\n\n\tplay() {\n\t\tif (this.previous) {\n\t\t\tconst now = this.now();\n\t\t\tthis.delay += (now - this.previous);\n\t\t\tthis.previous = now;\n\t\t}\n\t\t// Logger.log(this.delay);\n\t\tthis.paused = false;\n\t}\n\n\tpause() {\n\t\tthis.paused = true;\n\t}\n\n\tnext(): CanvasTimer {\n\t\tconst now = this.now();\n\t\tthis.delta = now - this.previous;\n\t\tthis.current = now - this.start - this.delay;\n\t\tthis.previous = now;\n\t\treturn this;\n\t}\n\n}\n","import Logger from '../logger/logger';\n\nexport class Listener {\n\tevent: string;\n\tcallback: Function;\n\n\tconstructor(\n\t\tevent: string,\n\t\tcallback: Function\n\t) {\n\t\tthis.event = event;\n\t\tthis.callback = callback;\n\t}\n}\n\nexport default class Subscriber {\n\tprivate listeners: Set<Listener> = new Set<Listener>();\n\n\tlogListeners() {\n\t\tthis.listeners.forEach(x => Logger.log(x));\n\t}\n\n\tsubscribe(listener: Listener) {\n\t\tthis.listeners.add(listener);\n\t}\n\n\tunsubscribe(listener: Listener) {\n\t\tthis.listeners.delete(listener);\n\t}\n\n\tunsubscribeAll() {\n\t\tthis.listeners.clear();\n\t}\n\n\ton(event: string, callback: Function) {\n\t\tthis.listeners.add(new Listener(event, callback));\n\t\treturn this;\n\t}\n\n\toff(event: string, callback?: Function) {\n\t\tif (callback) {\n\t\t\tthis.listeners.delete(new Listener(event, callback));\n\t\t} else {\n\t\t\tthis.listeners.forEach(x => {\n\t\t\t\tif (x.event === event) {\n\t\t\t\t\tthis.listeners.delete(x);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this;\n\t}\n\n\ttrigger(event: string, ...data: any[]) {\n\t\tthis.listeners.forEach(x => {\n\t\t\tif (x.event === event && typeof x.callback === 'function') {\n\t\t\t\tx.callback(...data);\n\t\t\t}\n\t\t});\n\t\treturn this;\n\t}\n\n}\n","import Geometry from \"./geometry\";\n\nexport default class BoxGeometry extends Geometry {\n\n\tprotected createData_() {\n\t\tthis.size = 36;\n\t\t// Now create an array of positions for the cube.\n\t\tthis.positions = [\n\t\t\t// Front face\n\t\t\t-1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0,\n\t\t\t-1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0,\n\t\t\t// Back face\n\t\t\t-1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0, -1.0,\n\t\t\t-1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0, -1.0,\n\t\t\t// Top face\n\t\t\t-1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0,\n\t\t\t-1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0,\n\t\t\t// Bottom face\n\t\t\t-1.0, -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, -1.0, 1.0,\n\t\t\t-1.0, -1.0, -1.0, 1.0, -1.0, 1.0, -1.0, -1.0, 1.0,\n\t\t\t// Right face\n\t\t\t1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0,\n\t\t\t1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0,\n\t\t\t// Left face\n\t\t\t-1.0, -1.0, -1.0, -1.0, -1.0, 1.0, -1.0, 1.0, 1.0,\n\t\t\t-1.0, -1.0, -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, -1.0,\n\t\t];\n\t\tthis.texcoords = [\n\t\t\t// Front\n\t\t\t0.0, 0.0, 1.0, 0.0, 1.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n\t\t\t// Back\n\t\t\t0.0, 0.0, 1.0, 0.0, 1.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n\t\t\t// Top\n\t\t\t0.0, 0.0, 1.0, 0.0, 1.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n\t\t\t// Bottom\n\t\t\t0.0, 0.0, 1.0, 0.0, 1.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n\t\t\t// Right\n\t\t\t0.0, 0.0, 1.0, 0.0, 1.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n\t\t\t// Left\n\t\t\t0.0, 0.0, 1.0, 0.0, 1.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n\t\t];\n\t\tthis.normals = [\n\t\t\t// Front\n\t\t\t0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,\n\t\t\t0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,\n\t\t\t// Back\n\t\t\t0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0,\n\t\t\t0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0,\n\t\t\t// Top\n\t\t\t0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0,\n\t\t\t0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0,\n\t\t\t// Bottom\n\t\t\t0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0,\n\t\t\t0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0,\n\t\t\t// Right\n\t\t\t1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0,\n\t\t\t1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0,\n\t\t\t// Left\n\t\t\t-1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0,\n\t\t\t-1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0,\n\t\t];\n\t\t// Now set up the colors for the faces. We'll use solid colors\n\t\t// for each face.\n\t\tconst faceColors = [\n\t\t\t[1.0, 1.0, 1.0, 1.0],    // Front face: white\n\t\t\t[1.0, 0.0, 0.0, 1.0],    // Back face: red\n\t\t\t[0.0, 1.0, 0.0, 1.0],    // Top face: green\n\t\t\t[0.0, 0.0, 1.0, 1.0],    // Bottom face: blue\n\t\t\t[1.0, 1.0, 0.0, 1.0],    // Right face: yellow\n\t\t\t[1.0, 0.0, 1.0, 1.0],    // Left face: purple\n\t\t];\n\t\t// Convert the array of colors into a table for all the vertices.\n\t\tlet colors: number[] = [];\n\t\tfor (var j = 0; j < faceColors.length; ++j) {\n\t\t\tconst c = faceColors[j];\n\t\t\t// Repeat each color four times for the four vertices of the face\n\t\t\tcolors = colors.concat(c, c, c, c, c, c);\n\t\t}\n\t\tthis.colors = colors;\n\t\t/*\n\t\tconsole.log('positions', this.positions.length);\n\t\tconsole.log('normals', this.normals.length);\n\t\tconsole.log('texcoords', this.texcoords.length);\n\t\tconsole.log('colors', this.colors.length);\n\t\t*/\n\t}\n\n}\n","import Vector3 from \"../math/vector3\";\nimport Geometry from \"./geometry\";\n\nexport default class SphereGeometry extends Geometry {\n\n\tprotected createData_() {\n\t\tconst radius = 1.4;\n\t\tconst widthDivisions = 80;\n\t\tconst heightDivisions = 60;\n\t\tconst phiStart = 0;\n\t\tconst phiLength = Math.PI * 2;\n\t\tconst thetaStart = 0;\n\t\tconst thetaLength = Math.PI;\n\t\tconst p = new Vector3();\n\t\tconst n = new Vector3();\n\t\t// buffers\n\t\tconst indices = [];\n\t\tconst positions = [];\n\t\tconst normals = [];\n\t\tconst texcoords = [];\n\t\tconst colors = [];\n\t\t//\n\t\tlet thetaEnd = Math.min(thetaStart + thetaLength, Math.PI);\n\t\tlet ix, iy;\n\t\tlet index = 0;\n\t\tlet grid = [];\n\t\t// generate positions, normals and uvs\n\t\tfor (iy = 0; iy <= heightDivisions; iy++) {\n\t\t\tlet positionRow = [];\n\t\t\tlet v = iy / heightDivisions;\n\t\t\t// special case for the poles\n\t\t\tlet uOffset = 0;\n\t\t\tif (iy == 0 && thetaStart == 0) {\n\t\t\t\tuOffset = 0.5 / widthDivisions;\n\t\t\t} else if (iy == heightDivisions && thetaEnd == Math.PI) {\n\t\t\t\tuOffset = -0.5 / widthDivisions;\n\t\t\t}\n\t\t\tfor (ix = 0; ix <= widthDivisions; ix++) {\n\t\t\t\tlet u = ix / widthDivisions;\n\t\t\t\t// position\n\t\t\t\tp.x = -radius * Math.cos(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\n\t\t\t\tp.y = radius * Math.cos(thetaStart + v * thetaLength);\n\t\t\t\tp.z = radius * Math.sin(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\n\t\t\t\tpositions.push(p.x, p.y, p.z);\n\t\t\t\t// normal\n\t\t\t\tn.copy(p).normalize();\n\t\t\t\tnormals.push(n.x, n.y, n.z);\n\t\t\t\t// uv\n\t\t\t\tconst uvx = (u + uOffset);\n\t\t\t\tconst uvy = (1 - v);\n\t\t\t\ttexcoords.push(uvx, uvy);\n\t\t\t\tcolors.push(1.0, 1.0, 1.0, 1.0);\n\t\t\t\tpositionRow.push(index++);\n\t\t\t}\n\t\t\tgrid.push(positionRow);\n\t\t}\n\t\t// indices\n\t\tfor (iy = 0; iy < heightDivisions; iy++) {\n\t\t\tfor (ix = 0; ix < widthDivisions; ix++) {\n\t\t\t\tconst a = grid[iy][ix + 1];\n\t\t\t\tconst b = grid[iy][ix];\n\t\t\t\tconst c = grid[iy + 1][ix];\n\t\t\t\tconst d = grid[iy + 1][ix + 1];\n\t\t\t\tif (iy !== 0 || thetaStart > 0) indices.push(a, b, d);\n\t\t\t\tif (iy !== heightDivisions - 1 || thetaEnd < Math.PI) indices.push(b, c, d);\n\t\t\t}\n\t\t}\n\t\t// build geometry\n\t\tthis.size = indices.length;\n\t\t// Now create an array of positions for the cube.\n\t\tthis.positions = Geometry.fromIndices(indices, positions, 3);\n\t\tthis.texcoords = Geometry.fromIndices(indices, texcoords, 2);\n\t\tthis.normals = Geometry.fromIndices(indices, normals, 3);\n\t\t// Now set up the colors for the faces. We'll use solid colors\n\t\t// for each face.\n\t\tthis.colors = Geometry.fromIndices(indices, colors, 4);\n\t\t// this.unrapUvw(this.positions);\n\t\t/*\n\t\tconsole.log('positions', this.positions.length);\n\t\tconsole.log('normal', this.normal.length);\n\t\tconsole.log('texcoords', this.texcoords.length);\n\t\tconsole.log('color', this.color.length);\n\t\t*/\n\t}\n\n\t/*\n\tunrapUvw(positions: number[]): void {\n\t\tconst texcoords: number[] = this.texcoords = [];\n\t\tfor (let i = 0; i < positions.length; i += 3) {\n\t\t\tconst v = new Vector3(positions[i], positions[i + 1], positions[i + 2]);\n\t\t\tv.normalize();\n\t\t\tconst pitch = Math.asin(-v.y);\n\t\t\tconst yaw = Math.atan2(v.x, v.z);\n\t\t\tconst tx = 0.5 + pitch / Math.PI; // * 360;\n\t\t\tconst ty = 0.5 + yaw / (Math.PI * 2); // * 180;\n\t\t\ttexcoords.push(tx, ty);\n\t\t}\n\t}\n\t*/\n\n}\n","import Vector3 from \"../math/vector3\";\nimport Geometry from \"./geometry\";\nexport default class TorusGeometry extends Geometry {\n\tprotected createData_() {\n\t\tconst radius: number = 1;\n\t\tconst tube: number = 0.25;\n\t\tconst tubularDivisions: number = 200;\n\t\tconst radialDivisions: number = 40;\n\t\tconst p: number = 2;\n\t\tconst q: number = 3;\n\t\t// buffers\n\t\tconst indices: number[] = [];\n\t\tconst positions: number[] = [];\n\t\tconst normals: number[] = [];\n\t\tconst texcoords: number[] = [];\n\t\tconst colors: number[] = [];\n\t\t// helper variables\n\t\tconst vertex = new Vector3();\n\t\tconst normal = new Vector3();\n\t\tconst p1 = new Vector3();\n\t\tconst p2 = new Vector3();\n\t\tconst B = new Vector3();\n\t\tconst T = new Vector3();\n\t\tconst N = new Vector3();\n\t\t// generate positions, normals and uvs\n\t\tfor (let i: number = 0; i <= tubularDivisions; ++i) {\n\t\t\t// the radian \"u\" is used to calculate the position on the torus curve of the current tubular segement\n\t\t\tconst u = i / tubularDivisions * p * Math.PI * 2;\n\t\t\t// now we calculate two points. p1 is our current position on the curve, p2 is a little farther ahead.\n\t\t\t// these points are used to create a special \"coordinate space\", which is necessary to calculate the correct vertex positions\n\t\t\tthis.calculatePositionOnCurve(u, p, q, radius, p1);\n\t\t\tthis.calculatePositionOnCurve(u + 0.01, p, q, radius, p2);\n\t\t\t// calculate orthonormal basis\n\t\t\tT.subVectors(p2, p1);\n\t\t\tN.addVectors(p2, p1);\n\t\t\tB.crossVectors(T, N);\n\t\t\tN.crossVectors(B, T);\n\t\t\t// normalize B, N. T can be ignored, we don't use it\n\t\t\tB.normalize();\n\t\t\tN.normalize();\n\t\t\tfor (let j: number = 0; j <= radialDivisions; ++j) {\n\t\t\t\t// now calculate the positions. they are nothing more than an extrusion of the torus curve.\n\t\t\t\t// because we extrude a shape in the xy-plane, there is no need to calculate a z-value.\n\t\t\t\tconst v: number = j / radialDivisions * Math.PI * 2;\n\t\t\t\tconst cx: number = - tube * Math.cos(v);\n\t\t\t\tconst cy: number = tube * Math.sin(v);\n\t\t\t\t// now calculate the final vertex position.\n\t\t\t\t// first we orient the extrusion with our basis vectos, then we add it to the current position on the curve\n\t\t\t\tvertex.x = p1.x + (cx * N.x + cy * B.x);\n\t\t\t\tvertex.y = p1.y + (cx * N.y + cy * B.y);\n\t\t\t\tvertex.z = p1.z + (cx * N.z + cy * B.z);\n\t\t\t\tpositions.push(vertex.x, vertex.y, vertex.z);\n\t\t\t\t// normal (p1 is always the center/origin of the extrusion, thus we can use it to calculate the normal)\n\t\t\t\tnormal.subVectors(vertex, p1).normalize();\n\t\t\t\tnormals.push(normal.x, normal.y, normal.z);\n\t\t\t\t// uv\n\t\t\t\ttexcoords.push(i / tubularDivisions);\n\t\t\t\ttexcoords.push(j / radialDivisions);\n\t\t\t\tcolors.push(1.0, 1.0, 1.0, 1.0);\n\t\t\t}\n\t\t}\n\t\t// generate indices\n\t\tfor (let j: number = 1; j <= tubularDivisions; j++) {\n\t\t\tfor (let i: number = 1; i <= radialDivisions; i++) {\n\t\t\t\t// indices\n\t\t\t\tconst a: number = (radialDivisions + 1) * (j - 1) + (i - 1);\n\t\t\t\tconst b: number = (radialDivisions + 1) * j + (i - 1);\n\t\t\t\tconst c: number = (radialDivisions + 1) * j + i;\n\t\t\t\tconst d: number = (radialDivisions + 1) * (j - 1) + i;\n\t\t\t\t// faces\n\t\t\t\tindices.push(a, b, d);\n\t\t\t\tindices.push(b, c, d);\n\t\t\t}\n\t\t}\n\t\t// build geometry\n\t\tthis.size = indices.length;\n\t\t// Now create an array of positions for the cube.\n\t\tthis.positions = Geometry.fromIndices(indices, positions, 3);\n\t\tthis.texcoords = Geometry.fromIndices(indices, texcoords, 2);\n\t\tthis.normals = Geometry.fromIndices(indices, normals, 3);\n\t\t// Now set up the colors for the faces. We'll use solid colors\n\t\t// for each face.\n\t\tthis.colors = Geometry.fromIndices(indices, colors, 4);\n\t\t/*\n\t\tconsole.log('positions', this.positions.length);\n\t\tconsole.log('normals', this.normals.length);\n\t\tconsole.log('texcoords', this.texcoords.length);\n\t\tconsole.log('colors', this.colors.length);\n\t\t*/\n\t}\n\n\tprotected calculatePositionOnCurve(u: number, p: number, q: number, radius: number, position: Vector3): void {\n\t\tconst cu: number = Math.cos(u);\n\t\tconst su: number = Math.sin(u);\n\t\tconst quOverP: number = q / p * u;\n\t\tconst cs: number = Math.cos(quOverP);\n\t\tposition.x = radius * (2 + cs) * 0.5 * cu;\n\t\tposition.y = radius * (2 + cs) * su * 0.5;\n\t\tposition.z = radius * Math.sin(quOverP) * 0.5;\n\t}\n\n}\n","import Common from \"../core/common\";\nimport Geometry, { IGeometry } from \"../geometry/geometry\";\nimport Vector3 from \"../math/vector3\";\n\nconst COLORS = [\n\t[1, 1, 1],\n\t[1, 0, 0],\n\t[0, 1, 0],\n\t[0, 0, 1],\n\t[1, 1, 0],\n\t[0, 1, 1],\n];\n\nlet CI: number = 0;\n\nexport default class ObjLoader {\n\n\tload(url: string): Promise<Geometry> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCommon.fetch(url)\n\t\t\t\t// .then((response) => response.text())\n\t\t\t\t.then((text) => {\n\t\t\t\t\t// console.log(text);\n\t\t\t\t\tconst data = this.parse(text);\n\t\t\t\t\tif (data.positions.length) {\n\t\t\t\t\t\tconst geometry = new Geometry(data as IGeometry);\n\t\t\t\t\t\tresolve(geometry);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject('ObjLoader error: empty positions');\n\t\t\t\t\t}\n\t\t\t\t}, error => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tparseIndices(faceIndices: number[][], k: number, l: number, source: number[][], output: number[], name: string) {\n\t\tlet i = 0;\n\t\twhile (i <= faceIndices.length - 3) {\n\t\t\tlet a, b, c;\n\t\t\tif (i === 0) {\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\t\t\t} else {\n\t\t\t\ta = i - 1;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\t\t\t}\n\t\t\ti++;\n\t\t\tconst indices = [a, b, c];\n\t\t\tfor (let j = 0; j < indices.length; j++) {\n\t\t\t\tconst index = faceIndices[indices[j]][k];\n\t\t\t\tlet values;\n\t\t\t\tif (index && index !== NaN) {\n\t\t\t\t\tvalues = source[index - 1];\n\t\t\t\t\tif (values) {\n\t\t\t\t\t\tvalues = values.slice(0, l);\n\t\t\t\t\t\toutput.push.apply(output, values);\n\t\t\t\t\t}\n\t\t\t\t\t/*\n\t\t\t\t\telse {\n\t\t\t\t\t\tconsole.log('error', name, source.length, index - 1);\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t}\n\t\t\t\t/*\n\t\t\t\telse {\n\t\t\t\t\tvalues = new Array(l).fill(0);\n\t\t\t\t\toutput.push.apply(output, values);\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t}\n\t\t}\n\t}\n\n\tparseFaces(F: number[][][], V: number[][], VN: number[][], VT: number[][], positions: number[], normals: number[], texcoords: number[], colors: number[]) {\n\t\tconst si: number = positions.length;\n\t\tF.forEach(faceIndices => {\n\t\t\t// console.log(faceIndices);\n\t\t\tthis.parseIndices(faceIndices, 0, 3, V, positions, 'positions');\n\t\t\tthis.parseIndices(faceIndices, 2, 3, VN, normals, 'normals');\n\t\t\tthis.parseIndices(faceIndices, 1, 2, VT, texcoords, 'texcoords');\n\t\t});\n\t\tconst vl: number = positions.length - si;\n\t\tif (vl > 0) {\n\t\t\t// console.log(faceIndices.length - 2);\n\t\t\tconst c = new Array(vl / 3).fill(0);\n\t\t\tc.forEach(() => {\n\t\t\t\tconst rgb = COLORS[CI % COLORS.length];\n\t\t\t\tcolors.push(rgb[0], rgb[1], rgb[2], 1.0);\n\t\t\t});\n\t\t\tCI++;\n\t\t\t/*\n\t\t\tconsole.log(positions.length, normals.length, texcoords.length, colors.length,\n\t\t\t\tpositions.length / 3 * 2 === texcoords.length,\n\t\t\t\tpositions.length / 3 * 4 === colors.length);\n\t\t\t*/\n\t\t}\n\t}\n\n\tparse(text: string): IGeometry {\n\t\tlet positions: number[] = [], normals: number[] = [], texcoords: number[] = [], colors: number[] = [];\n\t\tCI = 0;\n\t\tlet V: number[][] = [], VN: number[][] = [], VT: number[][] = [], F: number[][][] = [];\n\t\tif (text.indexOf('\\r\\n') !== - 1) {\n\t\t\ttext = text.replace(/\\r\\n/g, '\\n');\n\t\t}\n\t\t/*\n\t\tif (text.indexOf('\\\\\\n') !== - 1) {\n\t\t\ttext = text.replace(/\\\\\\n/g, '');\n\t\t}\n\t\t*/\n\t\ttext = text.replace(/  /g, ' ');\n\t\tconst lines = text.split('\\n');\n\t\tlines.forEach((line, i) => {\n\t\t\tif (line.indexOf('v ') === 0) {\n\t\t\t\tif (F.length) {\n\t\t\t\t\tthis.parseFaces(F, V, VN, VT, positions, normals, texcoords, colors);\n\t\t\t\t\tF = [];\n\t\t\t\t\t// V = [];\n\t\t\t\t\t// VN = [];\n\t\t\t\t\t// VT = [];\n\t\t\t\t}\n\t\t\t\t// v  0.0012 -0.0055 0.0090\n\t\t\t\tconst a = line.replace('v', '').trim().split(' ');\n\t\t\t\tconst v = a.map(x => parseFloat(x));\n\t\t\t\tV.push(v);\n\t\t\t} else if (line.indexOf('vn ') === 0) {\n\t\t\t\t// vn 0.0128 0.9896 0.1431\n\t\t\t\tconst a = line.replace('vn', '').trim().split(' ');\n\t\t\t\tconst v = a.map(x => parseFloat(x));\n\t\t\t\tconst n = new Vector3(v[0], v[1], v[2]).normalize();\n\t\t\t\tVN.push([n.x, n.y, n.z]);\n\t\t\t} else if (line.indexOf('vt ') === 0) {\n\t\t\t\t// vt 0.5955 0.0054 0.0000\n\t\t\t\tconst a = line.replace('vt', '').trim().split(' ');\n\t\t\t\tconst v = a.map(x => parseFloat(x));\n\t\t\t\tVT.push(v);\n\t\t\t} else if (line.indexOf('f ') === 0) {\n\t\t\t\t// f 1//1 2//2 3//3 4//4\n\t\t\t\tconst a = line.replace('f', '').trim().split(' ');\n\t\t\t\tconst f = a.map((x: string) => {\n\t\t\t\t\tconst indices = x.split('/').map(y => parseInt(y));\n\t\t\t\t\tif (indices.length === 2) {\n\t\t\t\t\t\tindices.push(null);\n\t\t\t\t\t}\n\t\t\t\t\treturn indices;\n\t\t\t\t});\n\t\t\t\tF[F.length] = f;\n\t\t\t} /*\n\t\t\telse if (line.indexOf('polygons') !== -1) {\n\t\t\t\t// # 8588 polygons\n\t\t\t\tconst poly = parseInt(line.split(' ')[1]);\n\t\t\t\tconsole.log('poly', poly);\n\t\t\t}\n\t\t\t*/\n\t\t});\n\t\tif (F.length) {\n\t\t\tthis.parseFaces(F, V, VN, VT, positions, normals, texcoords, colors);\n\t\t}\n\t\tconst boundingBox = { min: new Vector3(Number.POSITIVE_INFINITY), max: new Vector3(Number.NEGATIVE_INFINITY) };\n\t\tfor (let i = 0; i < positions.length; i += 3) {\n\t\t\tboundingBox.min.x = Math.min(boundingBox.min.x, positions[i]);\n\t\t\tboundingBox.min.y = Math.min(boundingBox.min.y, positions[i + 1]);\n\t\t\tboundingBox.min.z = Math.min(boundingBox.min.z, positions[i + 2]);\n\t\t\tboundingBox.max.x = Math.max(boundingBox.max.x, positions[i]);\n\t\t\tboundingBox.max.y = Math.max(boundingBox.max.y, positions[i + 1]);\n\t\t\tboundingBox.max.z = Math.max(boundingBox.max.z, positions[i + 2]);\n\t\t}\n\t\tconst centerX = true, centerY = true, centerZ = true;\n\t\tconst dx = -(boundingBox.min.x + boundingBox.max.x) / 2;\n\t\tconst dy = -(boundingBox.min.y + boundingBox.max.y) / 2;\n\t\tconst dz = -(boundingBox.min.z + boundingBox.max.z) / 2;\n\t\t// console.log(dx, dy, dz);\n\t\tfor (let i = 0; i < positions.length; i += 3) {\n\t\t\tpositions[i] += centerX ? dx : 0;\n\t\t\tpositions[i + 1] += centerY ? dy : 0;\n\t\t\tpositions[i + 2] += centerZ ? dz : 0;\n\t\t}\n\t\tconst radius = positions.reduce((p: number, c: number) => {\n\t\t\treturn Math.max(p, c);\n\t\t}, 0);\n\t\tpositions.forEach((x: number, i: number) => positions[i] = x / radius * 2.0);\n\t\tif (!normals.length) {\n\t\t\tnormals = positions.slice();\n\t\t}\n\t\tif (!texcoords.length) {\n\t\t\ttexcoords = this.unrapUvw(positions);\n\t\t}\n\t\t/*\n\t\tconsole.log(positions.length, normals.length, texcoords.length, colors.length,\n\t\t\tpositions.length / 3 * 2 === texcoords.length,\n\t\t\tpositions.length / 3 * 4 === colors.length);\n\t\t*/\n\t\treturn {\n\t\t\tpositions, normals, texcoords, colors\n\t\t};\n\t}\n\n\tunrapUvw(positions: number[]): number[] {\n\t\tconst texcoords: number[] = [];\n\t\tfor (let i = 0; i < positions.length; i += 3) {\n\t\t\tconst v = new Vector3(positions[i], positions[i + 1], positions[i + 2]);\n\t\t\tv.normalize();\n\t\t\tconst pitch = Math.asin(-v.y);\n\t\t\tconst yaw = Math.atan2(v.x, v.z);\n\t\t\tconst tx = 0.5 + pitch / Math.PI; // * 360;\n\t\t\tconst ty = 0.5 + yaw / (Math.PI * 2); // * 180;\n\t\t\ttexcoords.push(tx, ty);\n\t\t}\n\t\treturn texcoords;\n\t}\n\n}\n","\nimport IterableStringMap from '../core/iterable';\nimport Logger from '../logger/logger';\nimport { Texture } from '../textures/textures';\n\nexport enum UniformMethod {\n\tUnknown = 0,\n\tUniform1i = 'uniform1i', // (intUniformLoc,   v);                 // for int\n\t// Uniform1i  = 'uniform1i', // (boolUniformLoc,   v);                // for bool\n\t// Uniform1i  = 'uniform1i', // (sampler2DUniformLoc,   v);           // for sampler2D\n\t// Uniform1i  = 'uniform1i', // (samplerCubeUniformLoc,   v);         // for samplerCube\n\tUniform2i = 'uniform2i', // (ivec2UniformLoc, v0, v1);            // for ivec2\n\tUniform3i = 'uniform3i', // (ivec3UniformLoc, v0, v1, v2);        // for ivec3\n\tUniform4i = 'uniform4i', // (ivec4UniformLoc, v0, v1, v2, v4);    // for ivec4\n\tUniform1f = 'uniform1f', // (floatUniformLoc, v);                 // for float\n\tUniform2f = 'uniform2f', // (vec2UniformLoc,  v0, v1);            // for vec2\n\tUniform3f = 'uniform3f', // (vec3UniformLoc,  v0, v1, v2);        // for vec3\n\tUniform4f = 'uniform4f', // (vec4UniformLoc,  v0, v1, v2, v4);    // for vec4\n\t//\n\tUniform1iv = 'uniform1iv', // (intUniformLoc, [v]);                 // for int or int array\n\t// Uniform1iv = 'uniform1iv', // (boolUniformLoc, [v]);                // for bool or bool array\n\t// Uniform1iv = 'uniform1iv', // (sampler2DUniformLoc, [v]);           // for sampler2D or sampler2D array\n\t// Uniform1iv = 'uniform1iv', // (samplerCubeUniformLoc, [v]);         // for samplerCube or samplerCube array\n\tUniform2iv = 'uniform2iv', // (ivec2UniformLoc, [v0, v1]);          // for ivec2 or ivec2 array\n\tUniform3iv = 'uniform3iv', // (ivec3UniformLoc, [v0, v1, v2]);      // for ivec3 or ivec3 array\n\tUniform4iv = 'uniform4iv', // (ivec4UniformLoc, [v0, v1, v2, v4]);  // for ivec4 or ivec4 array\n\t//\n\tUniform1fv = 'uniform1fv', // (floatUniformLoc, [v]);               // for float or float array\n\tUniform2fv = 'uniform2fv', // (vec2UniformLoc,  [v0, v1]);          // for vec2 or vec2 array\n\tUniform3fv = 'uniform3fv', // (vec3UniformLoc,  [v0, v1, v2]);      // for vec3 or vec3 array\n\tUniform4fv = 'uniform4fv', // (vec4UniformLoc,  [v0, v1, v2, v4]);  // for vec4 or vec4 array\n\t//\n\tUniformMatrix2fv = 'uniformMatrix2fv', // (mat2UniformLoc, false, [  4x element array ])  // for mat2 or mat2 array\n\tUniformMatrix3fv = 'uniformMatrix3fv', // (mat3UniformLoc, false, [  9x element array ])  // for mat3 or mat3 array\n\tUniformMatrix4fv = 'uniformMatrix4fv', // (mat4UniformLoc, false, [ 16x element array ])  // for mat4 or mat4 array\n}\n\nexport enum UniformType {\n\tUnknown = 0,\n\tFloat,\n\tInt,\n\tBool,\n\tSampler2D,\n\tSamplerCube,\n\tMatrix2fv,\n\tMatrix3fv,\n\tMatrix4fv,\n}\n\nexport const METHODS_INT = [UniformMethod.Uniform1i, UniformMethod.Uniform2i, UniformMethod.Uniform3i, UniformMethod.Uniform4i];\nexport const METHODS_FLOAT = [UniformMethod.Uniform1f, UniformMethod.Uniform2f, UniformMethod.Uniform3f, UniformMethod.Uniform4f];\nexport const METHODS_INTV = [UniformMethod.Uniform1iv, UniformMethod.Uniform2iv, UniformMethod.Uniform3iv, UniformMethod.Uniform4iv];\nexport const METHODS_FLOATV = [UniformMethod.Uniform1fv, UniformMethod.Uniform2fv, UniformMethod.Uniform3fv, UniformMethod.Uniform4fv];\n\nexport interface IUniformOption { [key: string]: any[]; }\n\nexport class Uniform {\n\tmethod: UniformMethod;\n\ttype: UniformType;\n\tkey: string;\n\tvalues: any[];\n\tlocation?: WebGLUniformLocation;\n\tdirty?: boolean = true;\n\tapply?: Function;\n\n\tconstructor(options?: Uniform) {\n\t\tif (options) {\n\t\t\tObject.assign(this, options);\n\t\t}\n\t\tswitch (this.method) {\n\t\t\tcase UniformMethod.UniformMatrix2fv:\n\t\t\tcase UniformMethod.UniformMatrix3fv:\n\t\t\tcase UniformMethod.UniformMatrix4fv:\n\t\t\t\tthis.apply = (gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram) => {\n\t\t\t\t\tif (this.dirty) {\n\t\t\t\t\t\tgl.useProgram(program);\n\t\t\t\t\t\tconst location = gl.getUniformLocation(program, this.key);\n\t\t\t\t\t\t// Logger.log(this.key, this.method, this.values);\n\t\t\t\t\t\t// (gl as any)[this.method].apply(gl, [location].concat(this.values));\n\t\t\t\t\t\t(gl as any)[this.method].apply(gl, [location, false].concat(this.values));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.apply = (gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram) => {\n\t\t\t\t\tif (this.dirty) {\n\t\t\t\t\t\tgl.useProgram(program);\n\t\t\t\t\t\tconst location = gl.getUniformLocation(program, this.key);\n\t\t\t\t\t\t// Logger.log(this.key, this.method, this.values);\n\t\t\t\t\t\t// (gl as any)[this.method].apply(gl, [location].concat(this.values));\n\t\t\t\t\t\t(gl as any)[this.method].apply(gl, [location].concat(this.values));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\t}\n\n}\n\nexport class UniformTexture extends Uniform {\n\n\ttexture: Texture;\n\n\tconstructor(options?: Uniform) {\n\t\tsuper(options);\n\t}\n\n}\n\nexport default class Uniforms extends IterableStringMap<Uniform> {\n\n\tdirty: boolean = false;\n\n\tstatic isArrayOfInteger(array: any[]): boolean {\n\t\treturn array.reduce((flag: boolean, value: any) => {\n\t\t\treturn flag && Number.isInteger(value);\n\t\t}, true);\n\t}\n\n\tstatic isArrayOfNumber(array: any[]): boolean {\n\t\treturn array.reduce((flag: boolean, value: any) => {\n\t\t\treturn flag && typeof value === 'number';\n\t\t}, true);\n\t}\n\n\tstatic isArrayOfBoolean(array: any[]): boolean {\n\t\treturn array.reduce((flag: boolean, value: any) => {\n\t\t\treturn flag && typeof value === 'boolean';\n\t\t}, true);\n\t}\n\n\tstatic isArrayOfTexture(array: any[]): boolean {\n\t\treturn array.reduce((flag: boolean, value: any) => {\n\t\t\treturn flag && Texture.isTexture(value);\n\t\t}, true);\n\t}\n\n\tstatic isArrayOfSampler2D(array: Uniform[]): boolean {\n\t\treturn array.reduce((flag: boolean, value: Uniform) => {\n\t\t\treturn flag && value.type === UniformType.Sampler2D;\n\t\t}, true);\n\t}\n\n\tprivate static getType_(\n\t\tvalues: any[],\n\t): UniformType {\n\t\tlet type = UniformType.Unknown;\n\t\tconst isVector = values.length === 1 && Array.isArray(values[0]);\n\t\tconst subject = isVector ? values[0] : values;\n\t\tif (Uniforms.isArrayOfNumber(subject)) {\n\t\t\ttype = UniformType.Float;\n\t\t} else if (Uniforms.isArrayOfBoolean(subject)) {\n\t\t\ttype = UniformType.Bool;\n\t\t} else if (Uniforms.isArrayOfTexture(subject)) {\n\t\t\ttype = UniformType.Sampler2D;\n\t\t}\n\t\treturn type;\n\t}\n\n\tprivate static getMethod_(\n\t\ttype: UniformType,\n\t\tvalues: any[],\n\t): UniformMethod {\n\t\tlet method = UniformMethod.Unknown;\n\t\tconst isVector = values.length === 1 && Array.isArray(values[0]);\n\t\tconst subject = isVector ? values[0] : values;\n\t\tconst length = subject.length;\n\t\tconst i = length - 1;\n\t\tswitch (type) {\n\t\t\tcase UniformType.Float:\n\t\t\t\tif (isVector) {\n\t\t\t\t\tmethod = i < METHODS_FLOATV.length ? METHODS_FLOATV[i] : UniformMethod.Unknown;\n\t\t\t\t} else {\n\t\t\t\t\tmethod = i < METHODS_FLOAT.length ? METHODS_FLOAT[i] : UniformMethod.Uniform1fv;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UniformType.Int:\n\t\t\tcase UniformType.Bool:\n\t\t\t\tif (isVector) {\n\t\t\t\t\tmethod = i < METHODS_INTV.length ? METHODS_INTV[i] : UniformMethod.Unknown;\n\t\t\t\t} else {\n\t\t\t\t\tmethod = i < METHODS_INT.length ? METHODS_INT[i] : UniformMethod.Uniform1iv;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UniformType.Sampler2D:\n\t\t\t\tif (isVector) {\n\t\t\t\t\tmethod = UniformMethod.Uniform1iv;\n\t\t\t\t} else {\n\t\t\t\t\tmethod = length === 1 ? UniformMethod.Uniform1i : UniformMethod.Uniform1iv;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\treturn method;\n\t}\n\n\tstatic parseUniform(\n\t\tkey: string,\n\t\tvalues: any[],\n\t\ttype: UniformType = null\n\t): Uniform | Uniform[] {\n\t\tlet uniform: Uniform;\n\t\ttype = type || Uniforms.getType_(values);\n\t\tconst method = Uniforms.getMethod_(type, values);\n\t\tif (type !== UniformType.Unknown && method !== UniformMethod.Unknown) {\n\t\t\t// Logger.log('Uniforms.parseUniform', key, UniformType[type], method, values);\n\t\t\tif (type === UniformType.Sampler2D && method === UniformMethod.Uniform1iv) {\n\t\t\t\treturn values[0].map((texture: any, index: number) => {\n\t\t\t\t\treturn new Uniform({\n\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\tkey: `${key}[${index}]`, // `${key.split('[')[0]}[${index}]`,\n\t\t\t\t\t\tvalues: [texture]\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tuniform = new Uniform({\n\t\t\t\t\tmethod: method,\n\t\t\t\t\ttype: type,\n\t\t\t\t\tkey: key,\n\t\t\t\t\tvalues: values\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tLogger.error('Uniforms.parseUniform.Unknown', key, values);\n\t\t}\n\t\t// return this.parseUniform__bak(key, values);\n\t\treturn uniform;\n\t}\n\n\tcreate(method: UniformMethod, type: UniformType, key: string, values: any[]): Uniform {\n\t\tconst uniform = new Uniform({\n\t\t\tmethod: method,\n\t\t\ttype: type,\n\t\t\tkey: key,\n\t\t\tvalues: values,\n\t\t});\n\t\tthis.set(key, uniform);\n\t\tthis.dirty = true;\n\t\treturn uniform;\n\t}\n\n\tcreateTexture(key: string, index: number): UniformTexture {\n\t\tlet uniform;\n\t\tif (key.indexOf(']') !== -1) {\n\t\t\tuniform = new UniformTexture({\n\t\t\t\tmethod: UniformMethod.Uniform1iv,\n\t\t\t\ttype: UniformType.Sampler2D,\n\t\t\t\tkey: key,\n\t\t\t\tvalues: [[index]],\n\t\t\t});\n\t\t} else {\n\t\t\tuniform = new UniformTexture({\n\t\t\t\tmethod: UniformMethod.Uniform1i,\n\t\t\t\ttype: UniformType.Sampler2D,\n\t\t\t\tkey: key,\n\t\t\t\tvalues: [index],\n\t\t\t});\n\t\t}\n\t\tthis.set(key, uniform);\n\t\tthis.dirty = true;\n\t\treturn uniform;\n\t}\n\n\tupdate(method: UniformMethod, type: UniformType, key: string, values: any[]) {\n\t\tconst uniform = this.get(key);\n\t\tif (uniform) {\n\t\t\t// !!! consider performance\n\t\t\t// && (uniform.method !== method || uniform.type !== type || Uniforms.isDifferent(uniform.values, values))) {\n\t\t\tuniform.method = method;\n\t\t\tuniform.type = type;\n\t\t\tuniform.values = values;\n\t\t\tuniform.dirty = true;\n\t\t\tthis.dirty = true;\n\t\t}\n\t}\n\n\tcreateOrUpdate(method: UniformMethod, type: UniformType, key: string, values: any[]) {\n\t\tif (this.has(key)) {\n\t\t\tthis.update(method, type, key, values);\n\t\t} else {\n\t\t\tthis.create(method, type, key, values);\n\t\t}\n\t}\n\n\tapply(gl: WebGLRenderingContext | WebGL2RenderingContext, program: WebGLProgram) {\n\t\tgl.useProgram(program);\n\t\tfor (const key in this.values) {\n\t\t\t// if (typeof this.values[key].apply === 'function') {\n\t\t\tthis.values[key].apply(gl, program);\n\t\t\t// }\n\t\t}\n\t\t// this.forEach(uniform => uniform.apply(gl, program));\n\t}\n\n\tclean() {\n\t\tfor (const key in this.values) {\n\t\t\tthis.values[key].dirty = false;\n\t\t}\n\t\tthis.dirty = false;\n\t}\n\n\t/*\n\t// slow\n\tstatic isDifferent(a: any, b: any): boolean {\n        return JSON.stringify(a) !== JSON.stringify(b);\n    }\n\t*/\n\n\tstatic isDifferent(a: any[], b: any[]) {\n\t\treturn a.length !== b.length || a.reduce((f: boolean, v: any, i: number) => {\n\t\t\treturn f || v !== b[i];\n\t\t}, false);\n\t}\n\n}\n","import { mat4 } from 'gl-matrix';\nimport Buffers, { IOBuffer } from '../buffers/buffers';\nimport OrbitCamera from '../camera/orbit-camera';\nimport CanvasTimer from '../canvas/canvas-timer';\nimport { ContextMode, ContextVertexBuffers } from '../context/context';\nimport Subscriber from '../core/subscriber';\nimport BoxGeometry from '../geometry/box-geometry';\nimport FlatGeometry from '../geometry/flat-geometry';\nimport Geometry from '../geometry/geometry';\nimport SphereGeometry from '../geometry/sphere-geometry';\nimport TorusGeometry from '../geometry/torus-geometry';\nimport ObjLoader from '../loaders/obj-loader';\nimport Logger from '../logger/logger';\nimport Vector2 from '../math/vector2';\nimport Textures, { ITextureInput } from '../textures/textures';\nimport Uniforms, { UniformMethod, UniformType } from '../uniforms/uniforms';\n\nexport default class Renderer extends Subscriber {\n\n\tgl: WebGLRenderingContext | WebGL2RenderingContext;\n\tprogram: WebGLProgram;\n\ttimer: CanvasTimer;\n\tuniforms: Uniforms = new Uniforms();\n\tbuffers: Buffers = new Buffers();\n\ttextures: Textures = new Textures();\n\ttextureList: ITextureInput[] = [];\n\n\tW: number = 0;\n\tH: number = 0;\n\tmouse: Vector2 = new Vector2();\n\tradians: number = 0;\n\tdirty: boolean = true;\n\tanimated: boolean = false;\n\tdrawFunc_: (deltaTime: number) => void;\n\n\tvertexString: string;\n\tfragmentString: string;\n\n\tcamera: OrbitCamera = new OrbitCamera();\n\tgeometry: Geometry;\n\n\tvertexBuffers: ContextVertexBuffers;\n\n\tprojectionMatrix: mat4;\n\tmodelViewMatrix: mat4;\n\tnormalMatrix: mat4;\n\n\tmode: ContextMode;\n\tmesh: string;\n\tdefaultMesh: string;\n\tdoubleSided: boolean;\n\tcache: { [key: string]: Geometry } = {};\n\tworkpath: string;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.drawFunc_ = this.drawArrays_;\n\t}\n\n\tprotected render(): void {\n\t\tconst gl = this.gl;\n\t\tif (!gl) {\n\t\t\treturn;\n\t\t}\n\t\tconst BW = gl.drawingBufferWidth;\n\t\tconst BH = gl.drawingBufferHeight;\n\t\tthis.update_();\n\t\tgl.viewport(0, 0, BW, BH);\n\t\tfor (const key in this.buffers.values) {\n\t\t\tconst buffer: IOBuffer = this.buffers.values[key];\n\t\t\tbuffer.geometry.attachAttributes_(gl, buffer.program);\n\t\t\t// this.uniforms.get('u_resolution').values = [1024, 1024];\n\t\t\tthis.uniforms.apply(gl, buffer.program);\n\t\t\t/*\n\t\t\tconsole.log('uniforms');\n\t\t\tfor (const key in this.uniforms.values) {\n\t\t\t\tif (key.indexOf('u_buff') === 0) {\n\t\t\t\t\tconsole.log(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\t*/\n\t\t\tbuffer.render(gl, BW, BH);\n\t\t}\n\t\t// this.uniforms.get('u_resolution').values = [BW, BH];\n\t\tthis.geometry.attachAttributes_(gl, this.program);\n\t\tthis.uniforms.apply(gl, this.program);\n\t\t// gl.viewport(0, 0, BW, BH);\n\t\tthis.drawFunc_(this.timer.delta);\n\t\tthis.uniforms.clean();\n\t\tthis.textures.clean();\n\t\tthis.dirty = false;\n\t\tthis.trigger('render', this);\n\t}\n\n\t/*\n\tprotected drawArrays_(deltaTime: number) {\n\t\tconst gl = this.gl;\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\tgl.drawArrays(gl.TRIANGLES, 0, 6);\n\t}\n\t*/\n\n\tprotected drawArrays_(deltaTime: number) {\n\t\tconst gl = this.gl;\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\t// Clear\n\t\tgl.viewport(0, 0, this.W, this.H);\n\t\tgl.clearColor(0.0, 0.0, 0.0, 1.0);\n\t\tgl.clearDepth(1.0);\n\t\t// Clear the canvas before we start drawing on it.\n\t\t// gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\t\tgl.enable(gl.DEPTH_TEST);\n\t\tgl.depthFunc(gl.LEQUAL);\n\t\tgl.enable(gl.CULL_FACE);\n\t\tif (this.doubleSided && this.mode !== ContextMode.Flat) {\n\t\t\t// back\n\t\t\t// gl.frontFace(gl.CW);\n\t\t\tgl.cullFace(gl.FRONT);\n\t\t\tgl.drawArrays(gl.TRIANGLES, 0, this.geometry.size);\n\t\t\t// front\n\t\t\tgl.enable(gl.BLEND);\n\t\t\tgl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\t\t}\n\t\t// gl.frontFace(gl.CCW);\n\t\tgl.cullFace(gl.BACK);\n\t\tgl.drawArrays(gl.TRIANGLES, 0, this.geometry.size);\n\t\t// gl.drawElements(gl.TRIANGLES, this.geometry.size, gl.UNSIGNED_SHORT, 0);\n\t}\n\n\tprotected create_(): void {\n\t\tthis.createGeometry_();\n\t\tthis.createUniforms_();\n\t}\n\n\tprotected createGeometry_() {\n\t\t// console.log('Geometry', Geometry);\n\t\t// console.log('FlatGeometry', FlatGeometry);\n\t\t// console.log('BoxGeometry', BoxGeometry);\n\t\tthis.parseGeometry_();\n\t\tthis.setMode(this.mode);\n\t}\n\n\tprotected parseGeometry_() {\n\t\tconst regexp = /^attribute\\s+vec4\\s+a_position\\s*;\\s*\\/\\/\\s*([\\w|\\:\\/\\/|\\.|\\-|\\_|\\?|\\&|\\=]+)/gm;\n\t\tconst match = regexp.exec(this.vertexString);\n\t\tif (match && match.length > 1) {\n\t\t\tthis.mesh = match[1];\n\t\t} else {\n\t\t\tthis.mesh = this.defaultMesh;\n\t\t}\n\t}\n\n\tprotected createUniforms_(): void {\n\t\tconst gl = this.gl;\n\t\tconst fragmentString = this.fragmentString;\n\t\tconst BW = gl.drawingBufferWidth;\n\t\tconst BH = gl.drawingBufferHeight;\n\t\tconst timer = this.timer = new CanvasTimer();\n\t\tconst hasDelta = (fragmentString.match(/u_delta/g) || []).length > 1;\n\t\tconst hasTime = (fragmentString.match(/u_time/g) || []).length > 1;\n\t\tconst hasDate = (fragmentString.match(/u_date/g) || []).length > 1;\n\t\tconst hasMouse = (fragmentString.match(/u_mouse/g) || []).length > 1;\n\t\tthis.animated = hasTime || hasDate || hasMouse;\n\t\tthis.uniforms.create(UniformMethod.Uniform2f, UniformType.Float, 'u_resolution', [BW, BH]);\n\t\tif (hasDelta) {\n\t\t\tthis.uniforms.create(UniformMethod.Uniform1f, UniformType.Float, 'u_delta', [timer.delta / 1000.0]);\n\t\t}\n\t\tif (hasTime) {\n\t\t\tthis.uniforms.create(UniformMethod.Uniform1f, UniformType.Float, 'u_time', [timer.current / 1000.0]);\n\t\t}\n\t\tif (hasDate) {\n\t\t\tconst date = new Date();\n\t\t\tthis.uniforms.create(UniformMethod.Uniform4f, UniformType.Float, 'u_date', [date.getFullYear(), date.getMonth(), date.getDate(), date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds() + date.getMilliseconds() * 0.001]);\n\t\t}\n\t\tif (hasMouse) {\n\t\t\tthis.uniforms.create(UniformMethod.Uniform2f, UniformType.Float, 'u_mouse', [0, 0]);\n\t\t}\n\t\t// if (this.mode !== ContextMode.Flat) {\n\t\tthis.projectionMatrix = mat4.create();\n\t\tthis.uniforms.create(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_projectionMatrix', this.projectionMatrix as number[]);\n\t\tthis.modelViewMatrix = mat4.create();\n\t\tthis.uniforms.create(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_modelViewMatrix', this.modelViewMatrix as number[]);\n\t\tthis.normalMatrix = mat4.create();\n\t\tthis.uniforms.create(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_normalMatrix', this.normalMatrix as number[]);\n\t\tthis.uniforms.create(UniformMethod.Uniform3f, UniformType.Float, 'u_lightAmbient', [0.3, 0.3, 0.3]);\n\t\tthis.uniforms.create(UniformMethod.Uniform3f, UniformType.Float, 'u_lightColor', [1.0, 1.0, 1.0]);\n\t\tthis.uniforms.create(UniformMethod.Uniform3f, UniformType.Float, 'u_lightDirection', [0.0, 0.0, 1.0]);\n\t\t// }\n\t}\n\n\tprotected update_(): void {\n\t\tthis.updateUniforms_();\n\t}\n\n\tprotected updateUniforms_(): void {\n\t\tconst gl = this.gl;\n\t\tconst BW = gl.drawingBufferWidth;\n\t\tconst BH = gl.drawingBufferHeight;\n\t\tif (!this.timer) {\n\t\t\treturn;\n\t\t}\n\t\tconst timer = this.timer.next();\n\t\tthis.uniforms.update(UniformMethod.Uniform2f, UniformType.Float, 'u_resolution', [BW, BH]);\n\t\tif (this.uniforms.has('u_delta')) {\n\t\t\tthis.uniforms.update(UniformMethod.Uniform1f, UniformType.Float, 'u_delta', [timer.delta / 1000.0]);\n\t\t}\n\t\tif (this.uniforms.has('u_time')) {\n\t\t\tthis.uniforms.update(UniformMethod.Uniform1f, UniformType.Float, 'u_time', [timer.current / 1000.0]);\n\t\t}\n\t\tif (this.uniforms.has('u_date')) {\n\t\t\tconst date = new Date();\n\t\t\tthis.uniforms.update(UniformMethod.Uniform4f, UniformType.Float, 'u_date', [date.getFullYear(), date.getMonth(), date.getDate(), date.getHours() * 3600 + date.getMinutes() * 60 + date.getSeconds() + date.getMilliseconds() * 0.001]);\n\t\t}\n\t\tif (this.uniforms.has('u_mouse')) {\n\t\t\tconst mouse = this.mouse;\n\t\t\tthis.uniforms.update(UniformMethod.Uniform2f, UniformType.Float, 'u_mouse', [mouse.x, mouse.y]);\n            /*\n            const rect = this.rect;\n            if (mouse.x >= rect.left && mouse.x <= rect.right &&\n                mouse.y >= rect.top && mouse.y <= rect.bottom) {\n                const MX = (mouse.x - rect.left) * this.devicePixelRatio;\n                const MY = (this.canvas.height - (mouse.y - rect.top) * this.devicePixelRatio);\n                this.uniforms.update(UniformMethod.Uniform2f, UniformType.Float, 'u_mouse', [MX, MY]);\n            }\n            */\n\t\t}\n\t\tif (this.mode !== ContextMode.Flat) {\n\t\t\tthis.uniforms.update(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_projectionMatrix', this.updateProjectionMatrix_() as number[]);\n\t\t\tthis.uniforms.update(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_modelViewMatrix', this.updateModelViewMatrix_(this.timer.delta) as number[]);\n\t\t\tthis.uniforms.update(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_normalMatrix', this.updateNormalMatrix_(this.modelViewMatrix) as number[]);\n\t\t}\n\t}\n\n\tprotected updateProjectionMatrix_(): mat4 {\n\t\tconst gl = this.gl;\n\t\tconst fieldOfView = 45 * Math.PI / 180;\n\t\tconst aspect = gl.drawingBufferWidth / gl.drawingBufferHeight;\n\t\tconst zNear = 0.1;\n\t\tconst zFar = 100.0;\n\t\tmat4.perspective(this.projectionMatrix, fieldOfView, aspect, zNear, zFar);\n\t\treturn this.projectionMatrix;\n\t}\n\n\t/*\n\tprotected updateModelViewMatrix__(deltaTime: number): mat4 {\n\t\tthis.modelViewMatrix = mat4.identity(this.modelViewMatrix);\n\t\tmat4.translate(this.modelViewMatrix, this.modelViewMatrix, [0.0, 0.0, -6.0]); // amount to translate\n\t\tmat4.rotate(this.modelViewMatrix, this.modelViewMatrix, this.radians, [0, 1, 0]); // axis to rotate around (Y)\n\t\t// mat4.rotate(this.modelViewMatrix, this.modelViewMatrix, this.radians * 0.2, [1, 0, 0]); // axis to rotate around (X)\n\t\tthis.radians += deltaTime * 0.001;\n\t\treturn this.modelViewMatrix;\n\t}\n\t*/\n\n\tprotected updateModelViewMatrix_(deltaTime: number): mat4 {\n\t\tthis.modelViewMatrix = mat4.identity(this.modelViewMatrix);\n\t\tmat4.translate(this.modelViewMatrix, this.modelViewMatrix, [0.0, 0.0, -this.camera.radius]); // amount to translate\n\t\tmat4.rotate(this.modelViewMatrix, this.modelViewMatrix, this.camera.theta + this.radians, [0, 1, 0]); // axis to rotate around (Y)\n\t\tmat4.rotate(this.modelViewMatrix, this.modelViewMatrix, this.camera.phi, [1, 0, 0]); // axis to rotate around (X)\n\t\tif (!this.camera.mouse) {\n\t\t\tthis.camera.theta += (0 - this.camera.theta) / 20;\n\t\t\tthis.camera.phi += (0 - this.camera.phi) / 20;\n\t\t\tthis.radians += deltaTime * 0.0005;\n\t\t}\n\t\treturn this.modelViewMatrix;\n\t}\n\n\tprotected updateNormalMatrix_(modelViewMatrix: mat4): mat4 {\n\t\t// this.normalMatrix = mat4.create();\n\t\tthis.normalMatrix = mat4.identity(this.normalMatrix);\n\t\tmat4.invert(this.normalMatrix, modelViewMatrix);\n\t\tmat4.transpose(this.normalMatrix, this.normalMatrix);\n\t\treturn this.normalMatrix;\n\t}\n\n\tpublic setMode(mode: ContextMode) {\n\t\tlet geometry: Geometry;\n\t\tif (mode === ContextMode.Mesh) {\n\t\t\tgeometry = this.cache[this.mesh];\n\t\t\tif (geometry) {\n\t\t\t\tthis.geometry = geometry;\n\t\t\t\tthis.mode = ContextMode.Mesh;\n\t\t\t\tthis.dirty = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tlet loader: ObjLoader;\n\t\tswitch (mode) {\n\t\t\tcase ContextMode.Flat:\n\t\t\t\tgeometry = new FlatGeometry();\n\t\t\t\tthis.uniforms.update(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_projectionMatrix', mat4.create() as number[]);\n\t\t\t\tthis.uniforms.update(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_modelViewMatrix', mat4.create() as number[]);\n\t\t\t\tthis.uniforms.update(UniformMethod.UniformMatrix4fv, UniformType.Float, 'u_normalMatrix', mat4.create() as number[]);\n\t\t\t\tbreak;\n\t\t\tcase ContextMode.Box:\n\t\t\t\tgeometry = new BoxGeometry();\n\t\t\t\tbreak;\n\t\t\tcase ContextMode.Sphere:\n\t\t\t\tgeometry = new SphereGeometry();\n\t\t\t\tbreak;\n\t\t\tcase ContextMode.Torus:\n\t\t\t\tgeometry = new TorusGeometry();\n\t\t\t\tbreak;\n\t\t\tcase ContextMode.Mesh:\n\t\t\t\tgeometry = new FlatGeometry();\n\t\t\t\tif (this.mesh) {\n\t\t\t\t\tloader = new ObjLoader();\n\t\t\t\t\tloader.load(this.getResource(this.mesh)).then(geometry => {\n\t\t\t\t\t\tgeometry.createAttributes_(this.gl, this.program);\n\t\t\t\t\t\tconst cache: { [key: string]: Geometry } = {};\n\t\t\t\t\t\tcache[this.mesh] = geometry;\n\t\t\t\t\t\tthis.cache = cache;\n\t\t\t\t\t\tthis.geometry = geometry;\n\t\t\t\t\t\tthis.dirty = true;\n\t\t\t\t\t}, error => {\n\t\t\t\t\t\tLogger.warn('GlslCanvas', error);\n\t\t\t\t\t\tthis.mode = ContextMode.Flat;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tmode = ContextMode.Flat;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tgeometry.create(this.gl, this.program);\n\t\tthis.geometry = geometry;\n\t\tthis.mode = mode;\n\t\tthis.dirty = true;\n\t}\n\n\tpublic setMesh(mesh: string) {\n\t\tthis.mesh = mesh;\n\t}\n\n\tpublic getResource(url: string): string {\n\t\treturn String((url.indexOf(':/') === -1 && this.workpath !== undefined) ? `${this.workpath}/${url}` : url);\n\t}\n\n}\n","// import '@babel/polyfill';\nimport 'promise-polyfill';\nimport Buffers, { IOBuffer } from '../buffers/buffers';\nimport Context, { ContextMode } from '../context/context';\nimport Common from '../core/common';\nimport Logger from '../logger/logger';\nimport Vector2 from '../math/vector2';\nimport Renderer from '../renderer/renderer';\nimport Textures, { ITextureData, ITextureOptions, Texture } from '../textures/textures';\nimport Uniforms, { IUniformOption, Uniform, UniformMethod, UniformType } from '../uniforms/uniforms';\n\nexport interface ICanvasOptions extends WebGLContextAttributes {\n\tvertexString?: string;\n\tfragmentString?: string;\n\tbackgroundColor?: string;\n\tworkpath?: string;\n\tonError?: Function;\n\textensions?: string[];\n\tmode?: ContextMode;\n\tmesh?: string;\n\tdoubleSided?: boolean;\n}\n\nexport default class Canvas extends Renderer {\n\n\toptions: ICanvasOptions;\n\tcanvas: HTMLCanvasElement;\n\trect: ClientRect | DOMRect;\n\twidth: number;\n\theight: number;\n\tdevicePixelRatio: number;\n\tvalid: boolean = false;\n\tvisible: boolean = false;\n\tcontrols: boolean = false;\n\trafId: number;\n\n\tconstructor(\n\t\tcanvas: HTMLCanvasElement,\n\t\toptions: ICanvasOptions = {\n\t\t\t// alpha: true,\n\t\t\t// antialias: true,\n\t\t\t// premultipliedAlpha: true\n\t\t}\n\t) {\n\t\tsuper();\n\t\tif (!canvas) {\n\t\t\treturn;\n\t\t}\n\t\tthis.options = options;\n\t\tthis.canvas = canvas;\n\t\tthis.width = 0;\n\t\tthis.height = 0;\n\t\tthis.rect = canvas.getBoundingClientRect();\n\t\tthis.devicePixelRatio = window.devicePixelRatio || 1;\n\t\tthis.mode = options.mode || ContextMode.Flat;\n\t\tthis.mesh = options.mesh || undefined;\n\t\tthis.doubleSided = options.doubleSided || false;\n\t\tthis.defaultMesh = this.mesh;\n\t\tthis.workpath = options.workpath;\n\t\tcanvas.style.backgroundColor = options.backgroundColor || 'rgba(0,0,0,0)';\n\t\tthis.getShaders_().then((success) => {\n\t\t\tthis.load().then(success => {\n\t\t\t\tif (!this.program) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.addListeners_();\n\t\t\t\tthis.onLoop();\n\t\t\t});\n\t\t}, (error) => {\n\t\t\tLogger.error('GlslCanvas.getShaders_.error', error);\n\t\t});\n\t\tCanvas.items.push(this);\n\t}\n\n\tstatic logger: Logger = Logger;\n\tstatic items: Canvas[] = [];\n\n\tstatic of(canvas: HTMLCanvasElement, options?: ICanvasOptions): Canvas {\n\t\treturn Canvas.items.find(x => x.canvas === canvas) || new Canvas(canvas, options);\n\t}\n\n\tstatic loadAll(): Canvas[] {\n\t\tconst canvases: HTMLCanvasElement[] = <HTMLCanvasElement[]>[].slice.call(document.getElementsByClassName('glsl-canvas')).filter((x: HTMLElement) => x instanceof HTMLCanvasElement);\n\t\treturn canvases.map(x => Canvas.of(x));\n\t}\n\n\tprivate getShaders_(): Promise<string[]> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.vertexString = this.options.vertexString || this.vertexString;\n\t\t\tthis.fragmentString = this.options.fragmentString || this.fragmentString;\n\t\t\tconst canvas = this.canvas;\n\t\t\tconst urls: any = {};\n\t\t\tif (canvas.hasAttribute('data-vertex-url')) {\n\t\t\t\turls.vertex = canvas.getAttribute('data-vertex-url');\n\t\t\t}\n\t\t\tif (canvas.hasAttribute('data-fragment-url')) {\n\t\t\t\turls.fragment = canvas.getAttribute('data-fragment-url');\n\t\t\t}\n\t\t\tif (canvas.hasAttribute('data-vertex')) {\n\t\t\t\tthis.vertexString = canvas.getAttribute('data-vertex');\n\t\t\t}\n\t\t\tif (canvas.hasAttribute('data-fragment')) {\n\t\t\t\tthis.fragmentString = canvas.getAttribute('data-fragment');\n\t\t\t}\n\t\t\tif (Object.keys(urls).length) {\n\t\t\t\tPromise.all(Object.keys(urls).map((key, i) => {\n\t\t\t\t\tconst url: string = urls[key];\n\t\t\t\t\treturn Common.fetch(url)\n\t\t\t\t\t\t// .then((response) => response.text())\n\t\t\t\t\t\t.then((body) => {\n\t\t\t\t\t\t\tif (key === 'vertex') {\n\t\t\t\t\t\t\t\treturn this.vertexString = body;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treturn this.fragmentString = body;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t})).then(shaders => {\n\t\t\t\t\tresolve([this.vertexString, this.fragmentString]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve([this.vertexString, this.fragmentString]);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate addListeners_(): void {\n        /*\n        const resize = (e: Event) => {\n            this.rect = this.canvas.getBoundingClientRect();\n            this.trigger('resize', e);\n        };\n        */\n\t\tthis.onScroll = this.onScroll.bind(this);\n\t\tthis.onWheel = this.onWheel.bind(this);\n\t\tthis.onClick = this.onClick.bind(this);\n\t\tthis.onMove = this.onMove.bind(this);\n\t\tthis.onMousedown = this.onMousedown.bind(this);\n\t\tthis.onMousemove = this.onMousemove.bind(this);\n\t\tthis.onMouseover = this.onMouseover.bind(this);\n\t\tthis.onMouseout = this.onMouseout.bind(this);\n\t\tthis.onMouseup = this.onMouseup.bind(this);\n\t\tthis.onTouchmove = this.onTouchmove.bind(this);\n\t\tthis.onTouchend = this.onTouchend.bind(this);\n\t\tthis.onTouchstart = this.onTouchstart.bind(this);\n\t\tthis.onLoop = this.onLoop.bind(this);\n\t\t// window.addEventListener('resize', this.onResize);\n\t\twindow.addEventListener('scroll', this.onScroll);\n\t\tdocument.addEventListener('mousemove', this.onMousemove, false);\n\t\tdocument.addEventListener('touchmove', this.onTouchmove);\n\t\tthis.addCanvasListeners_();\n\t}\n\n\tprivate addCanvasListeners_() {\n\t\tthis.controls = this.canvas.hasAttribute('controls');\n\t\tthis.canvas.addEventListener('wheel', this.onWheel);\n\t\tthis.canvas.addEventListener('click', this.onClick);\n\t\tthis.canvas.addEventListener('mousedown', this.onMousedown);\n\t\tthis.canvas.addEventListener('touchstart', this.onTouchstart);\n\t\tif (this.controls) {\n\t\t\tthis.canvas.addEventListener('mouseover', this.onMouseover);\n\t\t\tthis.canvas.addEventListener('mouseout', this.onMouseout);\n\t\t\tif (!this.canvas.hasAttribute('data-autoplay')) {\n\t\t\t\tthis.pause();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate removeCanvasListeners_() {\n\t\tthis.canvas.removeEventListener('wheel', this.onWheel);\n\t\tthis.canvas.removeEventListener('click', this.onClick);\n\t\tthis.canvas.removeEventListener('mousedown', this.onMousedown);\n\t\tthis.canvas.removeEventListener('mouseup', this.onMouseup);\n\t\tthis.canvas.removeEventListener('touchstart', this.onTouchstart);\n\t\tthis.canvas.removeEventListener('touchend', this.onTouchend);\n\t\tif (this.controls) {\n\t\t\tthis.canvas.removeEventListener('mouseover', this.onMouseover);\n\t\t\tthis.canvas.removeEventListener('mouseout', this.onMouseout);\n\t\t}\n\t}\n\n\tprivate removeListeners_() {\n\t\twindow.cancelAnimationFrame(this.rafId);\n\t\t// window.removeEventListener('resize', this.onResize);\n\t\twindow.removeEventListener('scroll', this.onScroll);\n\t\tdocument.removeEventListener('mousemove', this.onMousemove);\n\t\tdocument.removeEventListener('touchmove', this.onTouchmove);\n\t\tthis.removeCanvasListeners_();\n\t}\n\n\tonScroll(e: Event) {\n\t\tthis.rect = this.canvas.getBoundingClientRect();\n\t}\n\n\tonWheel(e: MouseWheelEvent) {\n\t\tthis.camera.wheel(e.deltaY);\n\t\tthis.trigger('wheel', e);\n\t}\n\n\tonClick(e: MouseEvent) {\n\t\tif (this.controls) {\n\t\t\tthis.toggle();\n\t\t}\n\t\tthis.trigger('click', e);\n\t}\n\n\tonDown(mx: number, my: number) {\n\t\tmx *= this.devicePixelRatio;\n\t\tmy *= this.devicePixelRatio;\n\t\tthis.mouse.x = mx;\n\t\tthis.mouse.y = my;\n\t\tconst rect = this.rect;\n\t\tconst min = Math.min(rect.width, rect.height);\n\t\tthis.camera.down(mx / min, my / min);\n\t\tthis.trigger('down', this.mouse);\n\t}\n\n\tonMove(mx: number, my: number) {\n\t\tconst rect = this.rect;\n\t\tconst x = (mx - rect.left) * this.devicePixelRatio;\n\t\tconst y = (rect.height - (my - rect.top)) * this.devicePixelRatio;\n\t\tif (x !== this.mouse.x ||\n\t\t\ty !== this.mouse.y) {\n\t\t\tthis.mouse.x = x;\n\t\t\tthis.mouse.y = y;\n\t\t\tconst min = Math.min(rect.width, rect.height);\n\t\t\tthis.camera.move(mx / min, my / min);\n\t\t\tthis.trigger('move', this.mouse);\n\t\t}\n\t}\n\n\tonUp(e: Event) {\n\t\tthis.camera.up();\n\t\tif (this.controls) {\n\t\t\tthis.pause();\n\t\t}\n\t\tthis.trigger('out', e);\n\t}\n\n\tonMousedown(e: MouseEvent) {\n\t\tthis.onDown(e.clientX || e.pageX, e.clientY || e.pageY);\n\t\tdocument.addEventListener('mouseup', this.onMouseup);\n\t\tdocument.removeEventListener('touchstart', this.onTouchstart);\n\t\tdocument.removeEventListener('touchmove', this.onTouchmove);\n\t}\n\n\tonMousemove(e: MouseEvent) {\n\t\tthis.onMove(e.clientX || e.pageX, e.clientY || e.pageY);\n\t}\n\n\tonMouseup(e: MouseEvent) {\n\t\tthis.onUp(e);\n\t}\n\n\tonMouseover(e: MouseEvent) {\n\t\tthis.play();\n\t\tthis.trigger('over', e);\n\t}\n\n\tonMouseout(e: MouseEvent) {\n\t\tthis.pause();\n\t\tthis.trigger('out', e);\n\t}\n\n\tonTouchmove(e: TouchEvent) {\n\t\tconst touch = [].slice.call(e.touches).reduce((p: Vector2, touch: Touch) => {\n\t\t\tp = p || new Vector2();\n\t\t\tp.x += touch.clientX;\n\t\t\tp.y += touch.clientY;\n\t\t\treturn p;\n\t\t}, null);\n\t\tif (touch) {\n\t\t\tthis.onMove(touch.x / e.touches.length, touch.y / e.touches.length);\n\t\t}\n\t}\n\n\tonTouchend(e: TouchEvent) {\n\t\tthis.onUp(e);\n\t\tdocument.removeEventListener('touchend', this.onTouchend);\n\t}\n\n\tonTouchstart(e: TouchEvent) {\n\t\tconst touch = [].slice.call(e.touches).reduce((p: Vector2, touch: Touch) => {\n\t\t\tp = p || new Vector2();\n\t\t\tp.x += touch.clientX;\n\t\t\tp.y += touch.clientY;\n\t\t\treturn p;\n\t\t}, null);\n\t\tif (touch) {\n\t\t\tthis.onDown(touch.x / e.touches.length, touch.y / e.touches.length);\n\t\t}\n\t\tif (this.controls) {\n\t\t\tthis.play();\n\t\t}\n\t\tthis.trigger('over', e);\n\t\tdocument.addEventListener('touchend', this.onTouchend);\n\t\tdocument.removeEventListener('mousedown', this.onMousedown);\n\t\tdocument.removeEventListener('mousemove', this.onMousemove);\n\t\tif (this.controls) {\n\t\t\tthis.canvas.removeEventListener('mouseover', this.onMouseover);\n\t\t\tthis.canvas.removeEventListener('mouseout', this.onMouseout);\n\t\t}\n\t}\n\n\tonLoop(time?: number) {\n\t\tthis.checkRender();\n\t\tthis.rafId = window.requestAnimationFrame(this.onLoop);\n\t}\n\n\tprivate setUniform_(\n\t\tkey: string,\n\t\tvalues: any[],\n\t\toptions: ITextureOptions = {},\n\t\ttype: UniformType = null\n\t): void {\n\t\tconst uniform: Uniform | Uniform[] = Uniforms.parseUniform(key, values, type);\n\t\tif (Array.isArray(uniform)) {\n\t\t\tif (Uniforms.isArrayOfSampler2D(uniform)) {\n\t\t\t\tuniform.forEach((x) => this.loadTexture(x.key, x.values[0], options));\n\t\t\t} else {\n\t\t\t\tuniform.forEach((x) => this.uniforms.set(x.key, x.values[0]));\n\t\t\t}\n\t\t} else if (uniform) {\n\t\t\tswitch (uniform.type) {\n\t\t\t\tcase UniformType.Sampler2D:\n\t\t\t\t\tthis.loadTexture(key, values[0], options);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.uniforms.set(key, uniform);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate isVisible_(): boolean {\n\t\tconst rect = this.rect;\n\t\treturn (rect.top + rect.height) > 0 && rect.top < (window.innerHeight || document.documentElement.clientHeight);\n\t}\n\n\tprivate isAnimated_(): boolean {\n\t\treturn (this.animated || this.textures.animated) && !this.timer.paused;\n\t}\n\n\tprivate isDirty_(): boolean {\n\t\treturn this.dirty || this.uniforms.dirty || this.textures.dirty;\n\t}\n\n\t// check size change at start of requestFrame\n\tprivate sizeDidChanged_(): boolean {\n\t\tconst gl = this.gl;\n\t\tconst CW = Math.ceil(this.canvas.clientWidth),\n\t\t\tCH = Math.ceil(this.canvas.clientHeight);\n\t\tif (this.width !== CW ||\n\t\t\tthis.height !== CH) {\n\t\t\tthis.width = CW;\n\t\t\tthis.height = CH;\n\t\t\t// Lookup the size the browser is displaying the canvas in CSS pixels\n\t\t\t// and compute a size needed to make our drawingbuffer match it in\n\t\t\t// device pixels.\n\t\t\tconst W = Math.ceil(CW * this.devicePixelRatio);\n\t\t\tconst H = Math.ceil(CH * this.devicePixelRatio);\n\t\t\tthis.W = W;\n\t\t\tthis.H = H;\n\t\t\tthis.canvas.width = W;\n\t\t\tthis.canvas.height = H;\n            /*\n            if (gl.canvas.width !== W ||\n                gl.canvas.height !== H) {\n                gl.canvas.width = W;\n                gl.canvas.height = H;\n                // Set the viewport to match\n                // gl.viewport(0, 0, W, H);\n            }\n            */\n\t\t\tfor (const key in this.buffers.values) {\n\t\t\t\tconst buffer: IOBuffer = this.buffers.values[key];\n\t\t\t\tbuffer.resize(gl, W, H);\n\t\t\t}\n\t\t\tthis.rect = this.canvas.getBoundingClientRect();\n\t\t\tthis.trigger('resize');\n\t\t\t// gl.useProgram(this.program);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tprivate parseTextures_(fragmentString: string): boolean {\n\t\t// const regexp = /uniform\\s*sampler2D\\s*([\\w]*);(\\s*\\/\\/\\s*([\\w|\\:\\/\\/|\\.|\\-|\\_]*)|\\s*)/gm;\n\t\tconst regexp = /uniform\\s*sampler2D\\s*([\\w]*);(\\s*\\/\\/\\s*([\\w|\\:\\/\\/|\\.|\\-|\\_|\\?|\\&|\\=]*)|\\s*)/gm;\n\t\t// const regexp = /uniform\\s*sampler2D\\s*([\\w]*);(\\s*\\/\\/\\s*([\\w|\\://|\\.|\\-|\\_]*)|\\s*)((\\s*\\:\\s)(\\{(\\s*\\w*\\:\\s*['|\"]{0,1}\\w*['|\"]{0,1}\\s*[,]{0,1})+\\}))*/gm;\n\t\tlet matches;\n\t\twhile ((matches = regexp.exec(fragmentString)) !== null) {\n\t\t\tconst key = matches[1];\n\t\t\tconst url = matches[3];\n\t\t\tif (Texture.isTextureUrl(url)) {\n\t\t\t\tthis.textureList.push({ key, url });\n\t\t\t\t/*\n\t\t\t\tif (matches[3]) {\n\t\t\t\t\tconst ext = matches[3].split('?')[0].split('.').pop().toLowerCase();\n\t\t\t\t\tconst url = matches[3];\n\t\t\t\t\tif (url && TextureExtensions.indexOf(ext) !== -1) {\n\t\t\t\t\t\t// let options;\n\t\t\t\t\t\t// if (matches[6]) {\n\t\t\t\t\t\t// \ttry {\n\t\t\t\t\t\t// \t\toptions = new Function(`return ${matches[6]};`)();\n\t\t\t\t\t\t// \t} catch (e) {\n\t\t\t\t\t\t// \t\t// console.log('wrong texture options');\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t// console.log(options, matches[6]);\n\t\t\t\t\t\t// this.textureList.push({ key, url, options });\n\t\t\t\t\t\tthis.textureList.push({ key, url });\n\t\t\t\t\t}\n\t\t\t\t*/\n\t\t\t} else if (!this.buffers.has(key)) {\n\t\t\t\t// create empty texture\n\t\t\t\tthis.textureList.push({ key, url: null });\n\t\t\t}\n\t\t}\n\t\tif (this.canvas.hasAttribute('data-textures')) {\n\t\t\tconst urls = this.canvas.getAttribute('data-textures').split(',');\n\t\t\turls.forEach((url: string, i: number) => {\n\t\t\t\tconst key = 'u_texture' + i;\n\t\t\t\tthis.textureList.push({ key, url });\n\t\t\t});\n\t\t}\n\t\treturn this.textureList.length > 0;\n\t}\n\n\tload(\n\t\tfragmentString?: string,\n\t\tvertexString?: string\n\t): Promise<boolean> {\n\t\tconst fragmentVertexString: string = Context.getFragmentVertex(this.gl, fragmentString || this.fragmentString);\n\t\treturn Promise.all([\n\t\t\tContext.getIncludes(fragmentString || this.fragmentString),\n\t\t\tContext.getIncludes(fragmentVertexString || vertexString || this.vertexString)\n\t\t]).then(array => {\n\t\t\tthis.fragmentString = array[0];\n\t\t\tthis.vertexString = array[1];\n\t\t\treturn this.createContext_();\n\t\t});\n\t}\n\n\tprivate getContext_(): WebGLRenderingContext | WebGL2RenderingContext {\n\t\tconst vertexString = this.vertexString;\n\t\tconst fragmentString = this.fragmentString;\n\t\tthis.vertexString = Context.getVertex(vertexString, fragmentString, this.mode);\n\t\tthis.fragmentString = Context.getFragment(vertexString, fragmentString, this.mode);\n\t\tif (Context.versionDiffers(this.gl, vertexString, fragmentString)) {\n\t\t\tthis.destroyContext_();\n\t\t\tthis.swapCanvas_();\n\t\t\tthis.uniforms = new Uniforms();\n\t\t\tthis.buffers = new Buffers();\n\t\t\tthis.textures = new Textures();\n\t\t\tthis.textureList = [];\n\t\t}\n\t\tif (!this.gl) {\n\t\t\tconst gl = Context.tryInferContext(vertexString, fragmentString, this.canvas, this.options, this.options.extensions, this.options.onError);\n\t\t\tif (!gl) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tthis.gl = gl;\n\t\t}\n\t\treturn this.gl;\n\t}\n\n\tprivate createContext_(): boolean {\n\t\tconst gl = this.getContext_();\n\t\tif (!gl) {\n\t\t\treturn false;\n\t\t}\n\t\tlet vertexShader, fragmentShader;\n\t\ttry {\n\t\t\tContext.inferPrecision(this.fragmentString);\n\t\t\tvertexShader = Context.createShader(gl, this.vertexString, gl.VERTEX_SHADER);\n\t\t\tfragmentShader = Context.createShader(gl, this.fragmentString, gl.FRAGMENT_SHADER);\n\t\t\t// If Fragment shader fails load a empty one to sign the error\n\t\t\tif (!fragmentShader) {\n\t\t\t\tconst defaultFragment = Context.getFragment(null, null, this.mode);\n\t\t\t\tfragmentShader = Context.createShader(gl, defaultFragment, gl.FRAGMENT_SHADER);\n\t\t\t\tthis.valid = false;\n\t\t\t} else {\n\t\t\t\tthis.valid = true;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// !!!\n\t\t\t// console.error(e);\n\t\t\tthis.trigger('error', e);\n\t\t\treturn false;\n\t\t}\n\t\t// Create and use program\n\t\tconst program = Context.createProgram(gl, [vertexShader, fragmentShader]); //, [0,1],['a_texcoord','a_position']);\n\t\tif (!program) {\n\t\t\tthis.trigger('error', Context.lastError);\n\t\t\treturn false;\n\t\t}\n\t\t// console.log(this.vertexString, this.fragmentString, program);\n\t\t// Delete shaders\n\t\t// gl.detachShader(program, vertexShader);\n\t\t// gl.detachShader(program, fragmentShader);\n\t\tgl.deleteShader(vertexShader);\n\t\tgl.deleteShader(fragmentShader);\n\t\tthis.program = program;\n\t\tif (this.valid) {\n\t\t\ttry {\n\t\t\t\tthis.buffers = Buffers.getBuffers(gl, this.fragmentString, Context.getBufferVertex(gl));\n\t\t\t} catch (e) {\n\t\t\t\t// console.error('load', e);\n\t\t\t\tthis.valid = false;\n\t\t\t\tthis.trigger('error', e);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.create_();\n\t\t\tif (this.animated) {\n\t\t\t\tthis.canvas.classList.add('animated');\n\t\t\t} else {\n\t\t\t\tthis.canvas.classList.remove('animated');\n\t\t\t}\n\t\t}\n\t\t// Trigger event\n\t\tthis.trigger('load', this);\n\t\treturn this.valid;\n\t}\n\n\tprotected create_(): void {\n\t\tthis.parseMode_();\n\t\tthis.parseMesh_();\n\t\tsuper.create_();\n\t\tthis.createBuffers_();\n\t\tthis.createTextures_();\n\t}\n\n\tprotected parseMode_() {\n\t\tif (this.canvas.hasAttribute('data-mode')) {\n\t\t\tconst data = this.canvas.getAttribute('data-mode');\n\t\t\tif (['flat', 'box', 'sphere', 'torus', 'mesh'].indexOf(data) !== -1) {\n\t\t\t\tthis.mode = data as ContextMode;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected parseMesh_() {\n\t\tif (this.canvas.hasAttribute('data-mesh')) {\n\t\t\tconst data = this.canvas.getAttribute('data-mesh');\n\t\t\tif (data.indexOf('.obj') !== -1) {\n\t\t\t\tthis.mesh = this.defaultMesh = data;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected createBuffers_() {\n\t\tfor (const key in this.buffers.values) {\n\t\t\tconst buffer: IOBuffer = this.buffers.values[key];\n\t\t\tthis.uniforms.create(UniformMethod.Uniform1i, UniformType.Sampler2D, buffer.key, [buffer.input.index]);\n\t\t}\n\t}\n\n\tprotected createTextures_() {\n\t\tconst hasTextures = this.parseTextures_(this.fragmentString);\n\t\tif (hasTextures) {\n\t\t\tthis.textureList.filter(x => x.url).forEach(x => {\n\t\t\t\tthis.setTexture(x.key, x.url, x.options);\n\t\t\t});\n\t\t\tthis.textureList = [];\n\t\t}\n\t}\n\n\tprotected update_(): void {\n\t\tsuper.update_();\n\t\tthis.updateBuffers_();\n\t\tthis.updateTextures_();\n\t}\n\n\tprotected updateBuffers_(): void {\n\t\tfor (const key in this.buffers.values) {\n\t\t\tconst buffer: IOBuffer = this.buffers.values[key];\n\t\t\tthis.uniforms.update(UniformMethod.Uniform1i, UniformType.Sampler2D, buffer.key, [buffer.input.index]);\n\t\t}\n\t}\n\n\tprotected updateTextures_(): void {\n\t\tconst gl = this.gl;\n\t\tfor (const key in this.textures.values) {\n\t\t\tconst texture: Texture = this.textures.values[key];\n\t\t\ttexture.tryUpdate(gl);\n\t\t\tthis.uniforms.update(UniformMethod.Uniform1i, UniformType.Sampler2D, texture.key, [texture.index]);\n\t\t}\n\t}\n\n\tprivate destroyContext_(): void {\n\t\tconst gl = this.gl;\n\t\tgl.useProgram(null);\n\t\tif (this.program) {\n\t\t\tgl.deleteProgram(this.program);\n\t\t}\n\t\tfor (const key in this.buffers.values) {\n\t\t\tconst buffer: IOBuffer = this.buffers.values[key];\n\t\t\tbuffer.destroy(gl);\n\t\t}\n\t\tfor (const key in this.textures.values) {\n\t\t\tconst texture: Texture = this.textures.values[key];\n\t\t\ttexture.destroy(gl);\n\t\t}\n\t\tthis.buffers = null;\n\t\tthis.textures = null;\n\t\tthis.uniforms = null;\n\t\tthis.program = null;\n\t\tthis.gl = null;\n\t}\n\n\tprivate swapCanvas_(): void {\n\t\tconst canvas = this.canvas;\n\t\tconst canvas_ = canvas.cloneNode() as HTMLCanvasElement;\n\t\tcanvas.parentNode.replaceChild(canvas_, canvas);\n\t\tthis.canvas = canvas_;\n\t\tthis.addCanvasListeners_();\n\t}\n\n\tdestroy(): void {\n\t\tthis.removeListeners_();\n\t\tthis.destroyContext_();\n\t\tthis.animated = false;\n\t\tthis.valid = false;\n\t\tCanvas.items.splice(Canvas.items.indexOf(this), 1);\n\t}\n\n\tloadTexture(\n\t\tkey: string,\n\t\turlElementOrData: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | ITextureData,\n\t\toptions: ITextureOptions = {}\n\t) {\n\t\tif (this.valid) {\n\t\t\t// Logger.log('GlslCanvas.loadTexture', key, urlElementOrData);\n\t\t\tthis.textures.createOrUpdate(this.gl, key, urlElementOrData, this.buffers.count, options, this.options.workpath).then(\n\t\t\t\ttexture => {\n\t\t\t\t\tconst index = texture.index;\n\t\t\t\t\tconst uniform = this.uniforms.createTexture(key, index);\n\t\t\t\t\tuniform.texture = texture;\n\t\t\t\t\tconst keyResolution = key.indexOf('[') !== -1 ? key.replace('[', 'Resolution[') : key + 'Resolution';\n\t\t\t\t\t// const uniformResolution = ;\n\t\t\t\t\tthis.uniforms.create(UniformMethod.Uniform2f, UniformType.Float, keyResolution, [texture.width, texture.height]);\n\t\t\t\t\t// Logger.log('loadTexture', key, url, index, texture.width, texture.height);\n\t\t\t\t\treturn texture;\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\tconst message = Array.isArray(error.path) ? error.path.map((x: any) => x.error ? x.error.message : '').join(', ') : error.message;\n\t\t\t\t\tLogger.error('GlslCanvas.loadTexture.error', key, urlElementOrData, message);\n\t\t\t\t\tthis.trigger('textureError', { key, urlElementOrData, message });\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.textureList.push({ key, url: urlElementOrData, options });\n\t\t}\n\t}\n\n\tsetTexture(\n\t\tkey: string,\n\t\turlElementOrData: string | HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | Element | ITextureData,\n\t\toptions: ITextureOptions = {}\n\t): void {\n\t\treturn this.setUniform_(key, [urlElementOrData], options);\n\t}\n\n\tsetUniform(key: string, ...values: any[]): void {\n\t\treturn this.setUniform_(key, values);\n\t}\n\n\tsetUniformOfInt(key: string, values: any[]): void {\n\t\treturn this.setUniform_(key, values, null, UniformType.Int);\n\t}\n\n\tsetUniforms(values: IUniformOption): void {\n\t\tfor (const key in values) {\n\t\t\tthis.setUniform(key, values[key]);\n\t\t}\n\t}\n\n\tpause(): void {\n\t\tif (this.valid) {\n\t\t\tthis.timer.pause();\n\t\t\tthis.canvas.classList.add('paused');\n\t\t\tthis.trigger('pause');\n\t\t}\n\t}\n\n\tplay(): void {\n\t\tif (this.valid) {\n\t\t\tthis.timer.play();\n\t\t\tthis.canvas.classList.remove('paused');\n\t\t\tthis.trigger('play');\n\t\t}\n\t}\n\n\ttoggle(): void {\n\t\tif (this.valid) {\n\t\t\tif (this.timer.paused) {\n\t\t\t\tthis.play();\n\t\t\t} else {\n\t\t\t\tthis.pause();\n\t\t\t}\n\t\t}\n\t}\n\n\tcheckRender(): void {\n\t\tif (this.isVisible_() && (this.sizeDidChanged_() || this.isDirty_() || this.isAnimated_())) {\n\t\t\tthis.render();\n\t\t\tthis.canvas.classList.add('playing');\n\t\t} else {\n\t\t\tthis.canvas.classList.remove('playing');\n\t\t}\n\t}\n\n\t/*\n\ttest(\n\t\tfragmentString?: string,\n\t\tvertexString?: string\n\t): Promise<any> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst vertex = this.vertexString;\n\t\t\tconst fragment = this.fragmentString;\n\t\t\tconst paused = this.timer.paused;\n\t\t\t// Thanks to @thespite for the help here\n\t\t\t// https://www.khronos.org/registry/webgl/extensions/EXT_disjoint_timer_query/\n\t\t\tconst extension = this.gl.getExtension('EXT_disjoint_timer_query');\n\t\t\tconst query = extension.createQueryEXT();\n\t\t\tlet wasValid = this.valid;\n\t\t\tif (fragmentString || vertexString) {\n\t\t\t\tthis.load(fragmentString, vertexString);\n\t\t\t\twasValid = this.valid;\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t\tthis.timer.paused = true;\n\t\t\textension.beginQueryEXT(extension.TIME_ELAPSED_EXT, query);\n\t\t\tthis.render();\n\t\t\textension.endQueryEXT(extension.TIME_ELAPSED_EXT);\n\t\t\tconst waitForTest = () => {\n\t\t\t\tthis.render();\n\t\t\t\tconst available = extension.getQueryObjectEXT(query, extension.QUERY_RESULT_AVAILABLE_EXT);\n\t\t\t\tconst disjoint = this.gl.getParameter(extension.GPU_DISJOINT_EXT);\n\t\t\t\tif (available && !disjoint) {\n\t\t\t\t\tconst result = {\n\t\t\t\t\t\twasValid: wasValid,\n\t\t\t\t\t\tfragment: fragmentString || this.fragmentString,\n\t\t\t\t\t\tvertex: vertexString || this.vertexString,\n\t\t\t\t\t\ttimeElapsedMs: extension.getQueryObjectEXT(query, extension.QUERY_RESULT_EXT) / 1000000.0\n\t\t\t\t\t};\n\t\t\t\t\tthis.timer.paused = paused;\n\t\t\t\t\tif (fragmentString || vertexString) {\n\t\t\t\t\t\tthis.load(fragment, vertex);\n\t\t\t\t\t}\n\t\t\t\t\tresolve(result);\n\t\t\t\t} else {\n\t\t\t\t\twindow.requestAnimationFrame(waitForTest);\n\t\t\t\t}\n\t\t\t}\n\t\t\twaitForTest();\n\t\t});\n\t}\n\t*/\n\n}\n\nif (document) {\n\tdocument.addEventListener(\"DOMContentLoaded\", () => {\n\t\tCanvas.loadAll();\n\t});\n}\n"]}